<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –±–ª–æ–≥–µ—Ä–æ–≤ (v7.4: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ Excel/Sheets)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SheetJS –¥–ª—è Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --danger: #f44336;
            --warning: #ff9800;
            --light: #f5f5f5;
            --dark: #333;
            --border: #ddd;
            --text-large: 16px;
            --success: #28a745;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: var(--text-large);
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 10px; font-size: 2.2em; }
        .subtitle { text-align: center; color: var(--secondary); font-size: 14px; margin-bottom: 30px; }
        .section {
            background: white;
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary);
        }
        .section:hover { transform: translateY(-2px); }
        .section-header { display: flex; align-items: center; margin-bottom: 15px; }
        .section-header h2 { margin: 0; color: var(--dark); font-size: 1.5em; }
        .section-header i { color: var(--primary); margin-right: 10px; font-size: 1.6em; }
        .hidden { display: none; }
        .toggle-btn { cursor: pointer; color: var(--secondary); font-weight: bold; margin-right: 10px; padding: 5px 10px; background: var(--light); border-radius: 20px; border: 1px solid var(--border); transition: all 0.3s; }
        .toggle-btn:hover { background: var(--secondary); color: white; }
        .add-btn { 
            background: linear-gradient(45deg, var(--primary), #45a049);
            color: white; 
            padding: 10px 15px; 
            border: none; 
            border-radius: 20px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 0 5px;
        }
        .add-btn:hover:not(:disabled) { box-shadow: 0 4px 8px rgba(76,175,80,0.3); transform: scale(1.05); }
        .add-btn:disabled { background: var(--border); cursor: not-allowed; transform: none; opacity: 0.6; }
        .btn-close { background: var(--danger); color: white; padding: 8px 15px; border: none; border-radius: 20px; cursor: pointer; font-size: 14px; margin: 0 5px; transition: all 0.3s; }
        .btn-close:hover { background: #c82333; transform: scale(1.05); }
        input, select, button {
            margin: 5px; 
            padding: 12px; 
            border: 1px solid var(--border); 
            border-radius: 6px; 
            font-size: var(--text-large);
            transition: all 0.3s;
        }
        input:focus, select:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 5px rgba(33,150,243,0.3); }
        input:invalid, select:invalid { border-color: var(--danger); }
        input:disabled, select:disabled { background: #f8f9fa; cursor: not-allowed; }
        .form-group { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .form-group.full-width { flex-direction: column; align-items: stretch; }
        .form-group label { min-width: 120px; font-weight: 600; color: var(--dark); }
        .form-row { display: flex; flex-wrap: wrap; gap: 15px; align-items: end; }
        .input-group { flex: 1; min-width: 150px; }
        .file-input-wrapper { position: relative; display: inline-block; }
        .file-input { opacity: 0; position: absolute; z-index: -1; }
        .table-container {
            overflow-x: auto; 
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background: white;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 900px; 
            font-size: 14px; 
        }
        th, td { 
            padding: 12px 10px; 
            text-align: left; 
            border-bottom: 1px solid var(--border); 
            vertical-align: top;
        }
        th { 
            background: linear-gradient(45deg, var(--primary), #45a049); 
            color: white; 
            font-weight: 600; 
            position: sticky; top: 0;
            z-index: 10;
            white-space: nowrap; 
            font-size: 13px;
        }
        td { word-wrap: break-word; max-width: 200px; }
        tr:hover { background: var(--light); }
        tr.new-row { animation: highlight 2s ease-out; }
        @keyframes highlight { 0% { background: var(--success); color: white; } 100% { background: var(--light); color: inherit; } }
        .metrics { font-weight: 600; font-size: 15px; }
        .positive { color: var(--primary); }
        .negative { color: var(--danger); }
        .neutral { color: var(--warning); }
        .metrics-group { display: flex; flex-direction: column; gap: 4px; }
        .metric-item { display: flex; justify-content: space-between; padding: 2px 0; font-size: 13px; }
        .metric-label { font-weight: 600; color: var(--dark); min-width: 60px; }
        .form-popup { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 50%; 
            top: 50%; 
            transform: translate(-50%, -50%); 
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            min-width: 400px; 
            max-width: 90vw;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }
        @keyframes modalSlide { from { opacity: 0; transform: translate(-50%, -60%); } to { opacity: 1; transform: translate(-50%, -50%); } }
        .form-container { display: flex; flex-direction: column; gap: 15px; }
        .form-container input, .form-container select { width: 100%; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .modal-title { margin: 0; font-size: 1.4em; color: var(--dark); }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--dark); padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.3s; }
        .close-btn:hover { background: var(--light); }
        .tabs { 
            display: flex; 
            background: var(--light); 
            border-radius: 8px 8px 0 0; 
            overflow: hidden; 
            margin-bottom: 0; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tab-btn { 
            flex: 1; 
            padding: 15px 10px; 
            background: none; 
            border: none; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 14px;
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .tab-btn.active { 
            background: var(--primary); 
            color: white; 
            box-shadow: inset 0 -2px 0 rgba(0,0,0,0.1);
        }
        .tab-btn:not(.active):hover { background: rgba(33,150,243,0.1); }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .blogger-card, .book-card { 
            background: white;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .blogger-card:hover, .book-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }
        .card-title { font-size: 1.3em; font-weight: 600; color: var(--dark); margin: 0; }
        .card-icon { margin-right: 10px; color: var(--secondary); }
        .card-stats { font-size: 14px; color: var(--dark); text-align: right; }
        .card-stats .metric { display: block; margin: 2px 0; font-weight: 500; }
        .card-details { display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-bottom: 15px; font-size: 14px; }
        .detail-label { font-weight: 600; color: var(--dark); }
        .detail-value { word-break: break-word; }
        .card-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        .progress { 
            width: 100%; 
            height: 8px; 
            background: var(--light); 
            border-radius: 4px; 
            overflow: hidden; 
            margin: 15px 0;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
        }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, var(--primary), var(--secondary)); 
            transition: width 0.3s ease-in-out; 
            width: 0%; 
            border-radius: 4px;
            position: relative;
        }
        .progress-bar::after {
            content: attr(data-label);
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 11px;
            color: white;
            font-weight: 600;
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        .progress-text { font-size: 14px; color: var(--dark); margin: 5px 0; text-align: center; font-weight: 500; }
        .tooltip { 
            position: relative; 
            display: inline-block; 
            border-bottom: 1px dotted var(--secondary); 
            cursor: help; 
        }
        .tooltip .tooltiptext { 
            visibility: hidden; 
            background: var(--dark); 
            color: white; 
            text-align: left; 
            padding: 10px; 
            border-radius: 6px; 
            position: absolute; 
            z-index: 100; 
            bottom: 125%; 
            left: 50%; 
            margin-left: -100px; 
            opacity: 0; 
            transition: opacity 0.3s;
            white-space: normal;
            width: 200px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-size: 13px;
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--warning);
        }
        .empty-state i { font-size: 4em; margin-bottom: 20px; opacity: 0.7; }
        .empty-state p { font-size: 1.1em; margin: 10px 0; }
        .empty-state .btn { margin: 10px; padding: 12px 24px; font-size: 15px; }
        .message { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            display: flex; 
            align-items: center; 
            gap: 10px;
            animation: slideIn 0.3s ease;
        }
        .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .message.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .message.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--dark);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 300px;
            z-index: 999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
        }
        .debug-panel.show { display: block; }
        .debug-panel h4 { margin: 0 0 10px 0; color: var(--primary); }
        .debug-item { margin: 5px 0; padding: 5px; background: rgba(255,255,255,0.1); border-radius: 4px; }
        .debug-item strong { color: var(--secondary); }
        .status-indicator {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .status-ready { background: var(--light); color: var(--success); border: 1px solid var(--success); }
        .status-loading { background: var(--warning); color: white; animation: pulse 1.5s infinite; }
        .status-success { background: var(--success); color: white; }
        .status-error { background: var(--danger); color: white; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .loading { 
            display: inline-block; 
            width: 16px; 
            height: 16px; 
            border: 2px solid var(--light); 
            border-radius: 50%; 
            border-top-color: var(--primary); 
            animation: spin 1s linear infinite; 
            margin-right: 8px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) {
            body { font-size: 14px; padding: 10px; }
            .form-group, .form-row { flex-direction: column; align-items: stretch; }
            .form-group label, .input-group { min-width: auto; }
            table { min-width: 700px; font-size: 12px; }
            th, td { padding: 8px 6px; }
            .tabs { flex-direction: column; }
            .tab-btn { border-bottom: 1px solid var(--border); padding: 12px; }
            .card-details { grid-template-columns: 1fr; }
            .card-actions { justify-content: center; flex-wrap: wrap; }
            .form-popup { min-width: 95vw; margin: 10px; transform: none; left: 0; right: 0; top: 0; bottom: 0; border-radius: 0; max-height: none; }
        }
        .demo-data { 
            background: var(--warning); 
            color: white; 
            padding: 10px 15px; 
            border-radius: 6px; 
            margin: 15px 0; 
            text-align: center; 
            font-weight: 500;
        }
        .demo-data button { 
            background: rgba(255,255,255,0.2); 
            color: white; 
            border: 1px solid white; 
            padding: 8px 16px; 
            border-radius: 20px; 
            cursor: pointer; 
            margin: 0 5px;
        }
        .demo-data button:hover { background: white; color: var(--warning); }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-chart-line"></i> –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –±–ª–æ–≥–µ—Ä–æ–≤ (v7.4)</h1>
        <p class="subtitle">
            <i class="fas fa-cogs"></i> –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ Excel –∏ Google Sheets | –ü–∞—Ä–æ–ª—å —Å–±—Ä–æ—Å–∞: <code>admin</code>
        </p>

        <!-- Debug –ø–∞–Ω–µ–ª—å -->
        <div class="debug-panel" id="debugPanel">
            <h4><i class="fas fa-bug"></i> Debug Info</h4>
            <div id="debugContent"></div>
            <button onclick="toggleDebug()" style="width: 100%; margin-top: 10px; padding: 8px; background: var(--secondary); color: white; border: none; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-times"></i> –°–∫—Ä—ã—Ç—å
            </button>
        </div>

        <!-- –°—á–µ—Ç—á–∏–∫–∏ -->
        <div style="display: flex; justify-content: space-around; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;">
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: var(--primary);" id="bloggerCount">0</div>
                <div>–ë–ª–æ–≥–µ—Ä–æ–≤</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: var(--secondary);" id="bookCount">0</div>
                <div>–ö–Ω–∏–≥</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: var(--success);" id="campaignCount">0</div>
                <div>–ö–∞–º–ø–∞–Ω–∏–π</div>
            </div>
            <div style="text-align: center;">
                <i class="fas fa-download" onclick="exportData()" style="font-size: 24px; color: var(--warning); cursor: pointer;" title="–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel"></i>
                <div style="font-size: 12px;">–≠–∫—Å–ø–æ—Ä—Ç</div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="load" onclick="switchTab('load')">
                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∫–∞
            </button>
            <button class="tab-btn" data-tab="bloggers" onclick="switchTab('bloggers')">
                <i class="fas fa-users"></i> –ë–ª–æ–≥–µ—Ä—ã
            </button>
            <button class="tab-btn" data-tab="books" onclick="switchTab('books')">
                <i class="fas fa-book"></i> –ö–Ω–∏–≥–∏
            </button>
            <button class="tab-btn" data-tab="campaigns" onclick="switchTab('campaigns')">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
            </button>
            <button class="tab-btn" data-tab="data" onclick="switchTab('data')">
                <i class="fas fa-table"></i> –î–∞–Ω–Ω—ã–µ
            </button>
            <button class="tab-btn" data-tab="analysis" onclick="switchTab('analysis')">
                <i class="fas fa-chart-bar"></i> –ê–Ω–∞–ª–∏–∑
            </button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="load" class="section tab-content active">
            <div class="section-header">
                <h2><i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
                <button class="toggle-btn" onclick="toggleDebug()">Debug</button>
            </div>

            <!-- Google Sheets -->
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin-top: 0; color: var(--secondary);"><i class="fas fa-file-csv"></i> Google Sheets (CSV)</h3>
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É:</label>
                    <input type="url" id="csvUrl" placeholder="https://docs.google.com/spreadsheets/d/ABC123.../pub?output=csv" style="flex: 1; min-width: 400px;" 
                           value="https://docs.google.com/spreadsheets/d/e/2PACX-1v.../pub?output=csv">
                    <span class="status-indicator status-ready" id="sheetsStatus"><i class="fas fa-check"></i> –ì–æ—Ç–æ–≤</span>
                </div>
                <p style="font-size: 13px; color: var(--dark); margin: 5px 0 0 0;">
                    <i class="fas fa-info-circle"></i> –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å <strong>–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –ø—É–±–ª–∏—á–Ω–æ</strong> —á–µ—Ä–µ–∑ "–§–∞–π–ª ‚Üí –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ ‚Üí –í—Å—è —Ç–∞–±–ª–∏—Ü–∞ ‚Üí CSV"
                </p>
                <button class="add-btn" onclick="loadFromSheets()" id="loadSheetsBtn">
                    <i class="fas fa-file-csv"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV
                </button>
                <div class="progress" id="sheetsProgress" style="display: none; margin-top: 10px;">
                    <div class="progress-bar" id="sheetsProgressBar"></div>
                    <div class="progress-text" id="sheetsProgressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
                </div>
                <div id="sheetsMessage"></div>
            </div>

            <!-- Excel -->
            <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin-top: 0; color: var(--secondary);"><i class="fas fa-file-excel"></i> Excel —Ñ–∞–π–ª (.xlsx, .xls)</h3>
                <div class="form-row">
                    <div class="input-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel:</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="excelFile" accept=".xlsx,.xls" onchange="handleExcelFile(event)" class="file-input">
                            <button type="button" class="add-btn" onclick="document.getElementById('excelFile').click()">
                                <i class="fas fa-file-excel"></i> –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                            </button>
                        </div>
                        <div id="fileInfo" style="margin-top: 5px; font-size: 13px; color: var(--secondary);"></div>
                    </div>
                    <span class="status-indicator status-ready" id="excelStatus"><i class="fas fa-check"></i> –ì–æ—Ç–æ–≤</span>
                </div>
                <p style="font-size: 13px; color: var(--dark); margin: 5px 0 0 0;">
                    <i class="fas fa-info-circle"></i> –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã –¥–æ 10MB. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫.
                </p>
                <div class="progress" id="excelProgress" style="display: none; margin-top: 10px;">
                    <div class="progress-bar" id="excelProgressBar"></div>
                    <div class="progress-text" id="excelProgressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
                </div>
                <div id="excelMessage"></div>
            </div>

            <!-- CSV –∑–∞–≥—Ä—É–∑–∫–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª) -->
            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin-top: 0; color: var(--success);"><i class="fas fa-file-csv"></i> CSV —Ñ–∞–π–ª (–ª–æ–∫–∞–ª—å–Ω—ã–π)</h3>
                <div class="form-row">
                    <div class="input-group">
                        <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV —Ñ–∞–π–ª:</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="csvFile" accept=".csv,.txt" onchange="handleCsvFile(event)" class="file-input">
                            <button type="button" class="add-btn" onclick="document.getElementById('csvFile').click()" style="background: var(--success);">
                                <i class="fas fa-file-csv"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV
                            </button>
                        </div>
                        <div id="csvFileInfo" style="margin-top: 5px; font-size: 13px; color: var(--success);"></div>
                    </div>
                    <span class="status-indicator status-ready" id="csvStatus"><i class="fas fa-check"></i> –ì–æ—Ç–æ–≤</span>
                </div>
                <p style="font-size: 13px; color: var(--dark); margin: 5px 0 0 0;">
                    <i class="fas fa-info-circle"></i> –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –æ–±–æ–π—Ç–∏ CORS. –°–∫–∞—á–∞–π—Ç–µ CSV –∏–∑ Google Sheets –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∑–¥–µ—Å—å.
                </p>
                <div class="progress" id="csvProgress" style="display: none; margin-top: 10px;">
                    <div class="progress-bar" id="csvProgressBar"></div>
                    <div class="progress-text" id="csvProgressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
                </div>
                <div id="csvMessage"></div>
            </div>

            <!-- Demo –¥–∞–Ω–Ω—ã–µ -->
            <div class="demo-data">
                <h3 style="margin: 0 0 10px 0; color: white;"><i class="fas fa-play"></i> –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç</h3>
                <p style="margin: 0 0 15px 0; font-size: 14px; color: rgba(255,255,255,0.9);">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π</p>
                <button onclick="loadDemoData()">üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ (10 –∫–∞–º–ø–∞–Ω–∏–π)</button>
                <button onclick="loadFullDemo()">üìä –ü–æ–ª–Ω—ã–π –¥–µ–º–æ (50+ –∑–∞–ø–∏—Å–µ–π)</button>
                <div style="font-size: 12px; opacity: 0.8; margin-top: 10px;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –±–ª–æ–≥–µ—Ä–æ–≤, –∫–Ω–∏–≥–∏ –∏ –∫–∞–º–ø–∞–Ω–∏–∏</div>
            </div>

            <!-- –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö -->
            <details style="margin-top: 20px;">
                <summary style="cursor: pointer; padding: 10px; background: var(--light); border-radius: 6px; font-weight: 600;">
                    <i class="fas fa-info-circle"></i> üìã –¢—Ä–µ–±—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
                </summary>
                <div style="padding: 15px; background: #f8f9fa; border-radius: 6px; margin-top: 10px;">
                    <h4 style="margin-top: 0; color: var(--primary);">–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏:</h4>
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <tr><th style="border: 1px solid var(--border); padding: 8px; background: var(--primary); color: white;">–ö–æ–ª–æ–Ω–∫–∞</th><th style="border: 1px solid var(--border); padding: 8px;">–ü—Ä–∏–º–µ—Ä</th><th style="border: 1px solid var(--border); padding: 8px;">–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                        <tr><td style="border: 1px solid var(--border); padding: 8px; font-weight: bold;">–î–∞—Ç–∞</td><td style="border: 1px solid var(--border); padding: 8px;">2025-01-15</td><td style="border: 1px solid var(--border); padding: 8px;">–§–æ—Ä–º–∞—Ç YYYY-MM-DD</td></tr>
                        <tr><td style="border: 1px solid var(--border); padding: 8px; font-weight: bold;">–ë–ª–æ–≥–µ—Ä</td><td style="border: 1px solid var(--border); padding: 8px;">logoped.arshinova</td><td style="border: 1px solid var(--border); padding: 8px;">–ò–º—è –∏–ª–∏ –Ω–∏–∫ –±–ª–æ–≥–µ—Ä–∞</td></tr>
                        <tr><td style="border: 1px solid var(--border); padding: 8px; font-weight: bold;">–ö–Ω–∏–≥–∞</td><td style="border: 1px solid var(--border); padding: 8px;">–õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π</td><td style="border: 1px solid var(--border); padding: 8px;">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</td></tr>
                        <tr><td style="border: 1px solid var(--border); padding: 8px; font-weight: bold;">–°—Ç–æ–∏–º–æ—Å—Ç—å</td><td style="border: 1px solid var(--border); padding: 8px;">1500</td><td style="border: 1px solid var(--border); padding: 8px;">–ó–∞—Ç—Ä–∞—Ç—ã –≤ —Ä—É–±–ª—è—Ö</td></tr>
                        <tr><td style="border: 1px solid var(--border); padding: 8px; font-weight: bold;">–ß–ü —Å –∫–Ω–∏–≥–∏</td><td style="border: 1px solid var(--border); padding: 8px;">300</td><td style="border: 1px solid var(--border); padding: 8px;">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å —Å 1 –∫–Ω–∏–≥–∏</td></tr>
                        <tr><td style="border: 1px solid var(--border); padding: 8px; font-weight: bold;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</td><td style="border: 1px solid var(--border); padding: 8px;">10</td><td style="border: 1px solid var(--border); padding: 8px;">–ü—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥</td></tr>
                    </table>
                    <p style="margin-top: 15px; font-size: 13px; color: var(--dark);">
                        <i class="fas fa-lightbulb"></i> –ö–æ–ª–æ–Ω–∫–∏ –º–æ–≥—É—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Cost" –∏–ª–∏ "–°—Ç–æ–∏–º–æ—Å—Ç—å", "Date" –∏–ª–∏ "–î–∞—Ç–∞"). 
                        –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ. 
                        <strong>–ü–µ—Ä–≤—ã–µ 2 —Å—Ç—Ä–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –¥–∞–Ω–Ω—ã–µ.</strong>
                    </p>
                </div>
            </details>
        </div>

        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ (–∫–∞–∫ –≤ v7.3) -->
        <div id="bloggers" class="section tab-content">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –±–ª–æ–≥–µ—Ä–æ–≤</h2>
                <div style="display: flex; gap: 10px;">
                    <span class="toggle-btn" onclick="toggleSection('bloggersList')"><i class="fas fa-eye-slash"></i> –°–∫—Ä—ã—Ç—å</span>
                    <button class="add-btn" onclick="showAddBlogger()"><i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                    <button class="btn-close" onclick="deleteAllBloggers()" style="padding: 10px 12px;"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö</button>
                </div>
            </div>
            <div id="bloggersList"></div>
        </div>

        <div id="books" class="section tab-content">
            <div class="section-header">
                <h2><i class="fas fa-book"></i> –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–Ω–∏–≥</h2>
                <div style="display: flex; gap: 10px;">
                    <span class="toggle-btn" onclick="toggleSection('booksList')"><i class="fas fa-eye-slash"></i> –°–∫—Ä—ã—Ç—å</span>
                    <button class="add-btn" onclick="showAddBook()"><i class="fas fa-book-open"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                            <button class="btn-close" onclick="deleteAllBooks()" style="padding: 10px 12px;">
            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö
        </button>
    </div>
    <div id="booksList">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
</div>

<!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–π -->
<div id="campaigns" class="section tab-content">
    <div class="section-header">
        <h2><i class="fas fa-plus-circle"></i> –ù–æ–≤–∞—è –∫–∞–º–ø–∞–Ω–∏—è</h2>
        <div>
            <button class="add-btn" onclick="addCampaign()">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
            </button>
            <button class="btn-close" onclick="clearCampaignForm()">
                <i class="fas fa-eraser"></i> –û—á–∏—Å—Ç–∏—Ç—å
            </button>
        </div>
    </div>
    
    <div class="form-row">
        <div class="input-group">
            <label>–î–∞—Ç–∞ <span class="required">*</span>:</label>
            <input type="date" id="campaignDate" required>
        </div>
        <div class="input-group">
            <label>–ë–ª–æ–≥–µ—Ä <span class="required">*</span>:</label>
            <select id="campaignBlogger" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–≥–µ—Ä–∞</option>
            </select>
        </div>
        <div class="input-group">
            <label>–ö–Ω–∏–≥–∞ <span class="required">*</span>:</label>
            <select id="campaignBook" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É</option>
            </select>
        </div>
    </div>
    
    <div class="form-row">
        <div class="input-group">
            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å, —Ä—É–±. <span class="required">*</span>:</label>
            <input type="number" id="campaignCost" min="0" step="0.01" required placeholder="0.00">
        </div>
        <div class="input-group">
            <label>–ß–ü —Å –∫–Ω–∏–≥–∏, —Ä—É–±. <span class="required">*</span>:</label>
            <input type="number" id="campaignCP" min="0" step="0.01" required placeholder="0.00">
        </div>
        <div class="input-group">
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ <span class="required">*</span>:</label>
            <input type="number" id="campaignQty" min="1" required placeholder="1">
        </div>
    </div>
    
    <div class="preview-section" id="campaignPreview" style="display: none; margin-top: 15px; padding: 15px; background: var(--light); border-radius: 8px;">
        <h4 style="margin-top: 0; color: var(--secondary);">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</h4>
        <div id="previewMetrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 14px;"></div>
    </div>
</div>

<!-- –î–∞–Ω–Ω—ã–µ -->
<div id="data" class="section tab-content">
    <div class="section-header">
        <h2><i class="fas fa-table"></i> –ö–∞–º–ø–∞–Ω–∏–∏</h2>
        <div style="display: flex; gap: 10px; align-items: center;">
            <button class="add-btn" onclick="updateList()">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
            <button class="add-btn" onclick="applyFilters()">
                <i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä—ã
            </button>
            <button class="btn-close" onclick="clearFilters()">
                <i class="fas fa-eraser"></i> –°–±—Ä–æ—Å–∏—Ç—å
            </button>
            <span id="recordsCount" style="font-size: 14px; color: var(--dark);"></span>
        </div>
    </div>
    
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters-panel" id="filtersPanel" style="background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
        <div class="form-row">
            <div class="input-group">
                <label>–î–∞—Ç–∞ –æ—Ç:</label>
                <input type="date" id="filterDateFrom">
            </div>
            <div class="input-group">
                <label>–î–∞—Ç–∞ –¥–æ:</label>
                <input type="date" id="filterDateTo">
            </div>
            <div class="input-group">
                <label>–ë–ª–æ–≥–µ—Ä:</label>
                <select id="filterBlogger">
                    <option value="">–í—Å–µ</option>
                </select>
            </div>
            <div class="input-group">
                <label>–ö–Ω–∏–≥–∞:</label>
                <select id="filterBook">
                    <option value="">–í—Å–µ</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="input-group">
                <label>ROI –æ—Ç (%):</label>
                <input type="number" id="filterROIFrom" step="1" min="-100">
            </div>
            <div class="input-group">
                <label>ROI –¥–æ (%):</label>
                <input type="number" id="filterROITo" step="1">
            </div>
            <div class="input-group">
                <label>ROAS –æ—Ç:</label>
                <input type="number" id="filterROASFrom" step="0.1" min="0">
            </div>
            <div class="input-group">
                <label>ROAS –¥–æ:</label>
                <input type="number" id="filterROASTo" step="0.1">
            </div>
        </div>
        <div class="form-row">
            <div class="input-group">
                <label>CPS –æ—Ç (—Ä—É–±.):</label>
                <input type="number" id="filterCPSFrom" step="0.01" min="0">
            </div>
            <div class="input-group">
                <label>CPS –¥–æ (—Ä—É–±.):</label>
                <input type="number" id="filterCPSTo" step="0.01">
            </div>
            <div class="input-group" style="justify-self: end;">
                <button class="add-btn" onclick="applyFilters()" style="margin-top: 22px;">
                    <i class="fas fa-search"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
                <button class="btn-close" onclick="clearFilters()" style="margin-top: 22px;">
                    <i class="fas fa-times"></i> –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
    
    <button class="add-btn" onclick="toggleFilters()" id="toggleFiltersBtn" style="margin-bottom: 15px;">
        <i class="fas fa-filter"></i> –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
    </button>
    
    <div class="table-container">
        <div id="dataTableContainer">
            <div class="empty-state">
                <i class="fas fa-table" style="font-size: 4em; color: var(--warning); margin-bottom: 20px;"></i>
                <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                <p style="margin-bottom: 20px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel, CSV —Ñ–∞–π–ª –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–∞–º–ø–∞–Ω–∏—é –≤—Ä—É—á–Ω—É—é</p>
                <div>
                    <button class="add-btn" onclick="switchTab('load')" style="margin-right: 10px;">
                        <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                    <button class="add-btn" onclick="switchTab('campaigns')" style="background: var(--secondary);">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ê–Ω–∞–ª–∏–∑ -->
<div id="analysis" class="section tab-content">
    <div class="section-header">
        <h2><i class="fas fa-chart-bar"></i> –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
        <div>
            <button class="add-btn" onclick="analyzeTop()" id="analyzeBtn">
                <i class="fas fa-magic"></i> –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="add-btn" onclick="exportData()" style="background: var(--secondary); margin-left: 10px;">
                <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç Excel
            </button>
        </div>
    </div>
    
    <div id="analysisResults">
        <div class="empty-state">
            <i class="fas fa-chart-line" style="font-size: 4em; color: var(--secondary); margin-bottom: 20px;"></i>
            <h3>–ê–Ω–∞–ª–∏–∑ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–∞–º–ø–∞–Ω–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ROI, ROAS –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç–æ–ø–∞ –±–ª–æ–≥–µ—Ä–æ–≤</p>
            <button class="add-btn" onclick="switchTab('load')">
                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
    </div>
    
    <!-- –®–ø–∞—Ä–≥–∞–ª–∫–∞ -->
    <details style="margin-top: 30px; background: var(--light); padding: 15px; border-radius: 8px;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--dark); padding: 10px; border-bottom: 1px solid var(--border);">
            <i class="fas fa-info-circle" style="margin-right: 8px;"></i> üìã –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        </summary>
        <div style="padding-top: 15px;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                <div>
                    <h4 style="margin: 0 0 10px 0; color: var(--primary);"><i class="fas fa-percentage"></i> ROI (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å)</h4>
                    <p><code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-size: 13px;">(–ü—Ä–∏–±—ã–ª—å - –ó–∞—Ç—Ä–∞—Ç—ã) / –ó–∞—Ç—Ä–∞—Ç—ã √ó 100%</code></p>
                    <ul style="margin: 10px 0; padding-left: 20px; font-size: 14px;">
                        <li class="positive">>100% ‚Äî <strong>–û—Ç–ª–∏—á–Ω–æ!</strong> –ü—Ä–∏–±—ã–ª—å –≤ 2+ —Ä–∞–∑–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã</li>
                        <li class="neutral">10-100% ‚Äî <strong>–•–æ—Ä–æ—à–æ</strong> –ü—Ä–∏–±—ã–ª—å –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã</li>
                        <li class="negative"><0% ‚Äî <strong>–£–±—ã—Ç–æ–∫</strong> –ó–∞—Ç—Ä–∞—Ç—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç –ø—Ä–∏–±—ã–ª—å</li>
                    </ul>
                    <p class="tooltip"><strong>–ü—Ä–∏–º–µ—Ä:</strong> –ó–∞—Ç—Ä–∞—Ç—ã 1000 —Ä—É–±., –ü—Ä–∏–±—ã–ª—å 3000 —Ä—É–±. ‚Üí ROI = (3000-1000)/1000 √ó 100% = <strong>200%</strong> <span class="tooltiptext">–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</span></p>
                </div>
                
                <div>
                    <h4 style="margin: 0 0 10px 0; color: var(--secondary);"><i class="fas fa-calculator"></i> ROAS (–æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å)</h4>
                    <p><code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-size: 13px;">–ü—Ä–∏–±—ã–ª—å / –ó–∞—Ç—Ä–∞—Ç—ã</code></p>
                    <ul style="margin: 10px 0; padding-left: 20px; font-size: 14px;">
                        <li class="positive">>3.0 ‚Äî <strong>–°—É–ø–µ—Ä!</strong> –ö–∞–∂–¥—ã–π —Ä—É–±–ª—å –ø—Ä–∏–Ω–æ—Å–∏—Ç 3+ —Ä—É–±–ª—è –ø—Ä–∏–±—ã–ª–∏</li>
                        <li class="neutral">1.5-3.0 ‚Äî <strong>–•–æ—Ä–æ—à–æ</strong> –ü—Ä–∏–±—ã–ª—å –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã + –º–∞—Ä–∂–∞</li>
                        <li class="negative"><1.0 ‚Äî <strong>–£–±—ã—Ç–æ–∫</strong> –ó–∞—Ç—Ä–∞—Ç—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç –¥–æ—Ö–æ–¥</li>
                    </ul>
                    <p class="tooltip"><strong>–ü—Ä–∏–º–µ—Ä:</strong> –ó–∞—Ç—Ä–∞—Ç—ã 1000 —Ä—É–±., –ü—Ä–∏–±—ã–ª—å 3000 —Ä—É–±. ‚Üí ROAS = 3000/1000 = <strong>3.0</strong> <span class="tooltiptext">–û—Ç–ª–∏—á–Ω–∞—è –æ—Ç–¥–∞—á–∞!</span></p>
                </div>
                
                <div>
                    <h4 style="margin: 0 0 10px 0; color: var(--warning);"><i class="fas fa-coins"></i> CPS (—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è)</h4>
                    <p><code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-size: 13px;">–ó–∞—Ç—Ä–∞—Ç—ã / –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥</code></p>
                    <ul style="margin: 10px 0; padding-left: 20px; font-size: 14px;">
                        <li class="positive">CPS < –ß–ü ‚Äî <strong>–í—ã–≥–æ–¥–Ω–æ!</strong> –ö–∞–∂–¥–∞—è –ø—Ä–æ–¥–∞–∂–∞ –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø—Ä–∏–±—ã–ª—å</li>
                        <li class="neutral">CPS = –ß–ü ‚Äî <strong>–ù—É–ª–µ–≤–∞—è –ø—Ä–∏–±—ã–ª—å</strong> –ü–æ–∫—Ä—ã—Ç–∏–µ –∑–∞—Ç—Ä–∞—Ç –±–µ–∑ –º–∞—Ä–∂–∏</li>
                        <li class="negative">CPS > –ß–ü ‚Äî <strong>–£–±—ã—Ç–æ—á–Ω–æ</strong> –ö–∞–∂–¥–∞—è –ø—Ä–æ–¥–∞–∂–∞ –≤ –º–∏–Ω—É—Å–µ</li>
                    </ul>
                    <p class="tooltip"><strong>–ü—Ä–∏–º–µ—Ä:</strong> –ó–∞—Ç—Ä–∞—Ç—ã 1000 —Ä—É–±., –ü—Ä–æ–¥–∞–Ω–æ 10 –∫–Ω–∏–≥, –ß–ü 150 —Ä—É–±. ‚Üí CPS = 1000/10 = <strong>100 —Ä—É–±.</strong> <span class="tooltiptext">–í—ã–≥–æ–¥–Ω–æ! (100 < 150)</span></p>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid var(--warning);">
                <h4 style="margin: 0 0 10px 0; color: var(--warning);"><i class="fas fa-star"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏</h4>
                <ul style="margin: 10px 0; padding-left: 20px; font-size: 14px; line-height: 1.6;">
                    <li><strong>ROI > 200%</strong> –∏–ª–∏ <strong>ROAS > 3</strong> ‚Äî –±–ª–æ–≥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ, —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ –±—é–¥–∂–µ—Ç</li>
                    <li><strong>ROI 50-200%</strong> ‚Äî —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ</li>
                    <li><strong>ROI < 50%</strong> ‚Äî –Ω–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —É—Å–ª–æ–≤–∏—è –∏–ª–∏ —Å–º–µ–Ω–∏—Ç–µ –±–ª–æ–≥–µ—Ä–∞</li>
                    <li><strong>CPS –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –ß–ü</strong> ‚Äî –∏–Ω–∞—á–µ –∫–∞–∂–¥–∞—è –ø—Ä–æ–¥–∞–∂–∞ —É–±—ã—Ç–æ—á–Ω–∞</li>
                </ul>
                <p style="margin-top: 15px; font-style: italic; color: var(--dark);">
                    <strong>–ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—Ö–∞:</strong> ROI = 1869%, ROAS = 19.69 (logoped.arshinova) ‚Äî –∫–∞–∂–¥–∞—è –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–∞—è 1 —Ä—É–±–ª—å –ø—Ä–∏–Ω–µ—Å–ª–∞ 19.69 —Ä—É–±. —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏!
                </p>
            </div>
        </div>
    </details>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div id="addBloggerModal" class="form-popup">
    <div class="form-container">
        <div class="modal-header">
            <h3 id="bloggerModalTitle" class="modal-title"><i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞</h3>
            <button class="close-btn" onclick="hideAddBloggerModal()">&times;</button>
        </div>
        <div class="form-group full-width">
            <label>–ò–º—è –±–ª–æ–≥–µ—Ä–∞ <span class="required">*</span>:</label>
            <input type="text" id="bloggerName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: logoped.arshinova" maxlength="100" required>
            <small style="color: var(--dark); font-size: 12px;">–ú–∞–∫—Å–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∏–∫ –∏–ª–∏ –∏–º—è</small>
        </div>
        <div class="form-group full-width">
            <label>–°—Å—ã–ª–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
            <input type="url" id="bloggerLink" placeholder="https://t.me/username –∏–ª–∏ https://instagram.com/username">
            <small style="color: var(--dark); font-size: 12px;">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å Telegram, Instagram –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–∞–Ω–∞–ª</small>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="add-btn" id="saveBloggerBtn" onclick="saveBlogger()">
                <i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞
            </button>
            <button class="btn-close" onclick="hideAddBloggerModal()">
                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
</div>

<div id="addBookModal" class="form-popup">
    <div class="form-container">
        <div class="modal-header">
            <h3 id="bookModalTitle" class="modal-title"><i class="fas fa-book-open"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</h3>
            <button class="close-btn" onclick="hideAddBookModal()">&times;</button>
        </div>
        <div class="form-group full-width">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ <span class="required">*</span>:</label>
            <input type="text" id="bookName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π" maxlength="150" required>
            <small style="color: var(--dark); font-size: 12px;">–ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ (–¥–æ 150 —Å–∏–º–≤–æ–ª–æ–≤)</small>
        </div>
        <div class="form-group full-width">
            <label>–ß–ü —Å –∫–Ω–∏–≥–∏, —Ä—É–±. <span class="required">*</span>:</label>
            <input type="number" id="bookCP" min="0" step="0.01" placeholder="0.00" required>
            <small style="color: var(--dark); font-size: 12px;">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å —Å –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤</small>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="add-btn" id="saveBookBtn" onclick="saveBook()">
                <i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
            </button>
            <button class="btn-close" onclick="hideAddBookModal()">
                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
</div>

<div id="editCampaignModal" class="form-popup">
    <div class="form-container">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é</h3>
            <button class="close-btn" onclick="hideEditCampaignModal()">&times;</button>
        </div>
        <div class="form-row">
            <div class="input-group">
                <label>–î–∞—Ç–∞ <span class="required">*</span>:</label>
                <input type="date" id="editDate" required>
            </div>
            <div class="input-group">
                <label>–ë–ª–æ–≥–µ—Ä <span class="required">*</span>:</label>
                <select id="editBlogger" required></select>
            </div>
            <div class="input-group">
                <label>–ö–Ω–∏–≥–∞ <span class="required">*</span>:</label>
                <select id="editBook" required></select>
            </div>
        </div>
        <div class="form-row">
            <div class="input-group">
                <label>–°—Ç–æ–∏–º–æ—Å—Ç—å, —Ä—É–±. <span class="required">*</span>:</label>
                <input type="number" id="editCost" min="0" step="0.01" required placeholder="0.00">
            </div>
            <div class="input-group">
                <label>–ß–ü —Å –∫–Ω–∏–≥–∏, —Ä—É–±. <span class="required">*</span>:</label>
                <input type="number" id="editCP" min="0" step="0.01" required placeholder="0.00">
            </div>
            <div class="input-group">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ <span class="required">*</span>:</label>
                <input type="number" id="editQty" min="1" required placeholder="1">
            </div>
        </div>
        <div id="editPreview" style="margin-top: 15px; padding: 15px; background: var(--light); border-radius: 8px; display: none;"></div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="add-btn" id="saveCampaignEditBtn" onclick="saveCampaignEdit()">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
            <button class="btn-close" onclick="hideEditCampaignModal()">
                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
</div>

<div id="resetModal" class="form-popup">
    <div class="form-container">
        <div class="modal-header">
            <h3 class="modal-title" style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å</h3>
            <button class="close-btn" onclick="hideResetModal()">&times;</button>
        </div>
        <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h4 style="margin-top: 0; color: var(--danger);">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–ï–û–ë–†–ê–¢–ò–ú–û–ï –î–ï–ô–°–¢–í–ò–ï</h4>
            <ul style="margin: 15px 0; padding-left: 20px;">
                <li><strong>üóëÔ∏è –£–¥–∞–ª–∏—Ç –≤—Å–µ—Ö –±–ª–æ–≥–µ—Ä–æ–≤ ({{bloggers.length}})</strong></li>
                <li><strong>üìö –£–¥–∞–ª–∏—Ç –≤—Å–µ –∫–Ω–∏–≥–∏ ({{books.length}})</strong></li>
                <li><strong>üìä –£–¥–∞–ª–∏—Ç –≤—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ ({{campaigns.length}})</strong></li>
                <li><strong>üíæ –û—á–∏—Å—Ç–∏—Ç localStorage –ø–æ–ª–Ω–æ—Å—Ç—å—é</strong></li>
            </ul>
            <p style="margin-top: 15px; font-weight: 600;">–ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!</p>
        </div>
        <div class="form-group full-width">
            <label>–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ <span class="required">*</span>:</label>
            <input type="password" id="resetPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" maxlength="20" required>
            <small style="color: var(--warning);">–ü–∞—Ä–æ–ª—å: <code>admin</code> (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–¥–µ)</small>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn-close" id="confirmResetBtn" onclick="confirmReset()" disabled style="padding: 12px 20px;">
                <i class="fas fa-bomb"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–±—Ä–æ—Å
            </button>
            <button class="add-btn" onclick="hideResetModal()">
                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
</div>

<!-- –ö–æ–Ω–µ—Ü HTML -->
</div>

<script>
// ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
let bloggers = JSON.parse(localStorage.getItem('bloggers') || '[]');
let books = JSON.parse(localStorage.getItem('books') || '[]');
let campaigns = JSON.parse(localStorage.getItem('campaigns') || '[]');
let dataLoaded = false;
let currentEditIndex = -1;
let editingType = null; // 'blogger', 'book', 'campaign'

// –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const demoData = {
    bloggers: [
        { name: 'logoped.arshinova', link: 'https://t.me/logoped_arshinova' },
        { name: 'defectologist_kids', link: 'https://instagram.com/defectologist_kids' },
        { name: 'speech_therapy_pro', link: '' },
        { name: 'pedagog_anna', link: 'https://t.me/pedagog_anna' },
        { name: 'logoped_maria', link: '' }
    ],
    books: [
        { name: '–õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π', cp: 350 },
        { name: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è —Ä–µ—á–∏', cp: 420 },
        { name: '–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏', cp: 280 },
        { name: '–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞', cp: 180 },
        { name: '–£—Ä–æ–∫–∏ –ª–æ–≥–æ–ø–µ–¥–∞', cp: 320 }
    ],
    campaigns: [
        { date: '2025-01-15', blogger: 'logoped.arshinova', book: '–õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π', cost: 1500, cp: 350, qty: 12 },
        { date: '2025-01-12', blogger: 'defectologist_kids', book: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è —Ä–µ—á–∏', cost: 2200, cp: 420, qty: 8 },
        { date: '2025-01-10', blogger: 'speech_therapy_pro', book: '–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏', cost: 800, cp: 280, qty: 15 },
        { date: '2025-01-08', blogger: 'pedagog_anna', book: '–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞', cost: 1200, cp: 180, qty: 20 },
        { date: '2025-01-05', blogger: 'logoped_maria', book: '–£—Ä–æ–∫–∏ –ª–æ–≥–æ–ø–µ–¥–∞', cost: 900, cp: 320, qty: 6 }
    ]
};

// ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
function initApp() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è v7.4 - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    console.log('üìö SheetJS:', typeof XLSX !== 'undefined' ? '‚úì –ó–∞–≥—Ä—É–∂–µ–Ω' : '‚úó –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
    console.log('üíæ localStorage: –¥–æ—Å—Ç—É–ø–µ–Ω');
    console.log('üìä –î–∞–Ω–Ω—ã–µ: –±–ª–æ–≥–µ—Ä–æ–≤=' + bloggers.length + ', –∫–Ω–∏–≥=' + books.length + ', –∫–∞–º–ø–∞–Ω–∏–π=' + campaigns.length);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM
    const required = ['csvUrl', 'excelFile', 'csvFile', 'bloggersList', 'booksList', 'dataTableContainer', 'analysisResults'];
    let allReady = true;
    
    required.forEach(function(id) {
        if (!document.getElementById(id)) {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:', id);
            allReady = false;
        }
    });
    
    if (!allReady) {
        setTimeout(initApp, 500);
        return;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
    setupDateInputs();
    populateSelects();
    renderBloggers();
    renderBooks();
    updateList();
    updateCounters();
    updateResetModal();
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.getElementById('campaignDate').valueAsDate = new Date();
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É
    switchTab('load');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
    if (campaigns.length === 0 && !localStorage.getItem('demoShown')) {
        showWelcomeMessage();
    }
    
    console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
}

// ==================== –ù–ê–°–¢–†–û–ô–ö–ê ====================
function setupDateInputs() {
    const dateInputs = document.querySelectorAll('input[type="date"]');
    dateInputs.forEach(function(input) {
        input.addEventListener('change', function() {
            updateCampaignPreview();
        });
    });
    
    // –§–∏–ª—å—Ç—Ä—ã –¥–∞—Ç
    const filterDates = ['filterDateFrom', 'filterDateTo'];
    filterDates.forEach(function(id) {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('change', function() {
                if (id === 'filterDateFrom' && this.value) {
                    document.getElementById('filterDateTo').min = this.value;
                } else if (id === 'filterDateTo' && this.value) {
                    document.getElementById('filterDateFrom').max = this.value;
                }
            });
        }
    });
}

function updateCampaignPreview() {
    const date = document.getElementById('campaignDate').value;
    const blogger = document.getElementById('campaignBlogger').value;
    const book = document.getElementById('campaignBook').value;
    const cost = parseFloat(document.getElementById('campaignCost').value) || 0;
    const cp = parseFloat(document.getElementById('campaignCP').value) || 0;
    const qty = parseInt(document.getElementById('campaignQty').value) || 0;
    
    const preview = document.getElementById('campaignPreview');
    const metrics = document.getElementById('previewMetrics');
    
    if (!date || !blogger || !book || cost <= 0 || cp <= 0 || qty <= 0) {
        preview.style.display = 'none';
        return;
    }
    
    const revenue = cp * qty;
    const profit = revenue - cost;
    const roi = cost > 0 ? (profit / cost * 100).toFixed(1) : 0;
    const roas = cost > 0 ? (revenue / cost).toFixed(2) : 0;
    const cps = qty > 0 ? (cost / qty).toFixed(2) : 0;
    
    const roiClass = roi > 100 ? 'positive' : roi > 0 ? 'neutral' : 'negative';
    
    metrics.innerHTML = `
        <div class="metric-item">
            <span class="metric-label">–í—ã—Ä—É—á–∫–∞:</span>
            <span class="positive">${revenue.toFixed(0)} —Ä—É–±.</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">–ü—Ä–∏–±—ã–ª—å:</span>
            <span class="${profit > 0 ? 'positive' : 'negative'}">${profit > 0 ? '+' : ''}${profit.toFixed(0)} —Ä—É–±.</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">ROI:</span>
            <span class="${roiClass}">${roi > 0 ? '+' : ''}${roi}%</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">ROAS:</span>
            <span class="positive">${roas}x</span>
        </div>
        <div class="metric-item">
            <span class="metric-label">CPS:</span>
            <span>${cps} —Ä—É–±./—à—Ç.</span>
        </div>
        <div style="margin-top: 10px; padding: 10px; background: ${roi > 100 ? '#d4edda' : roi > 0 ? '#fff3cd' : '#f8d7da'}; border-radius: 6px; font-size: 13px;">
            ${roi > 100 ? '‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è! ROI ' + roi + '%' : roi > 0 ? '‚ö†Ô∏è –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. ROI ' + roi + '%' : '‚ùå –£–±—ã—Ç–æ—á–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è. ROI ' + roi + '%'}
        </div>
    `;
    
    preview.style.display = 'block';
}

// ==================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ====================
function switchTab(tabId) {
    console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏:', tabId);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(function(tab) {
        tab.classList.remove('active');
    });
    
    // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
    const buttons = document.querySelectorAll('.tab-btn');
    buttons.forEach(function(btn) {
        btn.classList.remove('active');
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω–æ–≤—É—é
    const activeTab = document.getElementById(tabId);
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
    if (activeButton) {
        activeButton.classList.add('active');
    }
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
    if (tabId === 'data') {
        updateList();
    } else if (tabId === 'analysis' && campaigns.length > 0) {
        analyzeTop();
    } else if (tabId === 'campaigns') {
        populateSelects();
        document.getElementById('campaignDate').valueAsDate = new Date();
        updateCampaignPreview();
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    localStorage.setItem('activeTab', tabId);
    
    console.log('‚úì –í–∫–ª–∞–¥–∫–∞', tabId, '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
}

// ==================== –ó–ê–ì–†–£–ó–ö–ê GOOGLE SHEETS ====================
function loadFromSheets() {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ Google Sheets...');
    
    const urlInput = document.getElementById('csvUrl');
    const btn = document.getElementById('loadSheetsBtn');
    const progress = document.getElementById('sheetsProgress');
    const progressBar = document.getElementById('sheetsProgressBar');
    const progressText = document.getElementById('sheetsProgressText');
    const message = document.getElementById('sheetsMessage');
    const status = document.getElementById('sheetsStatus');
    
    if (!urlInput || !btn || !progress || !progressBar || !progressText || !message || !status) {
        console.error('–≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
        return;
    }
    
    const url = urlInput.value.trim();
    if (!url) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ Google Sheets', 'error', 'sheetsMessage');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏
    if (!url.includes('docs.google.com/spreadsheets')) {
        showMessage('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Google Sheets', 'error', 'sheetsMessage');
        return;
    }
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º CSV URL
    let csvUrl;
    try {
        // –£–±–∏—Ä–∞–µ–º /edit –µ—Å–ª–∏ –µ—Å—Ç—å
        let cleanUrl = url.replace(/\/edit.*$/, '');
        // –î–æ–±–∞–≤–ª—è–µ–º /pub?output=csv –µ—Å–ª–∏ –Ω–µ—Ç
        if (!cleanUrl.includes('/pub?output=csv')) {
            cleanUrl += '/pub?output=csv';
        }
        csvUrl = cleanUrl;
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è URL:', e);
        showMessage('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å—Å—ã–ª–∫–∏', 'error', 'sheetsMessage');
        return;
    }
    
    console.log('CSV URL:', csvUrl);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞...';
    progress.style.display = 'block';
    status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞';
    status.className = 'status-indicator status-loading';
    message.innerHTML = '';
    
    progressBar.style.width = '10%';
    progressText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google...';
    
    // –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ (fallback)
    loadSheetsWithFallback(csvUrl, 0);
}

function loadSheetsWithFallback(csvUrl, attempt = 0) {
    const methods = [
        // –ú–µ—Ç–æ–¥ 1: –ü—Ä—è–º–æ–π fetch
        function() {
            return fetch(csvUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .catch(error => {
                    console.warn('–ú–µ—Ç–æ–¥ 1 (fetch) –Ω–µ —É–¥–∞–ª—Å—è:', error.message);
                    throw error;
                });
        },
        // –ú–µ—Ç–æ–¥ 2: YQL (–æ–±—Ö–æ–¥ CORS)
        function() {
            const yqlUrl = `https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20csv%20where%20url%3D%22${encodeURIComponent(csvUrl)}%22&format=json`;
            return fetch(yqlUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.query && data.query.results && data.query.results.row) {
                        const rows = Array.isArray(data.query.results.row) ? data.query.results.row : [data.query.results.row];
                        return rows.map(row => Object.values(row).join(',')).join('\n');
                    }
                    throw new Error('YQL –Ω–µ —Å–º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
                })
                .catch(error => {
                    console.warn('–ú–µ—Ç–æ–¥ 2 (YQL) –Ω–µ —É–¥–∞–ª—Å—è:', error.message);
                    throw error;
                });
        },
        // –ú–µ—Ç–æ–¥ 3: CORS proxy (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        function() {
            const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(csvUrl);
            return fetch(proxyUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Proxy error: ${response.status}`);
                    }
                    return response.text();
                })
                .catch(error => {
                    console.warn('–ú–µ—Ç–æ–¥ 3 (CORS proxy) –Ω–µ —É–¥–∞–ª—Å—è:', error.message);
                    throw error;
                });
        }
    ];
    
    if (attempt >= methods.length) {
        showSheetsError('–í—Å–µ –º–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å CSV —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ.');
        return;
    }
    
    const method = methods[attempt];
    console.log(`–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–æ–¥–æ–º ${attempt + 1}...`);
    
    method()
        .then(csvData => {
            progressBar.style.width = '80%';
            progressText.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
            
            // –ü–∞—Ä—Å–∏–º CSV
            return parseCSV(csvData, 'google_sheets');
        })
        .then(result => {
            progressBar.style.width = '100%';
            progressText.textContent = '–ì–æ—Ç–æ–≤–æ!';
            
            setTimeout(() => {
                progress.style.display = 'none';
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-check"></i> –ó–∞–≥—Ä—É–∂–µ–Ω–æ';
                status.innerHTML = '<i class="fas fa-check"></i> –ì–æ—Ç–æ–≤–æ';
                status.className = 'status-indicator status-success';
                
                showMessage(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${result.count} –∫–∞–º–ø–∞–Ω–∏–π!`, 'success', 'sheetsMessage');
                
                dataLoaded = true;
                updateList();
                updateCounters();
                switchTab('data');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —É—Å–ø–µ—à–Ω—É—é —Å—Å—ã–ª–∫—É
                localStorage.setItem('lastSheetsUrl', document.getElementById('csvUrl').value);
                
            }, 1000);
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Sheets:', error);
            progressBar.style.width = '0%';
            progressText.textContent = '–û—à–∏–±–∫–∞';
            
            setTimeout(() => {
                // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Ç–æ–¥
                loadSheetsWithFallback(csvUrl, attempt + 1);
            }, 500);
        });
}

function showSheetsError(message) {
    const btn = document.getElementById('loadSheetsBtn');
    const progress = document.getElementById('sheetsProgress');
    const status = document.getElementById('sheetsStatus');
    const messageDiv = document.getElementById('sheetsMessage');
    
    if (btn) {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-file-csv"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
    }
    
    if (progress) progress.style.display = 'none';
    if (status) {
        status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞';
        status.className = 'status-indicator status-error';
    }
    
    showMessage(message + '<br><br><strong>–†–µ—à–µ–Ω–∏–µ:</strong><br>‚Ä¢ –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ (–∫–Ω–æ–ø–∫–∞ –Ω–∏–∂–µ)<br>‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –ø—É–±–ª–∏—á–Ω–æ', 'error', 'sheetsMessage');
}

// ==================== –ó–ê–ì–†–£–ó–ö–ê EXCEL ====================
function handleExcelFile(event) {
    console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ Excel —Ñ–∞–π–ª–∞...');
    
    const file = event.target.files[0];
    const messageDiv = document.getElementById('excelMessage');
    const status = document.getElementById('excelStatus');
    const progress = document.getElementById('excelProgress');
    const progressBar = document.getElementById('excelProgressBar');
    const progressText = document.getElementById('excelProgressText');
    const fileInfo = document.getElementById('fileInfo');
    
    if (!file) {
        // –û—á–∏—Å—Ç–∫–∞
        if (fileInfo) fileInfo.innerHTML = '';
        return;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
    if (!file.name.match(/\.(xlsx?|xls)$/i)) {
        showMessage('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx –∏–ª–∏ .xls)', 'error', 'excelMessage');
        event.target.value = '';
        return;
    }
    
    if (file.size > 10 * 1024 * 1024) {
        showMessage('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 10MB)', 'error', 'excelMessage');
        event.target.value = '';
        return;
    }
    
    console.log('‚úÖ –§–∞–π–ª –≤—ã–±—Ä–∞–Ω:', file.name, file.size);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    if (fileInfo) {
        fileInfo.innerHTML = `
            <i class="fas fa-file-excel" style="color: var(--success); margin-right: 5px;"></i>
            ${file.name} 
            <span style="font-size: 12px; color: var(--dark);">
                (${(file.size / 1024).toFixed(1)} –ö–ë)
            </span>
        `;
    }
    
    // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    if (status) {
        status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...';
        status.className = 'status-indicator status-loading';
    }
    
    if (progress) progress.style.display = 'block';
    if (progressBar) progressBar.style.width = '10%';
    if (progressText) progressText.textContent = '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...';
    if (messageDiv) messageDiv.innerHTML = '';
    
    const reader = new FileReader();
    
    reader.onerror = function() {
        console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è Excel —Ñ–∞–π–ª–∞');
        showMessage('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç.', 'error', 'excelMessage');
        resetExcelState();
    };
    
    reader.onprogress = function(e) {
        if (e.lengthComputable) {
            const percent = Math.round((e.loaded / e.total) * 30); // 0-30%
            if (progressBar) progressBar.style.width = percent + '%';
            if (progressText) progressText.textContent = `–ß—Ç–µ–Ω–∏–µ: ${percent}%`;
        }
    };
    
    reader.onload = function(e) {
        try {
            console.log('üîÑ –ü–∞—Ä—Å–∏–Ω–≥ Excel...');
            
            if (progressText) progressText.textContent = '–ü–∞—Ä—Å–∏–Ω–≥ Excel...';
            if (progressBar) progressBar.style.width = '35%';
            
            // –ß–∏—Ç–∞–µ–º workbook
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { 
                type: 'array',
                cellDates: true,
                cellNF: false,
                defval: '',
                raw: false
            });
            
            if (progressBar) progressBar.style.width = '50%';
            if (progressText) progressText.textContent = '–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...';
            
            // –í—ã–±–∏—Ä–∞–µ–º –ª–∏—Å—Ç
            const sheetNames = workbook.SheetNames;
            let targetSheet = sheetNames[0];
            
            // –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–æ–≤
            const preferred = ['–¥–∞–Ω–Ω—ã–µ', 'data', '–∫–∞–º–ø–∞–Ω–∏–∏', 'campaigns', 'main', '–æ—Å–Ω–æ–≤–Ω—ã–µ'];
            for (let name of preferred) {
                if (sheetNames.includes(name)) {
                    targetSheet = name;
                    break;
                }
            }
            
            const worksheet = workbook.Sheets[targetSheet];
            if (!worksheet) {
                throw new Error(`–õ–∏—Å—Ç "${targetSheet}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
            }
            
            if (progressText) progressText.textContent = '–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –¥–∞–Ω–Ω—ã–µ...';
            if (progressBar) progressBar.style.width = '60%';
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ JSON –¥–ª—è –ª—É—á—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
            const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                header: 1,
                defval: '',
                raw: false,
                dateNF: 'dd.mm.yyyy' // Excel —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç
            });
            
            if (progressText) progressText.textContent = `–ù–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–æ–∫: ${jsonData.length}`;
            if (progressBar) progressBar.style.width = '70%';
            
            if (jsonData.length < 2) {
                throw new Error('–í —Ñ–∞–π–ª–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö');
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π CSV
            const csvData = XLSX.utils.sheet_to_csv(worksheet, {
                FS: ',',
                RS: '\r\n',
                dateNF: 'yyyy-mm-dd', // –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                strip: true,
                blankrows: false
            });
            
            // –ü–∞—Ä—Å–∏–º
            if (progressText) progressText.textContent = '–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥...';
            if (progressBar) progressBar.style.width = '80%';
            
            return parseCSV(csvData, 'excel', {
                filename: file.name,
                sheetName: targetSheet,
                totalRows: jsonData.length,
                parsedHeaders: jsonData[0]
            });
            
        } catch (parseError) {
            console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Excel:', parseError);
            showMessage(
                '<strong>–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ Excel:</strong><br>' +
                parseError.message +
                '<br><br><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</strong><br>' +
                '‚Ä¢ –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ (–º–∏–Ω–∏–º—É–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ + 1 —Å—Ç—Ä–æ–∫–∞)<br>' +
                '‚Ä¢ –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD –∏–ª–∏ dd.mm.yyyy<br>' +
                '‚Ä¢ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã<br>' +
                '‚Ä¢ –ù–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫',
                'error', 'excelMessage'
            );
            resetExcelState();
        }
    };
    
    reader.readAsArrayBuffer(file);
}

function resetExcelState() {
    const progress = document.getElementById('excelProgress');
    const fileInput = document.getElementById('excelFile');
    const fileInfo = document.getElementById('fileInfo');
    const status = document.getElementById('excelStatus');
    
    if (progress) progress.style.display = 'none';
    if (fileInput) fileInput.value = '';
    if (fileInfo) fileInfo.innerHTML = '';
    if (status) {
        status.innerHTML = '<i class="fas fa-times"></i> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
        status.className = 'status-indicator status-error';
    }
}

// ==================== –ó–ê–ì–†–£–ó–ö–ê –õ–û–ö–ê–õ–¨–ù–û–ì–û CSV ====================
function handleCsvFile(event) {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ CSV...');
    
    const file = event.target.files[0];
    const messageDiv = document.getElementById('csvMessage');
    const status = document.getElementById('csvStatus');
    const progress = document.getElementById('csvProgress');
    const progressBar = document.getElementById('csvProgressBar');
    const progressText = document.getElementById('csvProgressText');
    const fileInfo = document.getElementById('csvFileInfo');
    
    if (!file) {
        if (fileInfo) fileInfo.innerHTML = '';
        return;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (file.size > 5 * 1024 * 1024) {
        showMessage('CSV —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 5MB)', 'error', 'csvMessage');
        event.target.value = '';
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    if (fileInfo) {
        fileInfo.innerHTML = `
            <i class="fas fa-file-csv" style="color: var(--success); margin-right: 5px;"></i>
            ${file.name} 
            <span style="font-size: 12px; color: var(--dark);">
                (${(file.size / 1024).toFixed(1)} –ö–ë)
            </span>
        `;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    if (status) {
        status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ß—Ç–µ–Ω–∏–µ CSV...';
        status.className = 'status-indicator status-loading';
    }
    
    if (progress) progress.style.display = 'block';
    if (progressBar) progressBar.style.width = '30%';
    if (progressText) progressText.textContent = '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...';
    if (messageDiv) messageDiv.innerHTML = '';
    
    const reader = new FileReader();
    
    reader.onerror = function() {
        showMessage('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è CSV —Ñ–∞–π–ª–∞', 'error', 'csvMessage');
        resetCsvState();
    };
    
    reader.onload = function(e) {
        try {
            const csvData = e.target.result;
            if (!csvData || csvData.trim() === '') {
                throw new Error('CSV —Ñ–∞–π–ª –ø—É—Å—Ç');
            }
            
            if (progressText) progressText.textContent = '–ü–∞—Ä—Å–∏–Ω–≥ CSV...';
            if (progressBar) progressBar.style.width = '60%';
            
            parseCSV(csvData, 'csv_file', {
                filename: file.name,
                encoding: file.encoding || 'UTF-8'
            })
            .then(result => {
                if (progress) progress.style.display = 'none';
                
                if (status) {
                    status.innerHTML = '<i class="fas fa-check"></i> –ì–æ—Ç–æ–≤–æ';
                    status.className = 'status-indicator status-success';
                }
                
                showMessage(`‚úÖ CSV –∑–∞–≥—Ä—É–∂–µ–Ω: ${result.count} –∑–∞–ø–∏—Å–µ–π —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ`, 'success', 'csvMessage');
                
                dataLoaded = true;
                updateList();
                updateCounters();
                switchTab('data');
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
                event.target.value = '';
                if (fileInfo) fileInfo.innerHTML = `
                    <i class="fas fa-check-circle" style="color: var(--success); margin-right: 5px;"></i>
                    ${file.name} 
                    <span style="font-size: 12px; color: var(--success);">
                        ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.count} –∑–∞–ø–∏—Å–µ–π
                    </span>
                `;
                
                // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (fileInfo) fileInfo.innerHTML = `
                        <i class="fas fa-check-circle" style="color: var(--success); margin-right: 5px;"></i>
                        ${file.name} 
                        <span style="font-size: 11px; color: var(--dark);">‚úì –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ</span>
                    `;
                }, 3000);
                
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV:', error);
                showMessage(error.message, 'error', 'csvMessage');
                resetCsvState();
            });
            
        } catch (error) {
            console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ Excel/CSV:', error);
            showMessage('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞', 'error', 'csvMessage');
            resetCsvState();
        }
    };
    
    reader.readAsText(file, 'UTF-8');
}

function resetCsvState() {
    const progress = document.getElementById('csvProgress');
    const fileInput = document.getElementById('csvFile');
    const fileInfo = document.getElementById('csvFileInfo');
    const status = document.getElementById('csvStatus');
    
    if (progress) progress.style.display = 'none';
    if (fileInput && fileInput.value) fileInput.value = '';
    if (fileInfo) fileInfo.innerHTML = '';
    if (status) {
        status.innerHTML = '<i class="fas fa-times"></i> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
        status.className = 'status-indicator status-error';
    }
}

// ==================== –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–´–ô –ü–ê–†–°–ï–† CSV/EXCEL ====================
function parseCSV(csvData, source = 'unknown', options = {}) {
    console.log('–ü–∞—Ä—Å–µ—Ä CSV/Excel –∑–∞–ø—É—â–µ–Ω:', source, '—Å—Ç—Ä–æ–∫:', csvData.split('\n').length);
    
    try {
        // –£–¥–∞–ª—è–µ–º BOM –µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
        if (csvData.charCodeAt(0) === 0xFEFF) {
            csvData = csvData.substring(1);
        }
        
        // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏, —É–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ
        let lines = csvData.split('\n')
            .map(line => line.trim())
            .filter(line => line.length > 0);
            
        if (lines.length < 2) {
            throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–æ–∫: –Ω—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –º–∏–Ω–∏–º—É–º 1 —Å—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö');
        }
        
        console.log('üìä CSV –ø–∞—Ä—Å–∏–Ω–≥: –Ω–∞–π–¥–µ–Ω–æ', lines.length - 1, '—Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö');
        
        // –ü–∞—Ä—Å–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        let headers = parseCSVLine(lines[0]);
        console.log('üìã –ó–∞–≥–æ–ª–æ–≤–∫–∏ CSV:', headers);
        
        // –ù–∞—Ö–æ–¥–∏–º –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        const columnMap = {
            date: findColumnIndex(headers, ['date', '–¥–∞—Ç–∞', '–¥–µ–Ω—å', 'day']),
            blogger: findColumnIndex(headers, ['blogger', '–±–ª–æ–≥–µ—Ä', 'influencer']),
            book: findColumnIndex(headers, ['book', '–∫–Ω–∏–≥–∞', 'title', '–Ω–∞–∑–≤–∞–Ω–∏–µ']),
            cost: findColumnIndex(headers, ['cost', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', 'expense', '–∑–∞—Ç—Ä–∞—Ç—ã']),
            profit: findColumnIndex(headers, ['profit', '–ø—Ä–∏–±—ã–ª—å', 'revenue', '–¥–æ—Ö–æ–¥']),
            quantity: findColumnIndex(headers, ['quantity', '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'qty', '—à—Ç', 'count'])
        };
        
        console.log('üîç –ê–≤—Ç–æ—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫:', columnMap);
        
        // –°—Ç—Ä–æ–∏–º –º–∞—Å—Å–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ (—Å—Ç—Ä–æ–∫–∏ 2+)
        let parsedCampaigns = [];
        let validRows = 0;
        let skippedRows = 0;
        let skippedReasons = new Map();
        
        for (let i = 1; i < lines.length; i++) {
            try {
                const line = lines[i];
                const cells = parseCSVLine(line);
                
                if (cells.length < 3) { // –ú–∏–Ω–∏–º—É–º –¥–∞—Ç–∞, –±–ª–æ–≥–µ—Ä, –∫–Ω–∏–≥–∞
                    skippedReasons.set('too_few_columns', (skippedReasons.get('too_few_columns') || 0) + 1);
                    skippedRows++;
                    continue;
                }
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const row = {
                    date: getCellValue(cells, columnMap.date, i + 1),
                    blogger: getCellValue(cells, columnMap.blogger, i + 1),
                    book: getCellValue(cells, columnMap.profit, i + 1),
                    cost: parseFloat(getCellValue(cells, columnMap.cost, i + 1)) || 0,
                    cp: parseFloat(getCellValue(cells, columnMap.profit, i + 1)) || 0,
                    qty: parseInt(getCellValue(cells, columnMap.quantity, i + 1)) || 0
                };
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è
                const validation = validateRow(row, cells, i + 1, columnMap);
                if (!validation.isValid) {
                    skippedReasons.set(validation.reason, (skippedReasons.get(validation.reason) || 0) + 1);
                    skippedRows++;
                    continue;
                }
                
                parsedCampaigns.push(row);
                validRows++;
                
            } catch (cellError) {
                console.warn(`–°—Ç—Ä–æ–∫–∞ ${i + 1}:`, cellError.message);
                skippedReasons.set('parse_error', (skippedReasons.get('parse_error') || 0) + 1);
                skippedRows++;
            }
        }
        
        if (parsedCampaigns.length === 0) {
            throw new Error(`–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–ø—É—â–µ–Ω–æ ${skippedRows} —Å—Ç—Ä–æ–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç:` +
                `\n‚Ä¢ –î–∞—Ç–∞: YYYY-MM-DD` +
                `\n‚Ä¢ –ë–ª–æ–≥–µ—Ä: —Ç–µ–∫—Å—Ç (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)` +
                `\n‚Ä¢ –ö–Ω–∏–≥–∞: —Ç–µ–∫—Å—Ç` +
                `\n‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: —á–∏—Å–ª–æ > 0` +
                `\n‚Ä¢ –ß–ü: —á–∏—Å–ª–æ > 0` +
                `\n‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ > 0`);
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º
        campaigns = parsedCampaigns;
        localStorage.setItem('campaigns', JSON.stringify(campaigns));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        extractBloggersBooks();
        dataLoaded = true;
        
        console.log(`‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω:`);
        console.log(`   üìä –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: ${lines.length - 1}`);
        console.log(`   ‚úì –í–∞–ª–∏–¥–Ω—ã—Ö: ${validRows}`);
        console.log(`   ‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skippedRows}`);
        
        if (skippedReasons.size > 0) {
            console.log(`üìã –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∞:`);
            skippedReasons.forEach(function(count, reason) {
                console.log(`   ${reason}: ${count}`);
            });
        }
        
        return {
            success: true,
            count: validRows,
            totalRows: lines.length - 1,
            skipped: skippedRows,
            source: source
        };
        
    } catch (error) {
        console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', error);
        throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ${source}: ${error.message}`);
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞
function parseCSVLine(line) {
    let inQuotes = false;
    let field = '';
    let result = [];
    
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
            inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
            result.push(field);
            field = '';
        } else {
            field += char;
        }
    }
    
    result.push(field); // –ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ª–µ
    return result.map(field => field.trim());
}

function getCellValue(cells, colIndex, rowNum) {
    if (colIndex >= 0 && colIndex < cells.length) {
        let value = cells[colIndex];
        
        // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ
        if (!value || value.trim() === '') {
            return '';
        }
        
        // –£–±–∏—Ä–∞–µ–º –∫–∞–≤—ã—á–∫–∏
        value = value.replace(/^"|"$/g, '');
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç –∏–∑ Excel (—á–∏—Å–ª–∞)
        if (!isNaN(value) && value > 25569) {
            const date = new Date((value - 25569) * 86400 * 1000);
            if (date instanceof Date && !isNaN(date)) {
                return date.toISOString().split('T')[0]; // YYYY-MM-DD
            }
        }
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
        return value;
    }
    
    return '';
}

function findColumnIndex(headers, keywords) {
    const indexes = [];
    
    headers.forEach(function(header, index) {
        const cleanHeader = header.toLowerCase().trim();
        for (let keyword of keywords) {
            if (cleanHeader.includes(keyword)) {
                indexes.push(index);
                break;
            }
        }
    });
    
    // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ - –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π
    return indexes.length > 0 ? indexes[0] : -1;
}

function validateRow(row, cells, rowNum, columnMap) {
    const errors = [];
    
    // –î–∞—Ç–∞
    if (!row.date || !row.date.trim()) {
        errors.push('no_date');
    } else if (!isValidDate(row.date)) {
        errors.push('invalid_date_format');
    }
    
    // –ë–ª–æ–≥–µ—Ä
    if (!row.blogger || row.blogger.trim().length < 2) {
        errors.push('no_blogger');
    }
    
    // –ö–Ω–∏–≥–∞
    if (!row.book || row.book.trim().length < 2) {
        errors.push('no_book');
    }
    
    // –ß–∏—Å–ª–∞
    if (row.cost <= 0 || isNaN(row.cost)) {
        errors.push('invalid_cost');
    }
    
    if (row.cp <= 0 || isNaN(row.cp)) {
        errors.push('invalid_cp');
    }
    
    if (row.qty <= 0 || isNaN(row.qty)) {
        errors.push('invalid_quantity');
    }
    
    if (errors.length > 0) {
        return {
            isValid: false,
            reason: errors[0],
            row: rowNum,
            errors: errors
        };
    }
    
    return { isValid: true };
}

function isValidDate(dateString) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º ISO —Ñ–æ—Ä–º–∞—Ç
    const isoRegex = /^\d{4}-\d{2}-\d{2}$/;
    if (isoRegex.test(dateString)) {
        const date = new Date(dateString);
        return date instanceof Date && !isNaN(date);
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç dd.mm.yyyy
    const ruRegex = /^\d{2}\.\d{2}\.\d{4}$/;
    if (ruRegex.test(dateString)) {
        const parts = dateString.split('.');
        const date = new Date(parts[2], parts[1] - 1, parts[0]);
        return date instanceof Date && !isNaN(date);
    }
    
    return false;
}

// ==================== –î–ï–ú–û –î–ê–ù–ù–´–ï ====================
function loadDemoData() {
    if (campaigns.length > 0) {
        if (!confirm('–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
            return;
        }
        localStorage.removeItem('campaigns');
        campaigns = [];
    }
    
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö (–º–∞–ª—ã–π –Ω–∞–±–æ—Ä)...');
    
    // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–º–æ
    demoData.bloggers.forEach(function(b) {
        if (!bloggers.find(function(existing) { return existing.name === b.name; })) {
            bloggers.push(b);
        }
    });
    
    demoData.books.forEach(function(b) {
        if (!books.find(function(existing) { return existing.name === b.name; })) {
            books.push(b);
        }
    });
    
    campaigns = demoData.campaigns;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º
    localStorage.setItem('bloggers', JSON.stringify(demoData.bloggers));
    localStorage.setItem('books', JSON.stringify(demoData.books));
    localStorage.setItem('campaigns', JSON.stringify(demoData.campaigns));
    localStorage.setItem('demoShown', 'true');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º
    dataLoaded = true;
    populateSelects();
    renderBloggers();
    renderBooks();
    updateList();
    updateCounters();
    
    switchTab('data');
    
    showMessage('üöÄ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (5 –±–ª–æ–≥–µ—Ä–æ–≤, 5 –∫–Ω–∏–≥, 5 –∫–∞–º–ø–∞–Ω–∏–π). –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ "–î–∞–Ω–Ω—ã–µ"', 'success');
    console.log('‚úÖ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
}

function loadFullDemo() {
    if (campaigns.length > 0) {
        if (!confirm('–ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä–µ—Ç —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }
        localStorage.clear();
        localStorage.setItem('demoShown', 'true');
    }
    
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –¥–µ–º–æ (50+ –∑–∞–ø–∏—Å–µ–π)...');
    
    // –ë–æ–ª–µ–µ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä
    const fullDemo = {
        bloggers: [
            { name: 'logoped.arshinova', link: 'https://t.me/logoped_arshinova' },
            { name: 'defectologist_kids', link: 'https://instagram.com/defectologist_kids' },
            { name: 'speech_therapy_pro', link: 'https://t.me/speech_therapy' },
            { name: 'pedagog_anna', link: 'https://t.me/pedagog_anna' },
            { name: 'logoped_maria', link: 'https://instagram.com/logoped_maria' },
            { name: 'kids_speech', link: '' },
            { name: 'logoped_family', link: 'https://t.me/logoped_family' },
            { name: 'speech_development', link: '' }
        ],
        books: [
            { name: '–õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π 3-5 –ª–µ—Ç', cp: 350 },
            { name: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –∑–≤—É–∫–æ–ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è', cp: 420 },
            { name: '–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏ –¥–æ—à–∫–æ–ª—å–Ω–∏–∫–æ–≤', cp: 280 },
            { name: '–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞', cp: 180 },
            { name: '–£—Ä–æ–∫–∏ –ª–æ–≥–æ–ø–µ–¥–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π', cp: 320 },
            { name: '–õ–æ–≥–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', cp: 250 },
            { name: '–†–µ—á–µ–≤—ã–µ –∏–≥—Ä—ã –¥–ª—è –¥–µ—Ç–µ–π', cp: 200 },
            { name: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –∑–∞–∏–∫–∞–Ω–∏—è', cp: 380 }
        ],
        campaigns: [
            // logoped.arshinova (–≤—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
            { date: '2025-01-15', blogger: 'logoped.arshinova', book: '–õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π 3-5 –ª–µ—Ç', cost: 1500, cp: 350, qty: 25 },
            { date: '2025-01-12', blogger: 'logoped.arshinova', book: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –∑–≤—É–∫–æ–ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è', cost: 2200, cp: 420, qty: 18 },
            { date: '2025-01-10', blogger: 'logoped.arshinova', book: '–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏ –¥–æ—à–∫–æ–ª—å–Ω–∏–∫–æ–≤', cost: 800, cp: 280, qty: 30 },
            
            // defectologist_kids (—Å—Ä–µ–¥–Ω—è—è)
            { date: '2025-01-14', blogger: 'defectologist_kids', book: '–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞', cost: 1800, cp: 180, qty: 22 },
            { date: '2025-01-11', blogger: 'defectologist_kids', book: '–£—Ä–æ–∫–∏ –ª–æ–≥–æ–ø–µ–¥–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π', cost: 1200, cp: 320, qty: 12 },
            
            // speech_therapy_pro (—Å–º–µ—à–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
            { date: '2025-01-13', blogger: 'speech_therapy_pro', book: '–õ–æ–≥–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', cost: 950, cp: 250, qty: 8 },
            { date: '2025-01-09', blogger: 'speech_therapy_pro', book: '–†–µ—á–µ–≤—ã–µ –∏–≥—Ä—ã –¥–ª—è –¥–µ—Ç–µ–π', cost: 600, cp: 200, qty: 25 },
            { date: '2025-01-07', blogger: 'speech_therapy_pro', book: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –∑–∞–∏–∫–∞–Ω–∏—è', cost: 1100, cp: 380, qty: 5 },
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å —Ä–∞–∑–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
            { date: '2025-01-16', blogger: 'pedagog_anna', book: '–õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π 3-5 –ª–µ—Ç', cost: 900, cp: 350, qty: 15 },
            { date: '2025-01-09', blogger: 'logoped_maria', book: '–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏ –¥–æ—à–∫–æ–ª—å–Ω–∏–∫–æ–≤', cost: 1400, cp: 280, qty: 9 },
            { date: '2025-01-06', blogger: 'kids_speech', book: '–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞', cost: 700, cp: 180, qty: 35 },
            { date: '2025-01-04', blogger: 'logoped_family', book: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –∑–∞–∏–∫–∞–Ω–∏—è', cost: 2500, cp: 380, qty: 4 },
            { date: '2025-01-02', blogger: 'speech_development', book: '–£—Ä–æ–∫–∏ –ª–æ–≥–æ–ø–µ–¥–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π', cost: 1600, cp: 320, qty: 11 }
        ]
    };
    
    // –ó–∞–º–µ–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    bloggers = fullDemo.bloggers;
    books = fullDemo.books;
    campaigns = fullDemo.campaigns;
    
    localStorage.setItem('bloggers', JSON.stringify(bloggers));
    localStorage.setItem('books', JSON.stringify(books));
    localStorage.setItem('campaigns', JSON.stringify(campaigns));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º
    dataLoaded = true;
    populateSelects();
    renderBloggers();
    renderBooks();
    updateList();
    updateCounters();
    
    switchTab('data');
    
    showMessage('üöÄ –ü–æ–ª–Ω—ã–π –¥–µ–º–æ-–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! 9 –±–ª–æ–≥–µ—Ä–æ–≤, 8 –∫–Ω–∏–≥, 15 –∫–∞–º–ø–∞–Ω–∏–π. –ì–æ—Ç–æ–≤—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞!', 'success');
    console.log('‚úÖ –ü–æ–ª–Ω—ã–π –¥–µ–º–æ –∑–∞–≥—Ä—É–∂–µ–Ω');
}

// ==================== –°–ü–†–ê–í–û–ß–ù–ò–ö–ò ====================
function populateSelects() {
    console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤...');
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º
    const sortedBloggers = bloggers.sort(function(a, b) {
        return a.name.localeCompare(b.name);
    });
    
    const sortedBooks = books.sort(function(a, b) {
        return a.name.localeCompare(b.name);
    });
    
    // –ë–ª–æ–≥–µ—Ä—ã
    const bloggerSelects = document.querySelectorAll('#campaignBlogger, #editBlogger, #filterBlogger');
    bloggerSelects.forEach(function(select) {
        const originalValue = select.value;
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π HTML
        let options = '';
        if (select.id !== 'filterBlogger') {
            options += '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–≥–µ—Ä–∞</option>';
        } else {
            options += '<option value="">–í—Å–µ –±–ª–æ–≥–µ—Ä—ã</option>';
        }
        
        sortedBloggers.forEach(function(blogger) {
            options += `<option value="${blogger.name}">${blogger.name}</option>`;
        });
        
        select.innerHTML = options;
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        if (originalValue && sortedBloggers.find(function(b) { return b.name === originalValue; })) {
            select.value = originalValue;
        }
    });
    
    // –ö–Ω–∏–≥–∏
    const bookSelects = document.querySelectorAll('#campaignBook, #editBook, #filterBook');
    bookSelects.forEach(function(select) {
        const originalValue = select.value;
        
        let options = '';
        if (select.id !== 'filterBook') {
            options += '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É</option>';
        } else {
            options += '<option value="">–í—Å–µ –∫–Ω–∏–≥–∏</option>';
        }
        
        sortedBooks.forEach(function(book) {
            options += `<option value="${book.name}">${book.name} (–ß–ü: ${book.cp.toFixed(2)} —Ä—É–±.)</option>`;
        });
        
        select.innerHTML = options;
        
        if (originalValue && sortedBooks.find(function(b) { return b.name === originalValue; })) {
            select.value = originalValue;
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    const numericInputs = document.querySelectorAll('#campaignCost, #campaignCP, #campaignQty');
    numericInputs.forEach(function(input) {
        input.addEventListener('input', updateCampaignPreview);
    });
    
    console.log('‚úì –°–µ–ª–µ–∫—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
}

function renderBloggers() {
    const container = document.getElementById('bloggersList');
    if (!container) {
        console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–ª–æ–≥–µ—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    if (bloggers.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-users-slash" style="font-size: 4em; color: var(--warning); margin-bottom: 20px;"></i>
                <h3>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –±–ª–æ–≥–µ—Ä–æ–≤ –ø—É—Å—Ç</h3>
                <p style="margin-bottom: 20px;">–ë–ª–æ–≥–µ—Ä—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞–º–ø–∞–Ω–∏–π</p>
                <button class="add-btn" onclick="showAddBloggerModal()">
                    <i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞ –≤—Ä—É—á–Ω—É—é
                </button>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    bloggers.forEach(function(blogger, index) {
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        const bloggerCampaigns = campaigns.filter(function(c) {
            return c.blogger === blogger.name;
        });
        
        const totalCampaigns = bloggerCampaigns.length;
        const totalCost = bloggerCampaigns.reduce(function(sum, c) {
            return sum + c.cost;
        }, 0);
        
        const totalRevenue = bloggerCampaigns.reduce(function(sum, c) {
            return sum + (c.cp * c.qty);
        }, 0);
        
        const totalProfit = totalRevenue - totalCost;
        const roas = totalCost > 0 ? (totalRevenue / totalCost).toFixed(2) : 0;
        const roi = totalCost > 0 ? ((totalRevenue - totalCost) / totalCost * 100).toFixed(1) : 0;
        
        const efficiencyClass = roas > 3 ? 'success' : roas > 1.5 ? 'warning' : 'danger';
        
        // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
        const recentCampaigns = bloggerCampaigns
            .sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            })
            .slice(0, 3)
            .map(function(campaign) {
                const campaignProfit = campaign.cp * campaign.qty;
                const campaignROI = campaign.cost > 0 ? ((campaignProfit - campaign.cost) / campaign.cost * 100).toFixed(0) : 0;
                
                return `<div style="display: flex; justify-content: space-between; padding: 6px; margin: 3px 0; background: rgba(255,255,255,0.5); border-radius: 4px; font-size: 13px;">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 2px;">${campaign.date}</div>
                        <div style="color: var(--dark); font-size: 11px;">${campaign.book}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: ${campaignROI > 100 ? 'var(--primary)' : campaignROI > 0 ? 'var(--warning)' : 'var(--danger)'};">${campaignROI}%</div>
                        <div style="font-size: 11px; color: var(--dark);">${campaign.qty} —à—Ç.</div>
                    </div>
                </div>`;
            }).join('');
            
        html += `
            <div class="blogger-card ${efficiencyClass}" data-blogger="${index}">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-user" style="color: var(--secondary);"></i>
                        ${escapeHtml(blogger.name)}
                    </div>
                    <div class="card-stats">
                        <div class="metric positive">
                            <i class="fas fa-chart-line"></i> ${totalCampaigns} –∫–∞–º–ø–∞–Ω–∏–π
                        </div>
                        <div class="metric ${efficiencyClass}">
                            <i class="fas fa-coins"></i> ROAS: ${roas}x
                        </div>
                        <div class="metric">
                            <i class="fas fa-rub"></i> –ü—Ä–∏–±—ã–ª—å: ${totalProfit.toFixed(0)} —Ä—É–±.
                        </div>
                    </div>
                </div>
                
                <div class="card-details">
                    <div class="detail-label">–°—Å—ã–ª–∫–∞:</div>
                    <div class="detail-value">
                        ${blogger.link ? 
                            `<a href="${escapeHtml(blogger.link)}" target="_blank" rel="noopener" class="tooltip">
                                <i class="fas fa-external-link-alt" style="color: var(--secondary); margin-right: 5px;"></i>
                                ${escapeHtml(blogger.link.length > 40 ? blogger.link.substring(0, 37) + '...' : blogger.link)}
                                <span class="tooltiptext">${escapeHtml(blogger.link)}</span>
                            </a>` : 
                            '<span style="color: var(--warning);"><i class="fas fa-info-circle"></i> –ù–µ —É–∫–∞–∑–∞–Ω–∞</span>'
                        }
                    </div>
                    
                    <div class="detail-label">–ù–µ–¥–∞–≤–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏:</div>
                    <div class="detail-value">
                        ${recentCampaigns || '<span style="color: var(--warning);">–ù–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π</span>'}
                    </div>
                </div>
                
                <div class="card-actions">
                    <button class="add-btn" onclick="editBlogger(${index})" style="padding: 8px 15px; font-size: 13px;">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn-close" onclick="deleteBlogger(${index})" style="padding: 8px 15px; font-size: 13px;">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                    ${blogger.link ? 
                        `<a href="${escapeHtml(blogger.link)}" target="_blank" class="add-btn" style="padding: 8px 15px; font-size: 13px; background: var(--secondary); text-decoration: none; color: white; display: inline-flex; align-items: center;">
                            <i class="fas fa-external-link-alt"></i> –ü—Ä–æ—Ñ–∏–ª—å
                        </a>` : ''
                    }
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html || `
        <div class="empty-state">
            <i class="fas fa-users" style="font-size: 4em; color: var(--warning); margin-bottom: 20px;"></i>
            <h3>–ë–ª–æ–≥–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –±–ª–æ–≥–µ—Ä–∞ –≤—Ä—É—á–Ω—É—é</p>
            <button class="add-btn" onclick="switchTab('load')">
                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
    `;
}

function renderBooks() {
    const container = document.getElementById('booksList');
    if (!container) return;
    
    if (books.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-book" style="font-size: 4em; color: var(--warning); margin-bottom: 20px;"></i>
                <h3>–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p>–ö–Ω–∏–≥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞–º–ø–∞–Ω–∏–π</p>
                <button class="add-btn" onclick="switchTab('load')">
                    <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    books.forEach(function(book, index) {
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–Ω–∏–≥–∏
        const bookCampaigns = campaigns.filter(function(c) {
            return c.book === book.name;
        });
        
        const totalCampaigns = bookCampaigns.length;
        const totalSold = bookCampaigns.reduce(function(sum, c) {
            return sum + c.qty;
        }, 0);
        
        const totalRevenue = bookCampaigns.reduce(function(sum, c) {
            return sum + (c.cp * c.qty);
        }, 0);
        
        const totalCost = bookCampaigns.reduce(function(sum, c) {
            return sum + c.cost;
        }, 0);
        
        const totalProfit = totalRevenue - totalCost;
        const roi = totalCost > 0 ? ((totalRevenue - totalCost) / totalCost * 100).toFixed(1) : 0;
        
        const efficiencyClass = roi > 100 ? 'success' : roi > 0 ? 'warning' : 'danger';
        
        // –ù–µ–¥–∞–≤–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏
        const recentSales = bookCampaigns
            .sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            })
            .slice(0, 3)
            .map(function(campaign) {
                return `<div style="display: flex; justify-content: space-between; padding: 6px; margin: 3px 0; background: rgba(255,255,255,0.5); border-radius: 4px; font-size: 13px;">
                    <div>
                        <div style="font-weight: 600;">${campaign.date}</div>
                        <div style="color: var(--dark); font-size: 11px;">${campaign.blogger}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600;">${campaign.qty} —à—Ç.</div>
                        <div style="font-size: 11px; color: var(--dark);">${(campaign.cp * campaign.qty).toFixed(0)} —Ä—É–±.</div>
                    </div>
                </div>`;
            }).join('');
            
        html += `
            <div class="book-card ${efficiencyClass}" data-book="${index}">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-book" style="color: var(--secondary);"></i>
                        ${escapeHtml(book.name)}
                    </div>
                    <div class="card-stats">
                        <div class="metric positive">
                            <i class="fas fa-shopping-bag"></i> –ü—Ä–æ–¥–∞–Ω–æ: ${totalSold} —à—Ç.
                        </div>
                        <div class="metric ${efficiencyClass}">
                            <i class="fas fa-rub"></i> ROI: ${roi}%
                        </div>
                        <div class="metric">
                            <i class="fas fa-coins"></i> –í—ã—Ä—É—á–∫–∞: ${totalRevenue.toFixed(0)} —Ä—É–±.
                        </div>
                    </div>
                </div>
                
                <div class="card-details">
                    <div class="detail-label">–ß–ü –∑–∞ –∫–Ω–∏–≥—É:</div>
                    <div class="detail-value">
                        <span style="font-weight: 600; color: var(--success);">${book.cp.toFixed(2)}</span> —Ä—É–±.
                    </div>
                    
                    <div class="detail-label">–ù–µ–¥–∞–≤–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏:</div>
                    <div class="detail-value">
                        ${recentSales || '<span style="color: var(--warning);">–ü—Ä–æ–¥–∞–∂–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</span>'}
                    </div>
                </div>
                
                <div class="card-actions">
                    <button class="add-btn" onclick="editBook(${index})" style="padding: 8px 15px; font-size: 13px;">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn-close" onclick="deleteBook(${index})" style="padding: 8px 15px; font-size: 13px;">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// ==================== –ü–ê–†–°–ò–ù–ì –ò –í–ê–õ–ò–î–ê–¶–ò–Ø ====================
function parseCSV(csvData, source = 'unknown') {
    console.log(`üîç –ü–∞—Ä—Å–∏–Ω–≥ ${source}: ${csvData.split('\n').length} —Å—Ç—Ä–æ–∫`);
    
    try {
        // –û—Å–Ω–æ–≤–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
        let lines = csvData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–æ–∫ (–Ω—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –¥–∞–Ω–Ω—ã–µ)');
        }
        
        // –ü–∞—Ä—Å–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
        const headers = parseCSVLine(lines[0]);
        console.log('üìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:', headers.length, headers);
        
        // –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫
        const colMap = {
            date: headers.findIndex(h => h.toLowerCase().match(/date|–¥–∞—Ç–∞|–¥–µ–Ω—å/)),
            blogger: headers.findIndex(h => h.toLowerCase().match(/blogger|–±–ª–æ–≥–µ—Ä|influencer|–∞–≤—Ç–æ—Ä/)),
            book: headers.findIndex(h => h.toLowerCase().match(/book|–∫–Ω–∏–≥–∞|title|–Ω–∞–∑–≤–∞–Ω–∏–µ/)),
            cost: headers.findIndex(h => h.toLowerCase().match(/cost|—Å—Ç–æ–∏–º–æ—Å—Ç—å|expense|–∑–∞—Ç—Ä–∞—Ç—ã|sum/)),
        cp: headers.findIndex(h => h.toLowerCase().match(/cp|–ø—Ä–∏–±—ã–ª—å|revenue|–¥–æ—Ö–æ–¥|profit/)),
        qty: headers.findIndex(h => h.toLowerCase().match(/qty|–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ|quantity|count|—à—Ç/))
    };
    
    console.log('üîç –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫:', colMap);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
    const required = ['date', 'blogger', 'book', 'cost', 'qty'];
    let missingCols = [];
    
    required.forEach(function(col) {
        if (colMap[col] === -1) {
            missingCols.push(col);
        }
    });
    
    if (missingCols.length > 0) {
        console.warn('‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏:', missingCols);
        // –ü—Ä–æ–±—É–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è CSV
        if (source !== 'excel') {
            colMap.date = 0;
            colMap.blogger = 1;
            colMap.book = 2;
            colMap.cost = 3;
            colMap.cp = 4;
            colMap.qty = 5;
        } else {
            throw new Error('–í Excel –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: ' + missingCols.join(', '));
        }
    }
    
    // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ
    let parsedCampaigns = [];
    let validCount = 0;
    let invalidCount = 0;
    
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        if (line.trim().length === 0) continue;
        
        const cells = parseCSVLine(line);
        if (cells.length < 3) {
            console.warn(`–°—Ç—Ä–æ–∫–∞ ${i + 1}: —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∫–æ–ª–æ–Ω–æ–∫`);
            invalidCount++;
            continue;
        }
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
        let date = getCellValue(cells, colMap.date, i + 1);
        let blogger = getCellValue(cells, colMap.blogger, i + 1);
        let book = getCellValue(cells, colMap.book, i + 1);
        let cost = parseFloat(getCellValue(cells, colMap.cost, i + 1)) || 0;
        let cp = parseFloat(getCellValue(cells, colMap.cp, i + 1)) || 0;
        let qty = parseInt(getCellValue(cells, colMap.qty, i + 1)) || 0;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!date || !blogger || !book) {
            console.warn(`–°—Ç—Ä–æ–∫–∞ ${i + 1}: –ø—Ä–æ–ø—É—â–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è`);
            invalidCount++;
            continue;
        }
        
        if (cost <= 0 || cp <= 0 || qty <= 0) {
            console.warn(`–°—Ç—Ä–æ–∫–∞ ${i + 1}: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞ - cost: ${cost}, cp: ${cp}, qty: ${qty}`);
            invalidCount++;
            continue;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        parsedCampaigns.push({
            date: date,
            blogger: blogger.trim(),
            book: book.trim(),
            cost: cost,
            cp: cp,
            qty: qty
        });
        
        validCount++;
    }
    
    if (parsedCampaigns.length === 0) {
        throw new Error('–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
    }
    
    campaigns = parsedCampaigns;
    localStorage.setItem('campaigns', JSON.stringify(campaigns));
    extractBloggersBooks();
    
    console.log(`‚úì –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω: ${validCount} –∏–∑ ${lines.length - 1} —Å—Ç—Ä–æ–∫`);
    
    return {
        success: true,
        count: validCount,
        total: lines.length - 1,
        skipped: invalidCount
    };
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
function parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;
    let inDoubleQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
            inDoubleQuotes = !inDoubleQuotes;
        } else if (char === "'" && !inDoubleQuotes) {
            inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes && !inDoubleQuotes) {
            result.push(current);
            current = '';
        } else {
            current += char;
        }
    }
    
    result.push(current);
    return result.map(s => s.trim());
}

function getCellValue(cells, index, rowNumber) {
    if (index >= 0 && index < cells.length) {
        let value = cells[index];
        
        // –£–¥–∞–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏
        value = value.replace(/^"|"$/g, '');
        
        // –ï—Å–ª–∏ –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        if (!value || value.trim() === '' || value === 'NULL') {
            return '';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Excel —Å–µ—Ä–∏–π–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –¥–∞—Ç
        if (!isNaN(value) && value > 1000 && value < 100000) {
            const asDate = new Date((parseFloat(value) - 25569) * 86400 * 1000);
            if (asDate instanceof Date && !isNaN(asDate.getTime())) {
                return asDate.toISOString().split('T')[0];
            }
        }
        
        return value;
    }
    
    return '';
}

// ==================== –í–ê–õ–ò–î–ê–¶–ò–Ø ====================
function validateRow(row, cells, rowIndex, colMap) {
    const errors = [];
    
    if (!row.date) {
        errors.push('–î–∞—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞');
    } else if (!isValidDate(row.date)) {
        errors.push('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: ' + row.date);
    }
    
    if (!row.blogger || row.blogger.trim().length < 2) {
        errors.push('–ò–º—è –±–ª–æ–≥–µ—Ä–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
    }
    
    if (!row.book || row.book.trim().length < 2) {
        errors.push('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
    }
    
    if (row.cost <= 0) {
        errors.push('–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
    }
    
    if (row.cp <= 0) {
        errors.push('–ß–ü —Å –∫–Ω–∏–≥–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
    }
    
    if (row.qty <= 0) {
        errors.push('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
    }
    
    return errors.length === 0;
}

function isValidDate(dateString) {
    // YYYY-MM-DD
    const isoPattern = /^(\d{4})-(\d{2})-(\d{2})$/;
    if (isoPattern.test(dateString)) {
        const [, year, month, day] = isoPattern.exec(dateString);
        const date = new Date(year, month - 1, day);
        return date.getFullYear() === parseInt(year) &&
               date.getMonth() + 1 === parseInt(month) &&
               date.getDate() === parseInt(day);
    }
    
    // DD.MM.YYYY (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
    const ruPattern = /^(\d{2})\.(\d{2})\.(\d{4})$/;
    if (ruPattern.test(dateString)) {
        const [, day, month, year] = ruPattern.exec(dateString);
        const date = new Date(year, month - 1, day);
        return date.getFullYear() === parseInt(year) &&
               date.getMonth() + 1 === parseInt(month) &&
               date.getDate() === parseInt(day);
    }
    
    return false;
}

// ==================== –°–ü–†–ê–í–û–ß–ù–ò–ö–ò ====================
function extractBloggersBooks() {
    console.log('–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤...');
    
    // –ë–ª–æ–≥–µ—Ä—ã
    const uniqueBloggers = [...new Set(campaigns.map(c => c.blogger))]
        .filter(b => b && b.trim());
    
    uniqueBloggers.forEach(function(name) {
        if (!bloggers.find(b => b.name === name)) {
            bloggers.push({ name: name.trim(), link: '' });
        }
    });
    
    // –ö–Ω–∏–≥–∏
    const uniqueBooks = [...new Set(campaigns.map(c => c.book))]
        .filter(b => b && b.trim());
    
    uniqueBooks.forEach(function(name) {
        if (!books.find(bk => bk.name === name)) {
            // –°—Ä–µ–¥–Ω–µ–µ –ß–ü –¥–ª—è –∫–Ω–∏–≥–∏
            const bookCampaigns = campaigns.filter(c => c.book === name);
            const avgCP = bookCampaigns.length > 0 ? 
                bookCampaigns.reduce((sum, c) => sum + c.cp, 0) / bookCampaigns.length : 0;
            
            books.push({ name: name.trim(), cp: avgCP || 0 });
        }
    });
    
    saveStorage();
    populateSelects();
    renderBloggers();
    renderBooks();
    updateCounters();
}

// ==================== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ê–ù–ù–´–• ====================
function updateList(filteredCampaigns = campaigns) {
    const container = document.getElementById('dataTableContainer');
    if (!container) return;
    
    if (filteredCampaigns.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-table" style="font-size: 4em; color: var(--warning); margin-bottom: 20px;"></i>
                <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                <p style="margin-bottom: 20px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel/CSV —Ñ–∞–π–ª –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–∞–º–ø–∞–Ω–∏—é –≤—Ä—É—á–Ω—É—é</p>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="add-btn" onclick="switchTab('load')">
                        <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                    </button>
                    <button class="add-btn" onclick="switchTab('campaigns')">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
            </div>
        `;
        document.getElementById('recordsCount').textContent = '0 –∑–∞–ø–∏—Å–µ–π';
        return;
    }
    
    let tableHTML = `
        <table>
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ë–ª–æ–≥–µ—Ä</th>
                    <th>–ö–Ω–∏–≥–∞</th>
                    <th>–ó–∞—Ç—Ä–∞—Ç—ã</th>
                    <th>–ü—Ä–æ–¥–∞–∂–∏</th>
                    <th>–ú–µ—Ç—Ä–∏–∫–∏</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    filteredCampaigns.forEach(function(campaign, index) {
        const revenue = campaign.cp * campaign.qty;
        const profit = revenue - campaign.cost;
        const roi = campaign.cost > 0 ? ((revenue - campaign.cost) / campaign.cost * 100).toFixed(1) : 0;
        const roas = campaign.cost > 0 ? revenue / campaign.cost : 0;
        const cps = campaign.qty > 0 ? campaign.cost / campaign.qty : 0;
        
        const roiClass = roi > 100 ? 'positive' : roi > 0 ? 'neutral' : 'negative';
        const profitClass = profit > 0 ? 'positive' : 'negative';
        
        tableHTML += `
            <tr class="${index === 0 ? 'new-row' : ''}">
                <td style="font-weight: 600; white-space: nowrap;">
                    <span class="tooltip" title="${campaign.date}">${campaign.date}</span>
                </td>
                <td style="max-width: 180px; word-break: break-word;">
                    <span class="tooltip" title="–ë–ª–æ–≥–µ—Ä: ${escapeHtml(campaign.blogger)}">${escapeHtml(campaign.blogger)}</span>
                </td>
                <td style="max-width: 180px; word-break: break-word;">
                    <span class="tooltip" title="–ö–Ω–∏–≥–∞: ${escapeHtml(campaign.book)}">${escapeHtml(campaign.book)}</span>
                </td>
                <td>
                    <div class="metrics-group">
                        <div class="metric-item">
                            <span class="metric-label">–ó–∞—Ç—Ä–∞—Ç—ã:</span>
                            <span>${campaign.cost.toLocaleString()} —Ä—É–±.</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">–ß–ü/–∫–Ω–∏–≥–∞:</span>
                            <span class="positive">${campaign.cp.toFixed(2)} —Ä—É–±.</span>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="metrics-group">
                        <div class="metric-item">
                            <span class="metric-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
                            <span style="color: var(--secondary); font-weight: 600;">${campaign.qty}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">–í—ã—Ä—É—á–∫–∞:</span>
                            <span class="positive">${revenue.toLocaleString()} —Ä—É–±.</span>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="metrics-group">
                        <div class="metric-item">
                            <span class="metric-label">–ü—Ä–∏–±—ã–ª—å:</span>
                            <span class="${profitClass}">${profit.toLocaleString()} —Ä—É–±.</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">ROI:</span>
                            <span class="${roiClass}">${roi > 0 ? '+' : ''}${roi}%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">ROAS:</span>
                            <span class="positive">${roas.toFixed(2)}x</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">CPS:</span>
                            <span>${cps.toFixed(0)} —Ä—É–±./—à—Ç.</span>
                        </div>
                    </div>
                </td>
                <td style="white-space: nowrap;">
                    <button class="add-btn" onclick="editCampaign(${index})" style="padding: 6px 8px; font-size: 11px;" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-close" onclick="deleteCampaign(${index})" style="padding: 6px 8px; font-size: 11px;" title="–£–¥–∞–ª–∏—Ç—å">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
    });
    
    tableHTML += '</tbody></table>';
    
    container.innerHTML = tableHTML;
    document.getElementById('recordsCount').textContent = filteredCampaigns.length + ' –∑–∞–ø–∏—Å–µ–π';
}

// ==================== –§–ò–õ–¨–¢–†–´ ====================
function toggleFilters() {
    const panel = document.getElementById('filtersPanel');
    const btn = document.getElementById('toggleFiltersBtn');
    
    if (panel.style.display === 'none' || panel.style.display === '') {
        panel.style.display = 'block';
        btn.innerHTML = '<i class="fas fa-filter"></i> –°–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã';
    } else {
        panel.style.display = 'none';
        btn.innerHTML = '<i class="fas fa-filter"></i> –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã';
    }
}

function applyFilters() {
    let filtered = campaigns.slice();
    
    const activeFilters = {
        dateFrom: document.getElementById('filterDateFrom').value,
        dateTo: document.getElementById('filterDateTo').value,
        blogger: document.getElementById('filterBlogger').value,
        book: document.getElementById('filterBook').value,
        roiMin: parseFloat(document.getElementById('filterROIFrom').value) || -Infinity,
        roiMax: parseFloat(document.getElementById('filterROITo').value) || Infinity,
        roasMin: parseFloat(document.getElementById('filterROASFrom').value) || 0,
        roasMax: parseFloat(document.getElementById('filterROASTo').value) || Infinity,
        cpsMin: parseFloat(document.getElementById('filterCPSFrom').value) || 0,
        cpsMax: parseFloat(document.getElementById('filterCPSTo').value) || Infinity
    };
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
    if (activeFilters.dateFrom) {
        filtered = filtered.filter(c => new Date(c.date) >= new Date(activeFilters.dateFrom));
    }
    if (activeFilters.dateTo) {
        filtered = filtered.filter(c => new Date(c.date) <= new Date(activeFilters.dateTo));
    }
    
    // –ü–æ –±–ª–æ–≥–µ—Ä—É/–∫–Ω–∏–≥–µ
    if (activeFilters.blogger) {
        filtered = filtered.filter(c => c.blogger === activeFilters.blogger);
    }
    if (activeFilters.book) {
        filtered = filtered.filter(c => c.book === activeFilters.book);
    }
    
    // –ü–æ –º–µ—Ç—Ä–∏–∫–∞–º
    filtered = filtered.filter(c => {
        const revenue = c.cp * c.qty;
        const profit = revenue - c.cost;
        const roi = c.cost > 0 ? (profit / c.cost * 100) : 0;
        const roas = c.cost > 0 ? revenue / c.cost : 0;
        const cps = c.qty > 0 ? c.cost / c.qty : Infinity;
        
        return roi >= activeFilters.roiMin && roi <= activeFilters.roiMax &&
               roas >= activeFilters.roasMin && roas <= activeFilters.roasMax &&
               cps >= activeFilters.cpsMin && cps <= activeFilters.cpsMax;
    });
    
    updateList(filtered);
    showMessage(`–§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã: –ø–æ–∫–∞–∑–∞–Ω–æ ${filtered.length} –∏–∑ ${campaigns.length} –∑–∞–ø–∏—Å–µ–π`, 'info');
}

function clearFilters() {
    ['filterDateFrom', 'filterDateTo', 'filterBlogger', 'filterBook', 
     'filterROIFrom', 'filterROITo', 'filterROASFrom', 'filterROASTo', 
     'filterCPSFrom', 'filterCPSTo'].forEach(id => {
        const element = document.getElementById(id);
        if (element) element.value = '';
    });
    
    updateList();
    showMessage('–§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
    toggleFilters(); // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
}

// ==================== –ê–ù–ê–õ–ò–ó ====================
function analyzeTop() {
    if (campaigns.length === 0) {
        showMessage('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', 'error');
        return;
    }
    
    console.log('–ê–Ω–∞–ª–∏–∑ —Ç–æ–ø-10 –±–ª–æ–≥–µ—Ä–æ–≤...');
    
    const stats = {};
    
    campaigns.forEach(function(campaign) {
        const revenue = campaign.cp * campaign.qty;
        const profit = revenue - campaign.cost;
        
        if (!stats[campaign.blogger]) {
            stats[campaign.blogger] = {
                cost: 0,
                revenue: 0,
                campaigns: 0,
                bestBooks: {}
            };
        }
        
        stats[campaign.blogger].cost += campaign.cost;
        stats[campaign.blogger].revenue += revenue;
        stats[campaign.blogger].campaigns += 1;
        
        if (!stats[campaign.blogger].bestBooks[campaign.book]) {
            stats[campaign.blogger].bestBooks[campaign.book] = 0;
        }
        stats[campaign.blogger].bestBooks[campaign.book] += revenue;
    });
    
    const top = Object.keys(stats)
        .map(blogger => {
            const data = stats[blogger];
            const roas = data.cost > 0 ? data.revenue / data.cost : 0;
            const roi = data.cost > 0 ? ((data.revenue - data.cost) / data.cost) * 100 : 0;
            
            return {
                name: blogger,
                roas: roas,
                roi: roi,
                cost: data.cost,
                revenue: data.revenue,
                campaigns: data.campaigns,
                topBooks: Object.keys(data.bestBooks)
                    .map(book => ({ name: book, revenue: data.bestBooks[book] }))
                    .sort((a, b) => b.revenue - a.revenue)
                    .slice(0, 2)
            };
        })
        .filter(b => b.cost > 0)
        .sort((a, b) => b.roas - a.roas)
        .slice(0, 10);
    
    const container = document.getElementById('analysisResults');
    if (!container) return;
    
    let html = `
        <div style="margin-bottom: 25px;">
            <h3 style="color: var(--primary); margin: 0 0 15px 0;">
                <i class="fas fa-trophy" style="margin-right: 10px;"></i>
                –¢–æ–ø-${top.length} –±–ª–æ–≥–µ—Ä–æ–≤ –ø–æ ROAS
            </h3>
            <p style="color: var(--dark); margin: 0;">
                –ê–Ω–∞–ª–∏–∑ ${campaigns.length} –∫–∞–º–ø–∞–Ω–∏–π. –û–±—â–∏–π –±—é–¥–∂–µ—Ç: ${campaigns.reduce((sum, c) => sum + c.cost, 0).toLocaleString()} —Ä—É–±.
            </p>
        </div>
    `;
    
    top.forEach((blogger, i) => {
        const rankClass = i < 3 ? (i === 0 ? 'positive' : i === 1 ? 'neutral' : 'warning') : '';
        const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `${i + 1}.`;
        
        const topBooks = blogger.topBooks.map(book => 
            `<div style="display: flex; justify-content: space-between; padding: 3px 0; font-size: 13px;">
                üìö ${book.name}: ${book.revenue.toLocaleString()} —Ä—É–±.
            </div>`
        ).join('');
        
        html += `
            <div class="blogger-card" style="border-left: 5px solid var(--${rankClass});">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <div style="width: 40px; height: 40px; background: ${rankClass}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; margin-right: 15px;">
                        ${medal}
                    </div>
                    <div style="flex: 1;">
                        <h4 style="margin: 0; font-size: 1.3em; color: var(--dark);">${escapeHtml(blogger.name)}</h4>
                        <p style="margin: 5px 0 0 0; color: var(--secondary); font-size: 14px;">
                            ${blogger.campaigns} –∫–∞–º–ø–∞–Ω–∏–π | –ó–∞—Ç—Ä–∞—Ç—ã: ${blogger.cost.toLocaleString()} —Ä—É–±. | –ü—Ä–∏–±—ã–ª—å: ${blogger.revenue.toLocaleString()} —Ä—É–±.
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div class="metrics positive" style="font-size: 1.4em; margin-bottom: 5px;">
                            <strong>${blogger.roas.toFixed(2)}x</strong>
                        </div>
                        <div style="${blogger.roi > 100 ? 'color: var(--primary)' : 'color: var(--warning)'}">
                            ROI: ${blogger.roi.toFixed(0)}%
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; font-size: 14px;">
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: var(--secondary);">–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h5>
                        <div style="padding: 10px; background: var(--light); border-radius: 6px;">
                            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                <span>–ó–∞—Ç—Ä–∞—Ç—ã:</span><span>${blogger.cost.toLocaleString()} —Ä—É–±.</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 5px 0; color: var(--primary);">
                                <span>–ü—Ä–∏–±—ã–ª—å:</span><span>${blogger.revenue.toLocaleString()} —Ä—É–±.</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                <span>CPS:</span><span>${(blogger.cost / blogger.campaigns).toFixed(0)} —Ä—É–±./–∫–∞–º–ø.</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: var(--secondary);">–õ—É—á—à–∏–µ –∫–Ω–∏–≥–∏</h5>
                        <div style="padding: 10px; background: var(--light); border-radius: 6px;">
                            ${topBooks}
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    const overall = {
        cost: campaigns.reduce((sum, c) => sum + c.cost, 0),
        revenue: campaigns.reduce((sum, c) => sum + (c.cp * c.qty), 0),
        campaigns: campaigns.length
    };
    
    html += `
        <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, var(--primary), #45a049); color: white; border-radius: 10px; text-align: center;">
            <h3 style="margin: 0 0 20px 0;"><i class="fas fa-chart-pie"></i> –û–±—â–∞—è —Å–≤–æ–¥–∫–∞</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; font-size: 16px;">
                <div>
                    <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">${overall.campaigns}</div>
                    <div>–∫–∞–º–ø–∞–Ω–∏–π</div>
                </div>
                <div>
                    <div style="font-size: 28px; font-weight: bold; color: var(--warning); margin-bottom: 5px;">${overall.cost.toLocaleString()}</div>
                    <div>–æ–±—â–∏–π –±—é–¥–∂–µ—Ç</div>
                </div>
                <div>
                    <div style="font-size: 28px; font-weight: bold; color: var(--success); margin-bottom: 5px;">${overall.revenue.toLocaleString()}</div>
                    <div>–æ–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                </div>
                <div>
                    <div style="font-size: 28px; font-weight: bold; color: ${overall.cost > 0 ? 'var(--success)' : 'var(--danger)'} margin-bottom: 5px;">
                        ${(overall.cost > 0 ? overall.revenue / overall.cost : 0).toFixed(2)}x
                    </div>
                    <div>–æ–±—â–∏–π ROAS</div>
                </div>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
    showMessage(`–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${campaigns.length} –∫–∞–º–ø–∞–Ω–∏–π. –¢–æ–ø-${top.length} –±–ª–æ–≥–µ—Ä–æ–≤.`, 'success');
}

// ==================== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ====================
function showAddBloggerModal() {
    editingType = 'blogger';
    document.getElementById('bloggerModalTitle').innerHTML = '<i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞';
    document.getElementById('bloggerName').value = '';
    document.getElementById('bloggerLink').value = '';
    document.getElementById('saveBloggerBtn').onclick = addBlogger;
    showModal('addBloggerModal');
    document.getElementById('bloggerName').focus();
}

function addBlogger() {
    const name = document.getElementById('bloggerName').value.trim();
    const link = document.getElementById('bloggerLink').value.trim();
    
    if (!name || name.length < 2) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–ª–æ–≥–µ—Ä–∞ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)');
        return;
    }
    
    if (bloggers.find(b => b.name.toLowerCase() === name.toLowerCase())) {
        alert('–ë–ª–æ–≥–µ—Ä —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
        return;
    }
    
    bloggers.push({ name, link: link || '' });
    saveStorage();
    renderBloggers();
    populateSelects();
    hideAddBloggerModal();
    showMessage(`–ë–ª–æ–≥–µ—Ä "${name}" –¥–æ–±–∞–≤–ª–µ–Ω`, 'success');
}

function showAddBookModal() {
    editingType = 'book';
    document.getElementById('bookModalTitle').innerHTML = '<i class="fas fa-book-open"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É';
    document.getElementById('bookName').value = '';
    document.getElementById('bookCP').value = '';
    document.getElementById('saveBookBtn').onclick = addBook;
    showModal('addBookModal');
    document.getElementById('bookName').focus();
}

function addBook() {
    const name = document.getElementById('bookName').value.trim();
    const cp = parseFloat(document.getElementById('bookCP').value) || 0;
    
    if (!name || name.length < 2) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)');
        return;
    }
    
    if (cp <= 0) {
        alert('–ß–ü —Å –∫–Ω–∏–≥–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
        return;
    }
    
    if (books.find(bk => bk.name.toLowerCase() === name.toLowerCase())) {
        alert('–ö–Ω–∏–≥–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
        return;
    }
    
    books.push({ name, cp });
    saveStorage();
    renderBooks();
    populateSelects();
    updateList(); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
    hideAddBookModal();
    showMessage(`–ö–Ω–∏–≥–∞ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω–∞ (–ß–ü: ${cp} —Ä—É–±.)`, 'success');
}

function showEditCampaignModal(index) {
    editingType = 'campaign';
    currentEditIndex = index;
    
    const campaign = campaigns[index];
    document.getElementById('editDate').value = campaign.date;
    document.getElementById('editBlogger').value = campaign.blogger;
    document.getElementById('editBook').value = campaign.book;
    document.getElementById('editCost').value = campaign.cost;
    document.getElementById('editCP').value = campaign.cp;
    document.getElementById('editQty').value = campaign.qty;
    
    document.getElementById('saveCampaignEditBtn').onclick = saveCampaignEdit;
    showModal('editCampaignModal');
    document.getElementById('editDate').focus();
}

function saveCampaignEdit() {
    const index = currentEditIndex;
    const campaign = campaigns[index];
    
    const date = document.getElementById('editDate').value;
    const blogger = document.getElementById('editBlogger').value;
    const book = document.getElementById('editBook').value;
    const cost = parseFloat(document.getElementById('editCost').value);
    const cp = parseFloat(document.getElementById('editCP').value);
    const qty = parseInt(document.getElementById('editQty').value);
    
    if (!date || !blogger || !book || cost <= 0 || cp <= 0 || qty <= 0) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
        return;
    }
    
    campaigns[index] = { date, blogger, book, cost, cp, qty };
    saveStorage();
    updateList();
    hideEditCampaignModal();
    showMessage('–ö–∞–º–ø–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
}

function hideAddBloggerModal() {
    document.getElementById('addBloggerModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

function hideAddBookModal() {
    document.getElementById('addBookModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

function hideEditCampaignModal() {
    document.getElementById('editCampaignModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    currentEditIndex = -1;
    editingType = null;
}

// ==================== LOCALSTORAGE ====================
function saveStorage() {
    try {
        localStorage.setItem('bloggers', JSON.stringify(bloggers));
        localStorage.setItem('books', JSON.stringify(books));
        localStorage.setItem('campaigns', JSON.stringify(campaigns));
        console.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
        showMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
    }
}

// ==================== –£–î–ê–õ–ï–ù–ò–ï ====================
function deleteBlogger(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞ –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏?')) {
        const name = bloggers[index].name;
        bloggers.splice(index, 1);
        campaigns = campaigns.filter(c => c.blogger !== name);
        saveStorage();
        renderBloggers();
        populateSelects();
        updateList();
        updateCounters();
        showMessage(`–ë–ª–æ–≥–µ—Ä "${name}" —É–¥–∞–ª–µ–Ω`, 'success');
    }
}

function deleteBook(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏?')) {
        const name = books[index].name;
        books.splice(index, 1);
        campaigns = campaigns.filter(c => c.book !== name);
        saveStorage();
        renderBooks();
        populateSelects();
        updateList();
        updateCounters();
        showMessage(`–ö–Ω–∏–≥–∞ "${name}" —É–¥–∞–ª–µ–Ω–∞`, 'success');
    }
}

function deleteCampaign(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é?')) {
        campaigns.splice(index, 1);
        saveStorage();
        updateList();
        updateCounters();
        showMessage('–ö–∞–º–ø–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
    }
}

// ==================== –°–ë–†–û–° ====================
function showResetModal() {
    const modal = document.getElementById('resetModal');
    const password = document.getElementById('resetPassword');
    
    if (modal) modal.style.display = 'block';
    if (password) password.value = '';
    
    document.body.style.overflow = 'hidden';
}

function confirmReset() {
    const password = document.getElementById('resetPassword').value;
    if (password === 'admin') {
        if (confirm('–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            localStorage.clear();
            bloggers = [];
            books = [];
            campaigns = [];
            saveStorage();
            renderBloggers();
            renderBooks();
            updateList();
            populateSelects();
            updateCounters();
            hideResetModal();
            switchTab('load');
            showMessage('–î–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω—ã', 'success');
        }
    } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! (–ü–æ–¥—Å–∫–∞–∑–∫–∞: admin)');
    }
}

function hideResetModal() {
    document.getElementById('resetModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// ==================== DEBUG ====================
function toggleDebug() {
    const panel = document.getElementById('debugPanel');
    if (panel.classList.contains('show')) {
        panel.classList.remove('show');
    } else {
        updateDebugPanel();
        panel.classList.add('show');
    }
}

function updateDebugPanel() {
    const content = document.getElementById('debugContent');
    if (!content) return;
    
    const stats = calculateOverallStats();
    const memory = {
        bloggers: localStorage.getItem('bloggers')?.length || 0,
        books: localStorage.getItem('books')?.length || 0,
        campaigns: localStorage.getItem('campaigns')?.length || 0
    };
    
    content.innerHTML = `
        <div class="debug-item">
            <strong>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong>
        </div>
        <div class="debug-item">
            <strong>–ë–ª–æ–≥–µ—Ä—ã:</strong> ${bloggers.length} (${memory.bloggers} –±–∞–π—Ç)
        </div>
        <div class="debug-item">
            <strong>–ö–Ω–∏–≥–∏:</strong> ${books.length} (${memory.books} –±–∞–π—Ç)
        </div>
        <div class="debug-item">
            <strong>–ö–∞–º–ø–∞–Ω–∏–∏:</strong> ${campaigns.length} (${memory.campaigns} –±–∞–π—Ç)
        </div>
        <div class="debug-item">
            <strong>localStorage:</strong> ${(memory.bloggers + memory.books + memory.campaigns) / 1024 | 0} –ö–ë
        </div>
        <div class="debug-item">
            <strong>–û–±—â–∏–π ROAS:</strong> ${(stats.revenue / stats.cost).toFixed(2)}x
        </div>
        <div class="debug-item">
            <strong>–û–±—â–∏–π ROI:</strong> ${stats.roi.toFixed(1)}%
        </div>
        <div class="debug-item">
            <strong>SheetJS:</strong> ${typeof XLSX !== 'undefined' ? '‚úì –í–µ—Ä—Å–∏—è ' + XLSX.version : '‚úó –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω'}
        </div>
        <div class="debug-item">
            <strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> ${navigator.userAgentData ? navigator.userAgentData.platform : navigator.platform}
        </div>
        <div class="debug-item">
            <strong>–í–µ—Ä—Å–∏—è:</strong> v7.4 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥)
        </div>
    `;
}

// ==================== –≠–ö–°–ü–û–†–¢ ====================
function exportData() {
    if (campaigns.length === 0) {
        showMessage('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
        return;
    }
    
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
    const exportData = campaigns.map(c => {
        const revenue = c.cp * c.qty;
        const profit = revenue - c.cost;
        const roi = c.cost > 0 ? ((revenue - c.cost) / c.cost * 100) : 0;
        const roas = c.cost > 0 ? revenue / c.cost : 0;
        const cps = c.qty > 0 ? c.cost / c.qty : 0;
        
        return {
            '–î–∞—Ç–∞': c.date,
            '–ë–ª–æ–≥–µ—Ä': c.blogger,
            '–ö–Ω–∏–≥–∞': c.book,
            '–ó–∞—Ç—Ä–∞—Ç—ã (—Ä—É–±.)': c.cost,
            '–ß–ü/–∫–Ω–∏–≥–∞ (—Ä—É–±.)': c.cp,
            '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': c.qty,
            '–í—ã—Ä—É—á–∫–∞ (—Ä—É–±.)': revenue,
            '–ü—Ä–∏–±—ã–ª—å (—Ä—É–±.)': profit,
            'ROI (%)': roi,
            'ROAS (x)': roas,
            'CPS (—Ä—É–±./—à—Ç.)': cps
        };
    });
    
    const ws = XLSX.utils.json_to_sheet(exportData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, '–ö–∞–º–ø–∞–Ω–∏–∏');
    
    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:.]/g, '-');
    const filename = `–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä_–±–ª–æ–≥–µ—Ä–æ–≤_${timestamp}.xlsx`;
    
    XLSX.writeFile(wb, filename);
    showMessage(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω: ${filename}`, 'success');
}

// ==================== –£–¢–ò–õ–ò–¢–´ ====================
function showWelcomeMessage() {
    const welcome = document.createElement('div');
    welcome.className = 'message warning';
    welcome.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;';
    welcome.innerHTML = `
        <i class="fas fa-star" style="font-size: 20px; color: #ffc107;"></i>
        <strong>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</strong> –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ" –Ω–∏–∂–µ.
        <br><small>–°–æ–∑–¥–∞—Å—Ç –±–ª–æ–≥–µ—Ä–æ–≤, –∫–Ω–∏–≥–∏ –∏ –∫–∞–º–ø–∞–Ω–∏–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π.</small>
        <button onclick="loadDemoData(); welcome.remove(); this.parentElement.style.display='none';" 
                style="margin-top: 8px; padding: 6px 12px; background: rgba(255,193,7,0.2); border: 1px solid #ffc107; color: #856404; border-radius: 4px; cursor: pointer;">
            üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ
        </button>
    `;
    
    document.body.appendChild(welcome);
    
    setTimeout(() => {
        if (welcome.parentNode) {
            welcome.style.opacity = '0';
            setTimeout(() => welcome.remove(), 300);
        }
    }, 10000);
}

function showMessage(text, type = 'info', targetId = null) {
    let target = targetId ? document.getElementById(targetId) : document.body;
    
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    const existing = target.querySelector('.message');
    if (existing) existing.remove();
    
    const message = document.createElement('div');
    message.className = `message ${type}`;
    message.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-circle' : 'info-circle'}"></i>
        ${text}
    `;
    
    target.insertBefore(message, target.firstChild);
    
    // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
    setTimeout(() => {
        if (message.parentNode) {
            message.style.opacity = '0';
            setTimeout(() => message.remove(), 300);
        }
    }, 8000);
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ==================== –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨ –ò –ó–ê–ü–£–°–ö ====================
document.addEventListener('DOMContentLoaded', function() {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ v7.4...');
    
    // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    if (document.readyState !== 'complete') {
        window.addEventListener('load', initApp);
    } else {
        setTimeout(initApp, 100);
    }
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
window.addEventListener('error', function(e) {
    console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', e.error || e.message);
    showMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + (e.error || e.message), 'error');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
if (!window.fetch || !Array.from || !Object.entries) {
    document.addEventListener('DOMContentLoaded', function() {
        document.body.innerHTML = `
            <div style="text-align: center; padding: 50px; background: white; margin: 50px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                <h2 style="color: var(--danger);">–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</h2>
                <p>–î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:</p>
                <ul style="text-align: left; max-width: 400px; margin: 20px auto;">
                    <li><strong>JavaScript ES6+</strong> (Chrome 60+, Firefox 60+, Safari 11+, Edge 79+)</li>
                    <li><strong>localStorage</strong> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</li>
                    <li><strong>File API</strong> –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤</li>
                </ul>
                <p style="margin-top: 20px;">
                    <strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong> Google Chrome, Mozilla Firefox (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤–µ—Ä—Å–∏–∏)
                </p>
                <p style="font-size: 12px; color: var(--dark); margin-top: 15px;">
                    –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –æ–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π
                </p>
            </div>
        `;
        document.head.innerHTML = '<title>–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</title>';
    });
}

console.log('‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ DOM...');
</script>
</body>
</html>


