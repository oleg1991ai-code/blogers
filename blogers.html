<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –±–ª–æ–≥–µ—Ä–æ–≤ (v7.3: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Excel)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SheetJS –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --danger: #f44336;
            --warning: #ff9800;
            --light: #f5f5f5;
            --dark: #333;
            --border: #ddd;
            --text-large: 16px;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: var(--text-large);
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 30px; font-size: 2.5em; }
        .section {
            background: white;
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .section:hover { transform: translateY(-2px); }
        .hidden { display: none; }
        .toggle-btn { cursor: pointer; color: var(--secondary); font-weight: bold; margin-right: 10px; }
        .add-btn { 
            background: linear-gradient(45deg, var(--primary), #45a049);
            color: white; 
            padding: 10px 15px; 
            border: none; 
            border-radius: 20px; 
            cursor: pointer; 
            font-size: 16px; 
            transition: all 0.3s ease;
        }
        .add-btn:hover { box-shadow: 0 4px 8px rgba(76,175,80,0.3); transform: scale(1.05); }
        .add-btn:disabled { background: var(--border); cursor: not-allowed; transform: none; }
        input, select, button {
            margin: 5px; 
            padding: 12px; 
            border: 1px solid var(--border); 
            border-radius: 6px; 
            font-size: var(--text-large);
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        input:focus, select:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 5px rgba(33,150,243,0.3); }
        input:disabled, select:disabled { background: #f0f0f0; cursor: not-allowed; }
        .form-group { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            align-items: center; 
            margin-bottom: 15px; 
            font-size: var(--text-large);
        }
        .form-group label { min-width: 120px; font-weight: bold; color: var(--dark); }
        .file-info { font-size: 14px; color: var(--secondary); margin-left: 10px; }
        .table-container {
            overflow-x: auto; 
            margin-top: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 800px; 
            background: white;
            font-size: 14px; 
        }
        th, td { 
            padding: 15px 12px; 
            text-align: left; 
            border-bottom: 1px solid var(--border); 
            word-wrap: break-word; 
            max-width: 150px; 
            vertical-align: top;
        }
        th { 
            background: linear-gradient(45deg, var(--primary), #45a049); 
            color: white; 
            font-weight: bold; 
            position: sticky; top: 0;
            z-index: 10;
            white-space: nowrap; 
        }
        tr:hover { background: var(--light); }
        .metrics { 
            font-weight: bold; 
            font-size: 16px; 
            padding: 10px; 
        }
        .positive { color: var(--primary); }
        .negative { color: var(--danger); }
        .neutral { color: var(--warning); }
        .metrics-group { 
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            border-bottom: 1px dotted var(--border);
        }
        .metric-label { font-weight: bold; color: var(--dark); }
        .form-popup { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 50%; 
            top: 50%; 
            transform: translate(-50%, -50%); 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
            min-width: 350px; 
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }
        @keyframes modalSlide { from { opacity: 0; transform: translate(-50%, -60%); } to { opacity: 1; transform: translate(-50%, -50%); } }
        .form-container { display: flex; flex-direction: column; gap: 15px; }
        .form-container input { width: 100%; box-sizing: border-box; font-size: var(--text-large); }
        .btn-close { background: var(--danger); color: white; margin-left: 10px; }
        .btn-close:hover { background: #d32f2f; }
        .tabs { 
            display: flex; 
            background: var(--light); 
            border-radius: 8px 8px 0 0; 
            overflow: hidden; 
            margin-bottom: 0; 
            font-size: var(--text-large);
        }
        .tab-btn { 
            flex: 1; 
            padding: 15px; 
            background: none; 
            border: none; 
            cursor: pointer; 
            font-weight: bold; 
            transition: all 0.3s;
        }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .blogger-card, .book-card { 
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: box-shadow 0.3s;
            font-size: var(--text-large);
        }
        .blogger-card:hover, .book-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 10px;
            font-size: 18px; 
        }
        .card-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        .card-actions {
            display: flex;
            gap: 10px;
        }
        .card-actions button {
            padding: 8px 12px;
            font-size: 14px;
        }
        .progress { width: 100%; height: 8px; background: var(--light); border-radius: 4px; overflow: hidden; margin: 10px 0; }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, var(--primary), var(--secondary)); 
            transition: width 0.3s ease-in-out; 
            width: 0%; 
            border-radius: 4px;
        }
        .progress-text { font-size: 14px; color: var(--dark); margin-top: 5px; text-align: center; }
        .tooltip { 
            position: relative; 
            display: inline-block; 
            border-bottom: 1px dotted #ccc; 
            cursor: help; 
            font-size: var(--text-large);
        }
        .tooltip .tooltiptext { 
            visibility: hidden; 
            background: var(--dark); 
            color: white; 
            text-align: center; 
            padding: 8px 12px; 
            border-radius: 6px; 
            position: absolute; 
            z-index: 1; 
            bottom: 125%; 
            left: 50%; 
            margin-left: -80px; 
            opacity: 0; 
            transition: opacity 0.3s;
            white-space: nowrap; 
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--warning);
            font-size: 18px;
            font-style: italic;
        }
        .success-message {
            background: var(--primary);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .error-message {
            background: var(--danger);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--light);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
            body { font-size: 14px; padding: 10px; }
            .form-group { flex-direction: column; align-items: stretch; }
            .form-group label { min-width: auto; }
            table { font-size: 12px; min-width: 600px; }
            th, td { padding: 10px 8px; max-width: 120px; }
            .card-details { grid-template-columns: 1fr; }
            .metrics { font-size: 14px; }
            .tabs { flex-direction: column; }
            .tab-btn { border-bottom: 1px solid var(--border); }
        }
        .status-indicator {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-ready { background: var(--light); color: var(--primary); }
        .status-loading { background: var(--warning); color: white; }
        .status-success { background: var(--primary); color: white; }
        .status-error { background: var(--danger); color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-chart-line"></i> –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –±–ª–æ–≥–µ—Ä–æ–≤ (v7.3: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Excel)</h1>
        <p style="text-align: center; color: var(--secondary); font-size: 14px;">
            <i class="fas fa-check-circle"></i> SheetJS –ø–æ–¥–∫–ª—é—á–µ–Ω ‚Äî Excel —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
        </p>

        <!-- –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div style="text-align: center; margin-bottom: 20px;">
            <div class="status-indicator status-ready" id="loadStatus">
                <i class="fas fa-check"></i> –ì–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="load" onclick="switchTab('load')"><i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∫–∞</button>
            <button class="tab-btn" data-tab="bloggers" onclick="switchTab('bloggers')"><i class="fas fa-users"></i> –ë–ª–æ–≥–≥–µ—Ä—ã (<span id="bloggerCount">0</span>)</button>
            <button class="tab-btn" data-tab="books" onclick="switchTab('books')"><i class="fas fa-book"></i> –ö–Ω–∏–≥–∏ (<span id="bookCount">0</span>)</button>
            <button class="tab-btn" data-tab="campaigns" onclick="switchTab('campaigns')"><i class="fas fa-plus"></i> –ö–∞–º–ø–∞–Ω–∏–∏</button>
            <button class="tab-btn" data-tab="data" onclick="switchTab('data')"><i class="fas fa-table"></i> –î–∞–Ω–Ω—ã–µ (<span id="campaignCount">0</span>)</button>
            <button class="tab-btn" data-tab="analysis" onclick="switchTab('analysis')"><i class="fas fa-analytics"></i> –ê–Ω–∞–ª–∏–∑</button>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
        <div id="load" class="section tab-content active">
            <h2><i class="fas fa-cloud-download-alt"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
            
            <!-- Google Sheets -->
            <div class="form-group">
                <label><i class="fas fa-file-csv"></i> Google Sheets (CSV):</label>
                <input type="text" id="csvUrl" placeholder="https://docs.google.com/spreadsheets/d/.../pub?output=csv" size="60" 
                       value="https://docs.google.com/spreadsheets/d/e/2PACX-1v.../pub?output=csv">
                <div class="status-indicator status-ready" style="margin-left: 10px;">–ì–æ—Ç–æ–≤</div>
            </div>
            <button class="add-btn" onclick="loadFromSheets()" id="sheetsBtn">
                <i class="fas fa-file-csv"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Sheets
            </button>

            <!-- Excel -->
            <div class="form-group" style="margin-top: 20px;">
                <label><i class="fas fa-file-excel"></i> Excel —Ñ–∞–π–ª (.xlsx, .xls):</label>
                <input type="file" id="excelFile" accept=".xlsx,.xls" onchange="loadFromExcel(event)" style="margin-right: 10px;">
                <button class="add-btn" onclick="document.getElementById('excelFile').click()">
                    <i class="fas fa-file-excel"></i> –í—ã–±—Ä–∞—Ç—å Excel —Ñ–∞–π–ª
                </button>
                <div class="file-info" id="fileInfo" style="display: none;"></div>
                <div class="status-indicator status-ready" style="margin-left: 10px;">–ì–æ—Ç–æ–≤</div>
            </div>

            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
            <div class="progress" id="progressContainer" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
            </div>
            
            <div id="loadMessage"></div>
            
            <details style="margin-top: 20px;">
                <summary><i class="fas fa-info-circle"></i> –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö</summary>
                <div style="padding: 15px; background: var(--light); border-radius: 6px; font-size: 14px;">
                    <p><strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–î–∞—Ç–∞ (YYYY-MM-DD)</li>
                        <li>–ë–ª–æ–≥–µ—Ä (–∏–º—è –∏–ª–∏ –Ω–∏–∫)</li>
                        <li>–ö–Ω–∏–≥–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ)</li>
                        <li>–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</li>
                        <li>–ß–ü —Å –∫–Ω–∏–≥–∏ (—Ä—É–±.)</li>
                        <li>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç.)</li>
                    </ul>
                    <p><small>–ö–æ–ª–æ–Ω–∫–∏ –º–æ–≥—É—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ.</small></p>
                </div>
            </details>
        </div>

        <!-- –ë–ª–æ–≥–≥–µ—Ä—ã -->
        <div id="bloggers" class="section tab-content">
            <h2><i class="fas fa-users"></i> –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –±–ª–æ–≥–µ—Ä–æ–≤</h2>
            <div class="form-group">
                <span class="toggle-btn" onclick="toggleSection('bloggersList')"><i class="fas fa-eye-slash"></i> –°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫</span>
                <button class="add-btn" onclick="showAddBlogger()"><i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞</button>
                <button class="btn-close" onclick="deleteAllBloggers()" style="margin-left: 10px;"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö</button>
            </div>
            <div id="bloggersList">
                <div class="empty-state">
                    <i class="fas fa-users" style="font-size: 48px; color: var(--warning); margin-bottom: 10px;"></i>
                    <p>–ù–µ—Ç –±–ª–æ–≥–µ—Ä–æ–≤. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é.</p>
                    <button class="add-btn" onclick="showAddBlogger()" style="padding: 8px 15px; font-size: 14px; margin-top: 10px;">
                        <i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ –±–ª–æ–≥–µ—Ä–∞
                    </button>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–∏–≥–∏ -->
        <div id="books" class="section tab-content">
            <h2><i class="fas fa-book"></i> –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–Ω–∏–≥</h2>
            <div class="form-group">
                <span class="toggle-btn" onclick="toggleSection('booksList')"><i class="fas fa-eye-slash"></i> –°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫</span>
                <button class="add-btn" onclick="showAddBook()"><i class="fas fa-book-open"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</button>
                <button class="btn-close" onclick="deleteAllBooks()" style="margin-left: 10px;"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ</button>
            </div>
            <div id="booksList">
                <div class="empty-state">
                    <i class="fas fa-book" style="font-size: 48px; color: var(--warning); margin-bottom: 10px;"></i>
                    <p>–ù–µ—Ç –∫–Ω–∏–≥. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é.</p>
                    <button class="add-btn" onclick="showAddBook()" style="padding: 8px 15px; font-size: 14px; margin-top: 10px;">
                        <i class="fas fa-book-open"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∫–Ω–∏–≥—É
                    </button>
                </div>
            </div>
        </div>

        <!-- –ö–∞–º–ø–∞–Ω–∏–∏ -->
        <div id="campaigns" class="section tab-content">
            <h2><i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é</h2>
            <div class="form-group">
                <label>–î–∞—Ç–∞ –∫–∞–º–ø–∞–Ω–∏–∏:</label> 
                <input type="date" id="campaignDate">
                <label>–ë–ª–æ–≥–µ—Ä:</label> 
                <select id="campaignBlogger">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–≥–µ—Ä–∞</option>
                </select>
            </div>
            <div class="form-group">
                <label>–ö–Ω–∏–≥–∞:</label> 
                <select id="campaignBook">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É</option>
                </select>
                <label>–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.):</label> 
                <input type="number" id="campaignCost" min="0" step="0.01" placeholder="0.00">
            </div>
            <div class="form-group">
                <label>–ß–ü —Å –∫–Ω–∏–≥–∏ (—Ä—É–±.):</label> 
                <input type="number" id="campaignCP" min="0" step="0.01" placeholder="0.00">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç.):</label> 
                <input type="number" id="campaignQty" min="0" placeholder="0">
            </div>
            <div class="form-group" style="justify-content: flex-start;">
                <button class="add-btn" onclick="addCampaign()" id="addCampaignBtn">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
                </button>
                <button class="btn-close" onclick="clearCampaignForm()" style="margin-left: 10px;">
                    <i class="fas fa-eraser"></i> –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                </button>
            </div>
        </div>

        <!-- –î–∞–Ω–Ω—ã–µ -->
        <div id="data" class="section tab-content">
            <h2><i class="fas fa-table"></i> –í—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏</h2>
            <div class="form-group">
                <button class="add-btn" onclick="updateList()"><i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                <button class="add-btn" onclick="applyFilters()"><i class="fas fa-filter"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                <button class="btn-close" onclick="clearFilters()" style="margin-left: 10px;"><i class="fas fa-eraser"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                <button class="btn-close" onclick="deleteAllCampaigns()" style="margin-left: 10px;"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ</button>
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div style="background: var(--light); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <h3 style="margin-top: 0;"><i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä—ã</h3>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –æ—Ç:</label> <input type="date" id="filterDateFrom">
                    <label>–î–∞—Ç–∞ –¥–æ:</label> <input type="date" id="filterDateTo">
                </div>
                <div class="form-group">
                    <label>–ë–ª–æ–≥–µ—Ä:</label> 
                    <select id="filterBlogger">
                        <option value="">–í—Å–µ –±–ª–æ–≥–µ—Ä—ã</option>
                    </select>
                    <label>–ö–Ω–∏–≥–∞:</label> 
                    <select id="filterBook">
                        <option value="">–í—Å–µ –∫–Ω–∏–≥–∏</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ROI –æ—Ç (%):</label> <input type="number" id="filterROIMin" min="-100" step="1" placeholder="-100">
                    <label>ROI –¥–æ (%):</label> <input type="number" id="filterROIMax" step="1" placeholder="1000">
                </div>
                <div class="form-group">
                    <label>ROAS –æ—Ç:</label> <input type="number" id="filterROASMin" min="0" step="0.1" placeholder="0">
                    <label>ROAS –¥–æ:</label> <input type="number" id="filterROASMax" step="0.1" placeholder="10">
                </div>
                <div class="form-group">
                    <label>CPS –æ—Ç (—Ä—É–±.):</label> <input type="number" id="filterCPSMin" min="0" step="0.01" placeholder="0">
                    <label>CPS –¥–æ (—Ä—É–±.):</label> <input type="number" id="filterCPSMax" step="0.01" placeholder="1000">
                </div>
            </div>

            <div class="table-container" id="dataList">
                <div class="empty-state">
                    <i class="fas fa-table" style="font-size: 48px; color: var(--warning); margin-bottom: 10px;"></i>
                    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                    <p style="font-size: 14px; color: var(--dark);">
                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel/CSV —Ñ–∞–π–ª –∏–ª–∏ <a href="#" onclick="switchTab('campaigns'); return false;" style="color: var(--secondary);">–¥–æ–±–∞–≤—å—Ç–µ –∫–∞–º–ø–∞–Ω–∏—é –≤—Ä—É—á–Ω—É—é</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- –ê–Ω–∞–ª–∏–∑ -->
        <div id="analysis" class="section tab-content">
            <h2><i class="fas fa-chart-bar"></i> –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
            <div class="form-group">
                <button class="add-btn" onclick="analyzeTop()" id="analyzeBtn"><i class="fas fa-magic"></i> –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø-10</button>
                <button class="add-btn" onclick="showSummary()" style="margin-left: 10px;"><i class="fas fa-chart-pie"></i> –û–±—â–∞—è —Å–≤–æ–¥–∫–∞</button>
                <button class="btn-close" onclick="exportData()" style="margin-left: 10px;"><i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>
            <div id="topBloggers" style="min-height: 200px;">
                <div class="empty-state">
                    <i class="fas fa-chart-bar" style="font-size: 48px; color: var(--warning); margin-bottom: 10px;"></i>
                    <p>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç–æ–ø-10</p>
                </div>
            </div>
            
            <!-- –®–ø–∞—Ä–≥–∞–ª–∫–∞ -->
            <details style="margin-top: 20px;">
                <summary><i class="fas fa-info-circle"></i> üìã –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º</summary>
                <div style="padding: 15px; background: var(--light); border-radius: 6px; font-size: var(--text-large);">
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px;">
                        <div>
                            <h4 style="margin-top: 0; color: var(--primary);"><strong>ROI (%)</strong></h4>
                            <p><code>(–ü—Ä–∏–±—ã–ª—å - –ó–∞—Ç—Ä–∞—Ç—ã) / –ó–∞—Ç—Ä–∞—Ç—ã √ó 100</code></p>
                            <p class="tooltip">>100% <span class="tooltiptext">–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–∏–±—ã–ª—å –≤ 2+ —Ä–∞–∑–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã</span></p>
                            <p class="tooltip">>500% <span class="tooltiptext">–°—É–ø–µ—Ä! 6x –æ—Ç–¥–∞—á–∞ –æ—Ç –≤–ª–æ–∂–µ–Ω–∏–π</span></p>
                            <p class="negative">&lt;0% <span class="tooltiptext">–£–±—ã—Ç–æ–∫, –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</span></p>
                        </div>
                        <div>
                            <h4 style="margin-top: 0; color: var(--secondary);"><strong>ROAS</strong></h4>
                            <p><code>–ü—Ä–∏–±—ã–ª—å / –ó–∞—Ç—Ä–∞—Ç—ã</code></p>
                            <p class="tooltip">>3 <span class="tooltiptext">–û—Ç–ª–∏—á–Ω–æ! –ö–∞–∂–¥—ã–π —Ä—É–±–ª—å –ø—Ä–∏–Ω–æ—Å–∏—Ç 3+ —Ä—É–±–ª—è –ø—Ä–∏–±—ã–ª–∏</span></p>
                            <p class="tooltip">>5 <span class="tooltiptext">–ò–¥–µ–∞–ª—å–Ω–æ! 5x –æ—Ç–¥–∞—á–∞</span></p>
                            <p class="negative">&lt;1 <span class="tooltiptext">–£–±—ã—Ç–æ—á–Ω–æ</span></p>
                        </div>
                        <div>
                            <h4 style="color: var(--warning);"><strong>CPS (—Ä—É–±./—à—Ç.)</strong></h4>
                            <p><code>–ó–∞—Ç—Ä–∞—Ç—ã / –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</code></p>
                            <p class="tooltip">&lt;–ß–ü <span class="tooltiptext">–í—ã–≥–æ–¥–Ω–æ! –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –Ω–∏–∂–µ –ø—Ä–∏–±—ã–ª–∏ —Å –µ–¥–∏–Ω–∏—Ü—ã</span></p>
                            <p class="tooltip">=–ß–ü <span class="tooltiptext">–ù—É–ª–µ–≤–∞—è –ø—Ä–∏–±—ã–ª—å, —Ç–æ–ª—å–∫–æ –ø–æ–∫—Ä—ã—Ç–∏–µ –∑–∞—Ç—Ä–∞—Ç</span></p>
                            <p class="negative">&gt;–ß–ü <span class="tooltiptext">–£–±—ã—Ç–æ—á–Ω–æ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É</span></p>
                        </div>
                    </div>
                    <p style="margin-top: 15px; font-style: italic; color: var(--dark);">
                        <strong>–ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—Ö–∞:</strong> ROI=1869%, ROAS=19.69 (logoped.arshinova) ‚Äî –∫–∞–∂–¥–∞—è 1 —Ä—É–±–ª—å –≤–ª–æ–∂–µ–Ω–∏–π –ø—Ä–∏–Ω–µ—Å–ª–∞ 19.69 —Ä—É–±. –ø—Ä–∏–±—ã–ª–∏!
                    </p>
                </div>
            </details>
        </div>

        <!-- –°–±—Ä–æ—Å -->
        <div class="section" style="text-align: center; margin-top: 30px; padding: 20px; background: #fff3cd; border: 1px solid var(--warning); border-radius: 8px;">
            <h3 style="color: var(--warning); margin-top: 0;"><i class="fas fa-exclamation-triangle"></i> ‚ö†Ô∏è –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</h3>
            <p style="color: var(--dark);">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ <strong>–Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ</strong> —É–¥–∞–ª–∏—Ç –≤—Å–µ—Ö –±–ª–æ–≥–µ—Ä–æ–≤, –∫–Ω–∏–≥–∏ –∏ –∫–∞–º–ø–∞–Ω–∏–∏.</p>
            <button class="btn-close" onclick="showReset()" style="padding: 12px 20px; font-size: 16px; margin: 10px;">
                <i class="fas fa-bomb"></i> <strong>–°–±—Ä–æ—Å–∏—Ç—å –í–°–Å</strong>
            </button>
            <p style="font-size: 12px; color: var(--warning); margin-top: 10px;">
                <strong>–ü–∞—Ä–æ–ª—å:</strong> <code>admin</code> (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–¥–µ)
            </p>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div id="addBloggerModal" class="form-popup">
            <div class="form-container">
                <h3><i class="fas fa-user-edit"></i> <span id="bloggerModalTitle">–î–æ–±–∞–≤–∏—Ç—å</span> –±–ª–æ–≥–µ—Ä–∞</h3>
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–≥–µ—Ä–∞ <span style="color: var(--danger);">*</span>:</label>
                <input type="text" id="bloggerName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: logoped.arshinova" maxlength="100" required>
                <label>–°—Å—ã–ª–∫–∞ (Telegram/Instagram):</label>
                <input type="url" id="bloggerLink" placeholder="https://t.me/username –∏–ª–∏ https://instagram.com/username">
                <div class="form-group" style="justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="add-btn" id="saveBloggerBtn"><i class="fas fa-check"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn-close" onclick="hideAddBlogger()"><i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞</button>
                </div>
                <p style="font-size: 12px; color: var(--dark); margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> –ü–æ–ª–µ "–ù–∞–∑–≤–∞–Ω–∏–µ" –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –°—Å—ã–ª–∫–∞ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞.
                </p>
            </div>
        </div>

        <div id="addBookModal" class="form-popup">
            <div class="form-container">
                <h3><i class="fas fa-book"></i> <span id="bookModalTitle">–î–æ–±–∞–≤–∏—Ç—å</span> –∫–Ω–∏–≥—É</h3>
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ <span style="color: var(--danger);">*</span>:</label>
                <input type="text" id="bookName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–æ–≥–æ–ø–µ–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π" maxlength="150" required>
                <label>–ß–ü —Å –∫–Ω–∏–≥–∏ (—Ä—É–±.) <span style="color: var(--danger);">*</span>:</label>
                <input type="number" id="bookCP" min="0" step="0.01" placeholder="0.00" required>
                <div class="form-group" style="justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="add-btn" id="saveBookBtn"><i class="fas fa-check"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn-close" onclick="hideAddBook()"><i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞</button>
                </div>
                <p style="font-size: 12px; color: var(--dark); margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> –ß–ü ‚Äî —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å —Å –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.
                </p>
            </div>
        </div>

        <div id="editCampaignModal" class="form-popup">
            <div class="form-container">
                <h3><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é</h3>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ <span style="color: var(--danger);">*</span>:</label> 
                    <input type="date" id="editDate" required>
                    <label>–ë–ª–æ–≥–µ—Ä <span style="color: var(--danger);">*</span>:</label> 
                    <select id="editBlogger" required></select>
                </div>
                <div class="form-group">
                    <label>–ö–Ω–∏–≥–∞ <span style="color: var(--danger);">*</span>:</label> 
                    <select id="editBook" required></select>
                    <label>–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.) <span style="color: var(--danger);">*</span>:</label> 
                    <input type="number" id="editCost" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>–ß–ü —Å –∫–Ω–∏–≥–∏ (—Ä—É–±.) <span style="color: var(--danger);">*</span>:</label> 
                    <input type="number" id="editCP" min="0" step="0.01" required>
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç.) <span style="color: var(--danger);">*</span>:</label> 
                    <input type="number" id="editQty" min="0" required>
                </div>
                <div class="form-group" style="justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="add-btn" id="saveCampaignBtn"><i class="fas fa-check"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <button class="btn-close" onclick="hideEditCampaign()"><i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <div id="resetModal" class="form-popup">
            <div class="form-container">
                <h3><i class="fas fa-exclamation-triangle"></i> <strong style="color: var(--danger);">–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å</strong></h3>
                <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 4px solid var(--danger); margin-bottom: 20px;">
                    <p style="margin: 0; color: var(--danger); font-weight: bold;">
                        <i class="fas fa-exclamation-triangle"></i> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!
                    </p>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--dark);">
                        <li>üóëÔ∏è –£–¥–∞–ª–∏—Ç <strong id="resetBloggersCount">0</strong> –±–ª–æ–≥–µ—Ä–æ–≤</li>
                        <li>üìö –£–¥–∞–ª–∏—Ç <strong id="resetBooksCount">0</strong> –∫–Ω–∏–≥</li>
                        <li>üìä –£–¥–∞–ª–∏—Ç <strong id="resetCampaignsCount">0</strong> –∫–∞–º–ø–∞–Ω–∏–π</li>
                        <li>üíæ –û—á–∏—Å—Ç–∏—Ç localStorage –ø–æ–ª–Ω–æ—Å—Ç—å—é</li>
                    </ul>
                </div>
                <label style="font-weight: bold;">–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ <span style="color: var(--danger);">*</span>:</label>
                <input type="password" id="resetPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" maxlength="20" required>
                <div class="form-group" style="justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="btn-close" onclick="resetAll()" id="confirmResetBtn" disabled style="padding: 12px 20px; font-size: 16px;">
                        <i class="fas fa-bomb"></i> <strong>–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –°–ë–†–û–°</strong>
                    </button>
                    <button class="add-btn" onclick="hideReset()"><i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞</button>
                </div>
                <div style="text-align: center; margin-top: 15px; font-size: 12px; color: var(--warning); padding: 10px; background: #fff3cd; border-radius: 6px;">
                    <strong>–ü–∞—Ä–æ–ª—å:</strong> <code>admin</code><br>
                    <small>–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ —Ñ—É–Ω–∫—Ü–∏–∏ resetAll() –≤ –∫–æ–¥–µ</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let bloggers = JSON.parse(localStorage.getItem('bloggers') || '[]');
        let books = JSON.parse(localStorage.getItem('books') || '[]');
        let campaigns = JSON.parse(localStorage.getItem('campaigns') || '[]');
        let dataLoaded = false;
        let currentEditIndex = -1;
        let isEditingBlogger = false;
        let isEditingBook = false;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        function updateCounters() {
            document.getElementById('bloggerCount').textContent = bloggers.length;
            document.getElementById('bookCount').textContent = books.length;
            document.getElementById('campaignCount').textContent = campaigns.length;
            document.getElementById('resetBloggersCount').textContent = bloggers.length;
            document.getElementById('resetBooksCount').textContent = books.length;
            document.getElementById('resetCampaignsCount').textContent = campaigns.length;
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function initApp() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –±–ª–æ–≥–µ—Ä–æ–≤ v7.3');
            console.log('üìä SheetJS:', typeof XLSX !== 'undefined' ? '‚úì –ó–∞–≥—Ä—É–∂–µ–Ω' : '‚úó –ù–µ –Ω–∞–π–¥–µ–Ω');
            console.log('üìà –ó–∞–≥—Ä—É–∂–µ–Ω–æ: –±–ª–æ–≥–µ—Ä–æ–≤=' + bloggers.length + ', –∫–Ω–∏–≥=' + books.length + ', –∫–∞–º–ø–∞–Ω–∏–π=' + campaigns.length);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
            const requiredElements = ['bloggersList', 'booksList', 'dataList', 'csvUrl', 'excelFile', 'progressBar', 'loadStatus'];
            let allElementsFound = true;
            
            requiredElements.forEach(function(id) {
                if (!document.getElementById(id)) {
                    console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:', id);
                    allElementsFound = false;
                }
            });
            
            if (!allElementsFound) {
                console.error('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ DOM. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                showError('–û—à–∏–±–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5).');
                return false;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            populateSelects();
            renderBloggers();
            renderBooks();
            updateCounters();
            
            if (campaigns.length > 0) {
                dataLoaded = true;
                updateList();
                document.getElementById('loadStatus').innerHTML = '<i class="fas fa-check"></i> –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                document.getElementById('loadStatus').className = 'status-indicator status-success';
            }

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
            switchTab('load');
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            setupEventListeners();
            
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ');
            showMessage('–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! SheetJS –ø–æ–¥–∫–ª—é—á–µ–Ω –¥–ª—è Excel.', 'success');
            return true;
        }

        function setupEventListeners() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è —Å–±—Ä–æ—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            const resetPassword = document.getElementById('resetPassword');
            if (resetPassword) {
                resetPassword.addEventListener('input', function() {
                    const confirmBtn = document.getElementById('confirmResetBtn');
                    if (confirmBtn) {
                        confirmBtn.disabled = this.value !== 'admin';
                        confirmBtn.style.opacity = this.value === 'admin' ? '1' : '0.5';
                    }
                });
            }
        }

        // ==================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ====================
        function switchTab(tabId) {
            try {
                console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É:', tabId);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                const allTabs = document.querySelectorAll('.tab-content');
                allTabs.forEach(function(tab) {
                    if (tab && tab.classList.contains('active')) {
                        tab.classList.remove('active');
                    }
                });

                // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                const allButtons = document.querySelectorAll('.tab-btn');
                allButtons.forEach(function(btn) {
                    if (btn && btn.classList.contains('active')) {
                        btn.classList.remove('active');
                    }
                });

                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                const targetTab = document.getElementById(tabId);
                if (targetTab) {
                    targetTab.classList.add('active');
                }

                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                const targetButton = document.querySelector('.tab-btn[data-tab="' + tabId + '"]');
                if (targetButton) {
                    targetButton.classList.add('active');
                }

                // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
                if (tabId === 'data' && campaigns.length > 0) {
                    updateList();
                } else if (tabId === 'analysis' && campaigns.length > 0) {
                    // –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
                }

                console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ "' + tabId + '" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ switchTab:', error);
                showError('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê GOOGLE SHEETS ====================
        function loadFromSheets() {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const loadMessage = document.getElementById('loadMessage');
            const sheetsBtn = document.getElementById('sheetsBtn');
            const loadStatus = document.getElementById('loadStatus');
            const urlInput = document.getElementById('csvUrl');
            
            if (!progressBar || !progressText || !loadMessage || !sheetsBtn || !loadStatus || !urlInput) {
                showError('–û—à–∏–±–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                return;
            }

            const url = urlInput.value.trim();
            if (!url || !url.includes('docs.google.com')) {
                showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ Google Sheets!');
                urlInput.focus();
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progressContainer.style.display = 'block';
            sheetsBtn.disabled = true;
            sheetsBtn.innerHTML = '<div class="loading"></div> –ó–∞–≥—Ä—É–∑–∫–∞...';
            loadStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞';
            loadStatus.className = 'status-indicator status-loading';
            loadMessage.innerHTML = '';

            // –§–æ—Ä–º–∏—Ä—É–µ–º URL
            let csvUrl = url;
            if (!url.includes('/pub?output=csv')) {
                const baseUrl = url.includes('/edit') ? url.split('/edit')[0] : url;
                csvUrl = baseUrl + '/pub?output=csv';
            }

            console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ CSV:', csvUrl);

            fetch(csvUrl, { 
                method: 'GET',
                headers: { 'Accept': 'text/csv,*/*' },
                mode: 'cors'
            })
            .then(function(response) {
                progressBar.style.width = '30%';
                progressText.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...';
                
                if (!response.ok) {
                    let errorMsg = '–û—à–∏–±–∫–∞ HTTP ' + response.status;
                    if (response.status === 404) errorMsg += ' (—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω)';
                    if (response.status === 403) errorMsg += ' (–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞)';
                    throw new Error(errorMsg);
                }
                
                if (!response.headers.get('content-type') || !response.headers.get('content-type').includes('text/csv')) {
                    throw new Error('–û—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç CSV –¥–∞–Ω–Ω—ã—Ö');
                }
                
                return response.text();
            })
            .then(function(csvText) {
                progressBar.style.width = '60%';
                progressText.textContent = '–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö...';
                
                if (!csvText || csvText.trim().length < 10) {
                    throw new Error('CSV —Ñ–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω');
                }
                
                parseCSV(csvText, 'sheets');
                
                progressBar.style.width = '90%';
                progressText.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
                
            })
            .catch(function(error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Sheets:', error);
                
                progressBar.style.width = '0%';
                progressText.textContent = '–û—à–∏–±–∫–∞';
                sheetsBtn.disabled = false;
                sheetsBtn.innerHTML = '<i class="fas fa-file-csv"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Sheets';
                loadStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞';
                loadStatus.className = 'status-indicator status-error';
                
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Google Sheets:<br>' + error.message + '<br><br><strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</strong><br>' +
                         '‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞<br>' +
                         '‚Ä¢ –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –ø—É–±–ª–∏—á–Ω–æ<br>' +
                         '‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É<br>' +
                         '‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç CSV');
                
                loadMessage.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i> ' + error.message + '</div>';
            })
            .finally(function() {
                // –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤—Å–µ–≥–¥–∞)
                setTimeout(function() {
                    progressContainer.style.display = 'none';
                    if (dataLoaded) {
                        loadStatus.innerHTML = '<i class="fas fa-check"></i> –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ';
                        loadStatus.className = 'status-indicator status-success';
                        loadMessage.innerHTML = '<div class="success-message"><i class="fas fa-check-circle"></i> –ó–∞–≥—Ä—É–∂–µ–Ω–æ ' + campaigns.length + ' –∫–∞–º–ø–∞–Ω–∏–π! –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î–∞–Ω–Ω—ã–µ".</div>';
                        switchTab('data');
                    }
                }, 1500);
            });
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê EXCEL (–ü–û–õ–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø) ====================
        function loadFromExcel(event) {
            console.log('üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ Excel —Ñ–∞–π–ª–∞...');
            
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const loadMessage = document.getElementById('loadMessage');
            const fileInput = document.getElementById('excelFile');
            const fileInfo = document.getElementById('fileInfo');
            const loadStatus = document.getElementById('loadStatus');
            
            if (!progressBar || !progressText || !loadMessage || !fileInput || !fileInfo || !loadStatus) {
                showError('–û—à–∏–±–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Excel');
                return;
            }

            const file = event.target.files[0];
            if (!file) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤—ã–±–æ—Ä
                fileInput.value = '';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞
            if (!file.name.match(/\.(xlsx?|xls)$/i)) {
                showError('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx –∏–ª–∏ .xls)');
                fileInput.value = '';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä (–º–∞–∫—Å 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showError('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 10MB). –í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω—å—à–∏–π —Ñ–∞–π–ª.');
                fileInput.value = '';
                return;
            }

            console.log('‚úÖ –§–∞–π–ª –≤–∞–ª–∏–¥–µ–Ω:', file.name, '(' + (file.size / 1024 / 1024).toFixed(2) + ' MB)');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
            fileInfo.style.display = 'inline';
            fileInfo.innerHTML = '<i class="fas fa-file-excel"></i> ' + escapeHtml(file.name) + ' (' + (file.size / 1024).toFixed(1) + ' –ö–ë)';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progressContainer.style.display = 'block';
            loadStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ß—Ç–µ–Ω–∏–µ Excel...';
            loadStatus.className = 'status-indicator status-loading';
            loadMessage.innerHTML = '';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º SheetJS
            if (typeof XLSX === 'undefined') {
                console.error('‚ùå SheetJS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                showError('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ SheetJS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
                progressContainer.style.display = 'none';
                loadStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞';
                loadStatus.className = 'status-indicator status-error';
                fileInput.value = '';
                fileInfo.style.display = 'none';
                return;
            }

            const reader = new FileReader();
            
            reader.onerror = function() {
                console.error('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
                showError('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ Excel');
                resetExcelUpload();
            };
            
            reader.onprogress = function(e) {
                if (e.lengthComputable) {
                    const percent = (e.loaded / e.total * 100).toFixed(0);
                    progressBar.style.width = percent + '%';
                    progressText.textContent = '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞... ' + percent + '%';
                }
            };
            
            reader.onload = function(e) {
                try {
                    progressText.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ Excel...';
                    progressBar.style.width = '40%';
                    
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { 
                        type: 'array',
                        cellDates: true, // –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏
                        cellNF: false
                    });
                    
                    progressBar.style.width = '60%';
                    progressText.textContent = '–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...';
                    
                    // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç –∏–ª–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Sheet1", "Data", etc.
                    let sheetName = workbook.SheetNames[0];
                    const preferredNames = ['Sheet1', 'Data', '–ö–∞–º–ø–∞–Ω–∏–∏', 'Campaigns'];
                    for (let name of preferredNames) {
                        if (workbook.SheetNames.includes(name)) {
                            sheetName = name;
                            break;
                        }
                    }
                    
                    const worksheet = workbook.Sheets[sheetName];
                    if (!worksheet) {
                        throw new Error('–õ–∏—Å—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ JSON –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                        header: 1,
                        defval: '',
                        blankrows: false,
                        dateNF: 'yyyy-mm-dd'
                    });
                    
                    progressBar.style.width = '75%';
                    progressText.textContent = '–ü–∞—Ä—Å–∏–Ω–≥ ' + jsonData.length + ' —Å—Ç—Ä–æ–∫...';
                    
                    if (jsonData.length < 2) {
                        throw new Error('–í —Ñ–∞–π–ª–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (–º–∏–Ω–∏–º—É–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ + 1 —Å—Ç—Ä–æ–∫–∞)');
                    }
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ CSV –¥–ª—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
                    const csvText = XLSX.utils.sheet_to_csv(worksheet, { 
                        FS: ',',
                        RS: '\n',
                        dateNF: 'yyyy-mm-dd',
                        strip: true
                    });
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 2000 —Å—Ç—Ä–æ–∫ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                    const limitedCsv = csvText.split('\n').slice(0, 2001).join('\n');
                    
                    progressBar.style.width = '85%';
                    progressText.textContent = '–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...';
                    
                    parseCSV(limitedCsv, 'excel', {
                        sourceFile: file.name,
                        sheetName: sheetName,
                        totalRows: jsonData.length
                    });
                    
                    progressBar.style.width = '100%';
                    progressText.textContent = '–ì–æ—Ç–æ–≤–æ!';
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel:', error);
                    showError('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel:<br>' + error.message + '<br><br><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</strong><br>' +
                             '‚Ä¢ –§–∞–π–ª –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω<br>' +
                             '‚Ä¢ –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ<br>' +
                             '‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫');
                    resetExcelUpload();
                    return;
                }
                
                // –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                setTimeout(function() {
                    progressContainer.style.display = 'none';
                    fileInput.value = '';
                    fileInfo.style.display = 'none';
                    
                    loadStatus.innerHTML = '<i class="fas fa-check"></i> Excel –∑–∞–≥—Ä—É–∂–µ–Ω';
                    loadStatus.className = 'status-indicator status-success';
                    
                    loadMessage.innerHTML = `
                        <div class="success-message">
                            <i class="fas fa-check-circle"></i> 
                            Excel —Ñ–∞–π–ª "<strong>${escapeHtml(file.name)}</strong>" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!
                            <br><small>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${campaigns.length} –∫–∞–º–ø–∞–Ω–∏–π –∏–∑ –ª–∏—Å—Ç–∞ "${sheetName}"</small>
                        </div>
                    `;
                    
                    dataLoaded = true;
                    updateList();
                    updateCounters();
                    switchTab('data');
                    populateSelects();
                    
                    console.log('‚úÖ Excel —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω:', campaigns.length, '–∫–∞–º–ø–∞–Ω–∏–π');
                }, 1500);
                
            };
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —á—Ç–µ–Ω–∏–µ
            reader.readAsArrayBuffer(file);
        }

        // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ Excel
        function resetExcelUpload() {
            const progressContainer = document.getElementById('progressContainer');
            const fileInput = document.getElementById('excelFile');
            const fileInfo = document.getElementById('fileInfo');
            const loadStatus = document.getElementById('loadStatus');
            
            if (progressContainer) progressContainer.style.display = 'none';
            if (fileInput) fileInput.value = '';
            if (fileInfo) fileInfo.style.display = 'none';
            if (loadStatus) {
                loadStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                loadStatus.className = 'status-indicator status-error';
            }
        }

        // ==================== –ü–ê–†–°–ò–ù–ì CSV/EXCEL ====================
        function parseCSV(csvText, source = 'unknown', metadata = {}) {
            console.log('üîç –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∏–∑', source, metadata);
            
            try {
                // –£–¥–∞–ª—è–µ–º BOM (Byte Order Mark)
                if (csvText.charCodeAt(0) === 0xFEFF) {
                    csvText = csvText.slice(1);
                }
                
                // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏
                let lines = csvText.split('\n').map(function(line) { 
                    return line.trim(); 
                }).filter(function(line) { 
                    return line.length > 0; 
                });
                
                if (lines.length < 2) {
                    throw new Error(source === 'excel' ? '–í Excel —Ñ–∞–π–ª–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö' : 'CSV —Ñ–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫');
                }
                
                console.log('üìä –ù–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–æ–∫:', lines.length);
                
                // –ü–∞—Ä—Å–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
                let headers = lines[0].split(',').map(function(h) { 
                    return h.trim().toLowerCase().replace(/"/g, ''); 
                });
                
                console.log('üìã –ó–∞–≥–æ–ª–æ–≤–∫–∏:', headers);
                
                // –ò—â–µ–º –∏–Ω–¥–µ–∫—Å—ã –∫–æ–ª–æ–Ω–æ–∫ (–≥–∏–±–∫–∏–π –ø–æ–∏—Å–∫)
                const colMap = {
                    date: findColumn(headers, ['date', '–¥–∞—Ç–∞', '–¥–µ–Ω—å', 'day']),
                    blogger: findColumn(headers, ['blogger', '–±–ª–æ–≥–µ—Ä', 'influencer', '–∞–≤—Ç–æ—Ä']),
                    book: findColumn(headers, ['book', '–∫–Ω–∏–≥–∞', 'title', '–Ω–∞–∑–≤–∞–Ω–∏–µ']),
                    cost: findColumn(headers, ['cost', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', 'expense', '–∑–∞—Ç—Ä–∞—Ç—ã']),
                    cp: findColumn(headers, ['cp', '–ø—Ä–∏–±—ã–ª—å', 'revenue', '–¥–æ—Ö–æ–¥', 'profit']),
                    qty: findColumn(headers, ['qty', 'quantity', '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'count', '—à—Ç'])
                };
                
                console.log('üîç –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–æ–∫:', colMap);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
                const required = ['date', 'blogger', 'book', 'cost', 'qty'];
                let missing = [];
                
                required.forEach(function(col) {
                    if (colMap[col] === -1) {
                        missing.push(col);
                    }
                });
                
                if (missing.length > 0) {
                    console.warn('‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏:', missing);
                    if (source === 'excel') {
                        throw new Error('–í —Ñ–∞–π–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: ' + missing.join(', '));
                    } else {
                        // –î–ª—è CSV –ø—Ä–æ–±—É–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        colMap.date = 0;
                        colMap.blogger = 1;
                        colMap.book = 2;
                        colMap.cost = 3;
                        colMap.cp = 4;
                        colMap.qty = 5;
                        console.log('üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:', colMap);
                    }
                }
                
                // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ
                let parsedCount = 0;
                let errorCount = 0;
                let parsedCampaigns = [];
                
                for (let i = 1; i < lines.length && parsedCount < 2000; i++) {
                    try {
                        const line = lines[i];
                        const values = line.split(',').map(function(v) { 
                            return v.trim().replace(/"/g, '').replace(/'/g, ''); 
                        });
                        
                        if (values.length < Math.max(...Object.values(colMap)) + 1) {
                            console.warn('üìâ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Å—Ç—Ä–æ–∫–µ', i + 1);
                            errorCount++;
                            continue;
                        }
                        
                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
                        const rowData = {
                            date: getValue(values, colMap.date),
                            blogger: getValue(values, colMap.blogger),
                            book: getValue(values, colMap.book),
                            cost: parseFloat(getValue(values, colMap.cost)) || 0,
                            cp: parseFloat(getValue(values, colMap.cp)) || 0,
                            qty: parseInt(getValue(values, colMap.qty)) || 0,
                            row: i + 1 // –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                        };
                        
                        // –í–∞–ª–∏–¥–∞—Ü–∏—è
                        const validationErrors = validateCampaign(rowData);
                        if (validationErrors.length > 0) {
                            console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ', rowData.row, ':', validationErrors.join(', '));
                            errorCount++;
                            continue;
                        }
                        
                        parsedCampaigns.push(rowData);
                        parsedCount++;
                        
                    } catch (rowError) {
                        console.warn('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–æ–∫–∏', i + 1, ':', rowError.message);
                        errorCount++;
                    }
                }
                
                if (parsedCount === 0) {
                    throw new Error('–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º
                campaigns = parsedCampaigns;
                localStorage.setItem('campaigns', JSON.stringify(campaigns));
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
                extractBloggersBooks();
                
                console.log('‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω:');
                console.log('   ‚úì –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫:', lines.length - 1);
                console.log('   ‚úì –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ:', parsedCount);
                console.log('   ‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ:', errorCount);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                dataLoaded = true;
                updateList();
                updateCounters();
                populateSelects();
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const sourceInfo = source === 'excel' ? 
                    `–§–∞–π–ª: ${metadata.sourceFile || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}, –õ–∏—Å—Ç: ${metadata.sheetName || 'Sheet1'}, –°—Ç—Ä–æ–∫: ${metadata.totalRows || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}` : 
                    '–ò—Å—Ç–æ—á–Ω–∏–∫: Google Sheets CSV';
                
                showMessage(
                    `‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!<br>` +
                    `<strong>${parsedCount}</strong> –∫–∞–º–ø–∞–Ω–∏–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ<br>` +
                    `<small>${sourceInfo}</small><br>` +
                    `<small style="color: #ffc107;">–ü—Ä–æ–ø—É—â–µ–Ω–æ ${errorCount} –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—Ç—Ä–æ–∫</small>`,
                    'success'
                );
                
                return { success: true, count: parsedCount, errors: errorCount };
                
            } catch (error) {
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', error);
                showError('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:<br>' + error.message);
                throw error;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
        function findColumn(headers, keywords) {
            for (let i = 0; i < headers.length; i++) {
                const header = headers[i].toLowerCase();
                for (let keyword of keywords) {
                    if (header.includes(keyword)) {
                        return i;
                    }
                }
            }
            return -1;
        }

        function getValue(values, colIndex) {
            if (colIndex >= 0 && colIndex < values.length) {
                return values[colIndex] || '';
            }
            return '';
        }

        function validateCampaign(data) {
            const errors = [];
            
            if (!data.date || !data.date.trim()) {
                errors.push('–Ω–µ—Ç –¥–∞—Ç—ã');
            } else if (!isValidDate(data.date)) {
                errors.push('–Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã');
            }
            
            if (!data.blogger || !data.blogger.trim() || data.blogger.trim().length < 2) {
                errors.push('–Ω–µ—Ç –±–ª–æ–≥–µ—Ä–∞ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è');
            }
            
            if (!data.book || !data.book.trim() || data.book.trim().length < 2) {
                errors.push('–Ω–µ—Ç –∫–Ω–∏–≥–∏ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
            }
            
            if (data.cost <= 0 || isNaN(data.cost)) {
                errors.push('—Å—Ç–æ–∏–º–æ—Å—Ç—å <= 0');
            }
            
            if (data.cp <= 0 || isNaN(data.cp)) {
                errors.push('–ß–ü <= 0');
            }
            
            if (data.qty <= 0 || isNaN(data.qty)) {
                errors.push('–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ <= 0');
            }
            
            return errors;
        }

        function isValidDate(dateString) {
            const date = new Date(dateString);
            return date instanceof Date && !isNaN(date) && dateString.match(/^\d{4}-\d{2}-\d{2}$/);
        }

        // ==================== –°–ü–†–ê–í–û–ß–ù–ò–ö–ò ====================
        function extractBloggersBooks() {
            console.log('üìö –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ –∏–∑ –∫–∞–º–ø–∞–Ω–∏–π...');
            
            const originalCount = { bloggers: bloggers.length, books: books.length };
            
            // –ù–æ–≤—ã–µ –±–ª–æ–≥–µ—Ä—ã
            const newBloggers = campaigns
                .map(function(c) { return c.blogger.trim(); })
                .filter(function(name, index, self) {
                    return name && self.indexOf(name) === index && !bloggers.find(function(b) { return b.name === name; });
                });
            
            newBloggers.forEach(function(name) {
                bloggers.push({ name: name, link: '' });
            });
            
            // –ù–æ–≤—ã–µ –∫–Ω–∏–≥–∏
            const newBooks = campaigns
                .map(function(c) { return c.book.trim(); })
                .filter(function(name, index, self) {
                    return name && self.indexOf(name) === index && !books.find(function(b) { return b.name === name; });
                });
            
            newBooks.forEach(function(name) {
                // –ò—â–µ–º –ß–ü –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–Ω–∏–≥–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å—è—Ö
                const avgCP = campaigns
                    .filter(function(c) { return c.book === name; })
                    .reduce(function(sum, c) { return sum + c.cp; }, 0) / campaigns.filter(function(c) { return c.book === name; }).length || 0;
                
                books.push({ name: name, cp: avgCP || 0 });
            });
            
            if (newBloggers.length > 0 || newBooks.length > 0) {
                saveStorage();
                populateSelects();
                renderBloggers();
                renderBooks();
                updateCounters();
                
                console.log('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ:');
                console.log('   üìù –ë–ª–æ–≥–µ—Ä–æ–≤:', newBloggers.length);
                console.log('   üìö –ö–Ω–∏–≥:', newBooks.length);
                
                if (newBloggers.length > 0) {
                    showMessage(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ ${newBloggers.length} –Ω–æ–≤—ã—Ö –±–ª–æ–≥–µ—Ä–æ–≤ –∏–∑ –¥–∞–Ω–Ω—ã—Ö`, 'success');
                }
                if (newBooks.length > 0) {
                    showMessage(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ ${newBooks.length} –Ω–æ–≤—ã—Ö –∫–Ω–∏–≥ –∏–∑ –¥–∞–Ω–Ω—ã—Ö`, 'success');
                }
            }
        }

        function populateSelects() {
            console.log('üîß –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤...');
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º
            const sortedBloggers = bloggers.sort(function(a, b) { return a.name.localeCompare(b.name); });
            const sortedBooks = books.sort(function(a, b) { return a.name.localeCompare(b.name); });
            
            // –ë–ª–æ–≥–µ—Ä—ã
            const bloggerSelectIds = ['campaignBlogger', 'filterBlogger', 'editBlogger'];
            bloggerSelectIds.forEach(function(id) {
                const select = document.getElementById(id);
                if (!select) return;
                
                const isFilter = id === 'filterBlogger';
                select.innerHTML = isFilter ? '<option value="">–í—Å–µ –±–ª–æ–≥–µ—Ä—ã</option>' : '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–≥–µ—Ä–∞</option>';
                
                sortedBloggers.forEach(function(b) {
                    const option = document.createElement('option');
                    option.value = b.name;
                    option.textContent = b.name;
                    select.appendChild(option);
                });
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏, –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –±–ª–æ–≥–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö
                if (!isFilter && id === 'campaignBlogger' && campaigns.length > 0 && !select.value) {
                    const firstBlogger = campaigns[0].blogger;
                    if (sortedBloggers.find(function(b) { return b.name === firstBlogger; })) {
                        select.value = firstBlogger;
                    }
                }
            });
            
            // –ö–Ω–∏–≥–∏
            const bookSelectIds = ['campaignBook', 'filterBook', 'editBook'];
            bookSelectIds.forEach(function(id) {
                const select = document.getElementById(id);
                if (!select) return;
                
                const isFilter = id === 'filterBook';
                select.innerHTML = isFilter ? '<option value="">–í—Å–µ –∫–Ω–∏–≥–∏</option>' : '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É</option>';
                
                sortedBooks.forEach(function(bk) {
                    const option = document.createElement('option');
                    option.value = bk.name;
                    option.textContent = bk.name + (bk.cp > 0 ? ` (–ß–ü: ${bk.cp.toFixed(2)} —Ä—É–±.)` : '');
                    select.appendChild(option);
                });
                
                if (!isFilter && id === 'campaignBook' && campaigns.length > 0 && !select.value) {
                    const firstBook = campaigns[0].book;
                    if (sortedBooks.find(function(b) { return b.name === firstBook; })) {
                        select.value = firstBook;
                    }
                }
            });
        }

        // ==================== –†–ï–ù–î–ï–† –°–ü–†–ê–í–û–ß–ù–ò–ö–û–í ====================
        function renderBloggers() {
            const container = document.getElementById('bloggersList');
            if (!container) return;
            
            updateCounters();
            
            if (bloggers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users-slash" style="font-size: 48px; color: var(--warning); margin-bottom: 15px;"></i>
                        <p><strong>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –±–ª–æ–≥–µ—Ä–æ–≤ –ø—É—Å—Ç</strong></p>
                        <p style="font-size: 14px; color: var(--dark);">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Excel/CSV –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –±–ª–æ–≥–µ—Ä–æ–≤ –≤—Ä—É—á–Ω—É—é.</p>
                        <div style="margin-top: 15px;">
                            <button class="add-btn" onclick="showAddBlogger()" style="padding: 10px 20px; margin-right: 10px;">
                                <i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞
                            </button>
                            <button class="add-btn" onclick="switchTab('load')" style="background: var(--secondary);">
                                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            bloggers.forEach(function(b, i) {
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–ª–æ–≥–µ—Ä—É
                const bloggerCampaigns = campaigns.filter(function(c) { return c.blogger === b.name; });
                const campaignCount = bloggerCampaigns.length;
                const totalCost = bloggerCampaigns.reduce(function(sum, c) { return sum + c.cost; }, 0);
                const totalProfit = bloggerCampaigns.reduce(function(sum, c) { return sum + (c.cp * c.qty); }, 0);
                const avgROAS = totalCost > 0 ? (totalProfit / totalCost).toFixed(2) : '0.00';
                
                // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∫–∞–º–ø–∞–Ω–∏–∏
                const recentCampaigns = bloggerCampaigns
                    .sort(function(a, b) { return new Date(b.date) - new Date(a.date); })
                    .slice(0, 3)
                    .map(function(c) { 
                        const profit = c.cp * c.qty;
                        const roi = c.cost > 0 ? ((profit - c.cost) / c.cost * 100).toFixed(0) : 0;
                        return `<div style="font-size: 13px; padding: 4px; background: white; border: 1px solid var(--border); border-radius: 4px; margin: 2px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>${c.date}: ${escapeHtml(c.book)}</span>
                                <span style="font-weight: bold; color: ${roi > 100 ? 'var(--primary)' : roi > 0 ? 'var(--warning)' : 'var(--danger)'}">
                                    ${roi > 0 ? '+' : ''}${roi}%
                                </span>
                            </div>
                            <div style="font-size: 11px; color: var(--dark);">
                                ${c.cost.toFixed(0)} —Ä—É–±. ‚Üí ${profit.toFixed(0)} —Ä—É–±. –ø—Ä–∏–±—ã–ª–∏
                            </div>
                        </div>`;
                    }).join('') || '<div style="font-style: italic; color: var(--warning);">–ö–∞–º–ø–∞–Ω–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>';
                
                const efficiencyClass = avgROAS > 3 ? 'positive' : avgROAS > 1 ? 'neutral' : 'negative';
                
                html += `
                    <div class="blogger-card" style="border-left: 4px solid ${efficiencyClass === 'positive' ? 'var(--primary)' : efficiencyClass === 'neutral' ? 'var(--warning)' : 'var(--danger)'}">
                        <div class="card-header">
                            <div style="display: flex; align-items: center;">
                                <i class="fas fa-user" style="color: var(--secondary); margin-right: 8px; font-size: 20px;"></i>
                                <strong style="font-size: 18px;">${escapeHtml(b.name)}</strong>
                            </div>
                            <div style="text-align: right;">
                                <span class="metrics ${efficiencyClass}" style="font-size: 16px; display: block;">
                                    ROAS: <strong>${avgROAS}x</strong>
                                </span>
                                <span style="font-size: 14px; color: var(--dark);">
                                    ${campaignCount} –∫–∞–º–ø–∞–Ω–∏${campaignCount === 1 ? '—è' : campaignCount < 5 ? '–π' : '–π'}
                                    ${totalCost > 0 ? `| ${totalCost.toFixed(0)} —Ä—É–±.` : ''}
                                </span>
                            </div>
                        </div>
                        
                        <div class="card-details">
                            <div><strong>–°—Å—ã–ª–∫–∞:</strong></div>
                            <div style="word-break: break-all; font-size: 14px;">
                                ${b.link ? 
                                    `<a href="${escapeHtml(b.link)}" target="_blank" rel="noopener" style="color: var(--secondary); text-decoration: none;" title="–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ">
                                        <i class="fas fa-external-link-alt" style="font-size: 12px; margin-right: 5px;"></i>
                                        ${escapeHtml(b.link.length > 50 ? b.link.substring(0, 47) + '...' : b.link)}
                                    </a>` : 
                                    '<span style="color: var(--warning); font-style: italic;">–ù–µ —É–∫–∞–∑–∞–Ω–∞</span>'
                                }
                            </div>
                            
                            <div><strong>–ù–µ–¥–∞–≤–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏:</strong></div>
                            <div style="grid-column: 2; font-size: 14px; line-height: 1.4; max-height: 120px; overflow-y: auto;">
                                ${recentCampaigns}
                            </div>
                        </div>
                        
                        <div class="card-actions" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid var(--border);">
                            <button class="add-btn" onclick="editBlogger(${i})" style="padding: 8px 16px; font-size: 14px;" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="btn-close" onclick="deleteBlogger(${i})" style="padding: 8px 16px; font-size: 14px;" title="–£–¥–∞–ª–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞ –∏ –∫–∞–º–ø–∞–Ω–∏–∏">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                            ${b.link ? 
                                `<button class="add-btn" onclick="window.open('${escapeHtml(b.link)}', '_blank')" style="background: var(--secondary); padding: 8px 16px; font-size: 14px;" title="–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
                                    <i class="fas fa-external-link-alt"></i> –ü—Ä–æ—Ñ–∏–ª—å
                                </button>` : ''
                            }
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html || `
                <div class="empty-state">
                    <i class="fas fa-search" style="font-size: 48px; color: var(--warning); margin-bottom: 15px;"></i>
                    <p>–ë–ª–æ–≥–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    <p style="font-size: 14px;">–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã</p>
                    <button class="add-btn" onclick="switchTab('load')" style="margin-top: 10px;">
                        <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            `;
        }

        function renderBooks() {
            const container = document.getElementById('booksList');
            if (!container) return;
            
            updateCounters();
            
            if (books.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book" style="font-size: 48px; color: var(--warning); margin-bottom: 15px;"></i>
                        <p><strong>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–Ω–∏–≥ –ø—É—Å—Ç</strong></p>
                        <p style="font-size: 14px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–∏–≥–∏ –≤—Ä—É—á–Ω—É—é.</p>
                        <div style="margin-top: 15px;">
                            <button class="add-btn" onclick="showAddBook()" style="padding: 10px 20px; margin-right: 10px;">
                                <i class="fas fa-book-open"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
                            </button>
                            <button class="add-btn" onclick="switchTab('load')" style="background: var(--secondary);">
                                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            books.forEach(function(bk, i) {
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–Ω–∏–≥–µ
                const bookCampaigns = campaigns.filter(function(c) { return c.book === bk.name; });
                const campaignCount = bookCampaigns.length;
                const totalSold = bookCampaigns.reduce(function(sum, c) { return sum + c.qty; }, 0);
                const totalRevenue = bookCampaigns.reduce(function(sum, c) { return sum + (c.cp * c.qty); }, 0);
                const avgCPS = totalSold > 0 ? (bookCampaigns.reduce(function(sum, c) { return sum + c.cost; }, 0) / totalSold).toFixed(2) : '0.00';
                
                // ROI –∫–Ω–∏–≥–∏
                const totalCost = bookCampaigns.reduce(function(sum, c) { return sum + c.cost; }, 0);
                const bookROI = totalCost > 0 ? ((totalRevenue - totalCost) / totalCost * 100).toFixed(1) : 0;
                const roiClass = bookROI > 100 ? 'positive' : bookROI > 0 ? 'neutral' : 'negative';
                
                // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
                const recentCampaigns = bookCampaigns
                    .sort(function(a, b) { return new Date(b.date) - new Date(a.date); })
                    .slice(0, 3)
                    .map(function(c) { 
                        const profit = c.cp * c.qty;
                        return `<div style="font-size: 13px; padding: 4px; background: white; border: 1px solid var(--border); border-radius: 4px; margin: 2px 0;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>${c.date}: ${escapeHtml(c.blogger)}</span>
                                <span style="font-weight: bold;">${c.qty} —à—Ç.</span>
                            </div>
                            <div style="font-size: 11px; color: var(--dark);">
                                ${c.cost.toFixed(0)} —Ä—É–±. ‚Üí ${profit.toFixed(0)} —Ä—É–±.
                            </div>
                        </div>`;
                    }).join('') || '<div style="font-style: italic; color: var(--warning);">–ö–∞–º–ø–∞–Ω–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>';
                
                html += `
                    <div class="book-card" style="border-left: 4px solid ${roiClass === 'positive' ? 'var(--primary)' : roiClass === 'neutral' ? 'var(--warning)' : 'var(--danger)'}">
                        <div class="card-header">
                            <div style="display: flex; align-items: center;">
                                <i class="fas fa-book-open" style="color: var(--secondary); margin-right: 8px; font-size: 20px;"></i>
                                <strong style="font-size: 18px;">${escapeHtml(bk.name)}</strong>
                            </div>
                            <div style="text-align: right;">
                                <span class="metrics ${roiClass}" style="font-size: 16px; display: block;">
                                    ROI: <strong>${bookROI > 0 ? '+' : ''}${bookROI}%</strong>
                                </span>
                                <span style="font-size: 14px; color: var(--dark);">
                                    –ß–ü: ${bk.cp.toFixed(2)} —Ä—É–±. | –ü—Ä–æ–¥–∞–Ω–æ: ${totalSold} —à—Ç.
                                </span>
                            </div>
                        </div>
                        
                        <div class="card-details">
                            <div><strong>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞:</strong></div>
                            <div style="font-weight: bold; color: var(--primary); font-size: 16px;">
                                ${totalRevenue.toFixed(0)} —Ä—É–±.
                            </div>
                            
                            <div><strong>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong></div>
                            <div style="font-size: 14px;">
                                <div>CPS: ${avgCPS} —Ä—É–±./—à—Ç. | –ö–∞–º–ø–∞–Ω–∏–π: ${campaignCount}</div>
                                <div style="margin-top: 5px;">${totalCost > 0 ? `–û–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã: ${totalCost.toFixed(0)} —Ä—É–±.` : '–ó–∞—Ç—Ä–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'}</div>
                            </div>
                            
                            <div><strong>–ù–µ–¥–∞–≤–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏:</strong></div>
                            <div style="grid-column: 2; font-size: 14px; line-height: 1.4; max-height: 120px; overflow-y: auto;">
                                ${recentCampaigns}
                            </div>
                        </div>
                        
                        <div class="card-actions" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid var(--border);">
                            <button class="add-btn" onclick="editBook(${i})" style="padding: 8px 16px; font-size: 14px;" title="–ò–∑–º–µ–Ω–∏—Ç—å –ß–ü –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="btn-close" onclick="deleteBook(${i})" style="padding: 8px 16px; font-size: 14px;" title="–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É –∏ –ø—Ä–æ–¥–∞–∂–∏">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                            ${totalRevenue > 0 ?
                                `<button class="add-btn" onclick="showBookStats(${i})" style="background: var(--warning); padding: 8px 16px; font-size: 14px;" title="–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
                                    <i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                                </button>` : ''
                            }
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html || `
                <div class="empty-state">
                    <i class="fas fa-search" style="font-size: 48px; color: var(--warning); margin-bottom: 15px;"></i>
                    <p>–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    <p style="font-size: 14px;">–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã</p>
                    <button class="add-btn" onclick="switchTab('load')" style="margin-top: 10px;">
                        <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            `;
        }

        // ==================== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ====================
        function showAddBlogger() {
            isEditingBlogger = false;
            currentEditIndex = -1;
            document.getElementById('bloggerModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            document.getElementById('bloggerName').value = '';
            document.getElementById('bloggerLink').value = '';
            document.getElementById('saveBloggerBtn').innerHTML = '<i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞';
            document.getElementById('saveBloggerBtn').onclick = saveBlogger;
            showModal('addBloggerModal');
            document.getElementById('bloggerName').focus();
        }

        function editBlogger(index) {
            if (index < 0 || index >= bloggers.length) {
                showError('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π –±–ª–æ–≥–µ—Ä');
                return;
            }
            
            isEditingBlogger = true;
            currentEditIndex = index;
            const blogger = bloggers[index];
            
            document.getElementById('bloggerModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            document.getElementById('bloggerName').value = blogger.name;
            document.getElementById('bloggerLink').value = blogger.link || '';
            document.getElementById('saveBloggerBtn').innerHTML = '<i class="fas fa-save"></i> –û–±–Ω–æ–≤–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞';
            document.getElementById('saveBloggerBtn').onclick = function() { saveBlogger(index); };
            
            showModal('addBloggerModal');
            document.getElementById('bloggerName').focus();
            document.getElementById('bloggerName').select();
        }

        function saveBlogger(editIndex = null) {
            const nameInput = document.getElementById('bloggerName');
            const linkInput = document.getElementById('bloggerLink');
            const saveBtn = document.getElementById('saveBloggerBtn');
            
            if (!nameInput || !linkInput || !saveBtn) {
                showError('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º—ã –±–ª–æ–≥–µ—Ä–∞');
                return;
            }
            
            const name = nameInput.value.trim();
            const link = linkInput.value.trim();
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!name || name.length < 2) {
                showError('–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–≥–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                nameInput.focus();
                return;
            }
            
            if (name.length > 100) {
                showError('–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å. 100 —Å–∏–º–≤–æ–ª–æ–≤)');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞
            const existingIndex = bloggers.findIndex(function(b, i) {
                return i !== (editIndex || currentEditIndex) && b.name.toLowerCase() === name.toLowerCase();
            });
            
            if (existingIndex !== -1) {
                showError('–ë–ª–æ–≥–µ—Ä —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ' + bloggers[existingIndex].name);
                nameInput.focus();
                return;
            }
            
            // –°—Å—ã–ª–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            if (link && !isValidURL(link)) {
                if (!confirm('–°—Å—ã–ª–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π: "' + link + '"\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                    linkInput.focus();
                    return;
                }
            }
            
            const operation = editIndex !== null ? '–æ–±–Ω–æ–≤–ª–µ–Ω' : '–¥–æ–±–∞–≤–ª–µ–Ω';
            
            if (editIndex !== null || isEditingBlogger) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                bloggers[currentEditIndex].name = name;
                if (link) bloggers[currentEditIndex].link = link;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ –µ—Å–ª–∏ –∏–º—è –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                const oldName = bloggers[currentEditIndex].name;
                if (name.toLowerCase() !== oldName.toLowerCase()) {
                    campaigns.forEach(function(c) {
                        if (c.blogger === oldName) {
                            c.blogger = name;
                        }
                    });
                }
                bloggers[currentEditIndex].name = name;
                
                saveStorage();
                renderBloggers();
                populateSelects();
                updateList();
                
                showMessage('–ë–ª–æ–≥–µ—Ä "' + name + '" –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ
                bloggers.push({ name: name, link: link || '' });
                saveStorage();
                renderBloggers();
                populateSelects();
                
                showMessage('–ë–ª–æ–≥–µ—Ä "' + name + '" –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            }
            
            hideAddBlogger();
        }

        function deleteBlogger(index) {
            if (index < 0 || index >= bloggers.length) {
                showError('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å –±–ª–æ–≥–µ—Ä–∞');
                return;
            }
            
            const blogger = bloggers[index];
            const campaignCount = campaigns.filter(function(c) { return c.blogger === blogger.name; }).length;
            const totalCampaigns = campaigns.length;
            
            const confirmMessage = `
                <div style="text-align: left; font-size: 14px;">
                    <p><strong>–£–¥–∞–ª–∏—Ç—å –±–ª–æ–≥–µ—Ä–∞:</strong> ${escapeHtml(blogger.name)}</p>
                    ${blogger.link ? `<p><strong>–°—Å—ã–ª–∫–∞:</strong> ${escapeHtml(blogger.link)}</p>` : ''}
                    <p><strong>–í–ª–∏—è–Ω–∏–µ:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>üóëÔ∏è –ë–ª–æ–≥–µ—Ä –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞</li>
                        ${campaignCount > 0 ? `<li>üìä ${campaignCount} –∫–∞–º–ø–∞–Ω–∏–π (${(campaignCount/totalCampaigns*100).toFixed(1)}% –æ—Ç –≤—Å–µ—Ö) –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã</li>` : '<li>üìä –ö–∞–º–ø–∞–Ω–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</li>'}
                        <li>üíæ localStorage –æ–±–Ω–æ–≤–∏—Ç—Å—è</li>
                    </ul>
                    <p style="color: var(--danger); font-weight: bold;">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</p>
                </div>
            `;
            
            if (confirm(confirmMessage)) {
                const deletedName = blogger.name;
                
                // –£–¥–∞–ª—è–µ–º –±–ª–æ–≥–µ—Ä–∞
                bloggers.splice(index, 1);
                
                // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
                const beforeCount = campaigns.length;
                campaigns = campaigns.filter(function(c) { return c.blogger !== deletedName; });
                const deletedCount = beforeCount - campaigns.length;
                
                saveStorage();
                renderBloggers();
                populateSelects();
                updateList();
                updateCounters();
                
                showMessage(`–ë–ª–æ–≥–µ—Ä "${deletedName}" —É–¥–∞–ª–µ–Ω –≤–º–µ—Å—Ç–µ —Å ${deletedCount} –∫–∞–º–ø–∞–Ω–∏—è–º–∏`, 'success');
                
                if (campaigns.length === 0) {
                    switchTab('load');
                    showMessage('–í—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ —É–¥–∞–ª–µ–Ω—ã. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.', 'warning');
                }
            }
        }

        function hideAddBlogger() {
            hideModal('addBloggerModal');
            isEditingBlogger = false;
            currentEditIndex = -1;
        }

        // ==================== –ö–ù–ò–ì–ò (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –±–ª–æ–≥–µ—Ä–∞–º) ====================
        function showAddBook() {
            isEditingBook = false;
            currentEditIndex = -1;
            document.getElementById('bookModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            document.getElementById('bookName').value = '';
            document.getElementById('bookCP').value = '';
            document.getElementById('saveBookBtn').innerHTML = '<i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É';
            document.getElementById('saveBookBtn').onclick = saveBook;
            showModal('addBookModal');
            document.getElementById('bookName').focus();
        }

        function editBook(index) {
            if (index < 0 || index >= books.length) {
                showError('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω–∞—è –∫–Ω–∏–≥–∞');
                return;
            }
            
            isEditingBook = true;
            currentEditIndex = index;
            const book = books[index];
            
            document.getElementById('bookModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            document.getElementById('bookName').value = book.name;
            document.getElementById('bookCP').value = book.cp || '';
            document.getElementById('saveBookBtn').innerHTML = '<i class="fas fa-save"></i> –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É';
            document.getElementById('saveBookBtn').onclick = function() { saveBook(index); };
            
            showModal('addBookModal');
            document.getElementById('bookName').focus();
            document.getElementById('bookName').select();
        }

        function saveBook(editIndex = null) {
            const nameInput = document.getElementById('bookName');
            const cpInput = document.getElementById('bookCP');
            const saveBtn = document.getElementById('saveBookBtn');
            
            if (!nameInput || !cpInput || !saveBtn) {
                showError('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º—ã –∫–Ω–∏–≥–∏');
                return;
            }
            
            const name = nameInput.value.trim();
            const cp = parseFloat(cpInput.value) || 0;
            
            if (!name || name.length < 2) {
                showError('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                nameInput.focus();
                return;
            }
            
            if (name.length > 150) {
                showError('–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å. 150 —Å–∏–º–≤–æ–ª–æ–≤)');
                return;
            }
            
            if (cp < 0) {
                showError('–ß–ü –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º');
                cpInput.focus();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞
            const existingIndex = books.findIndex(function(bk, i) {
                return i !== (editIndex || currentEditIndex) && bk.name.toLowerCase() === name.toLowerCase();
            });
            
            if (existingIndex !== -1) {
                showError('–ö–Ω–∏–≥–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ' + books[existingIndex].name);
                nameInput.focus();
                return;
            }
            
            const operation = editIndex !== null ? '–æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–¥–æ–±–∞–≤–ª–µ–Ω–∞';
            
            if (editIndex !== null || isEditingBook) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                books[currentEditIndex].name = name;
                books[currentEditIndex].cp = cp;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
                const oldName = books[currentEditIndex].name;
                if (name.toLowerCase() !== oldName.toLowerCase()) {
                    campaigns.forEach(function(c) {
                        if (c.book === oldName) {
                            c.book = name;
                            c.cp = cp; // –û–±–Ω–æ–≤–ª—è–µ–º –ß–ü –≤–æ –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏—è—Ö
                        }
                    });
                } else if (cp !== books[currentEditIndex].cp) {
                    // –ß–ü –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –æ–±–Ω–æ–≤–ª—è–µ–º –≤–æ –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏—è—Ö
                    campaigns.forEach(function(c) {
                        if (c.book === name) {
                            c.cp = cp;
                        }
                    });
                }
                
                saveStorage();
                renderBooks();
                populateSelects();
                updateList();
                
                showMessage('–ö–Ω–∏–≥–∞ "' + name + '" –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–ß–ü: ' + cp.toFixed(2) + ' —Ä—É–±.)', 'success');
                
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ
                books.push({ name: name, cp: cp });
                saveStorage();
                renderBooks();
                populateSelects();
                
                showMessage('–ö–Ω–∏–≥–∞ "' + name + '" –¥–æ–±–∞–≤–ª–µ–Ω–∞ (–ß–ü: ' + cp.toFixed(2) + ' —Ä—É–±.)', 'success');
            }
            
            hideAddBook();
        }

        function deleteBook(index) {
            if (index < 0 || index >= books.length) {
                showError('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∫–Ω–∏–≥–∏');
                return;
            }
            
            const book = books[index];
            const campaignCount = campaigns.filter(function(c) { return c.book === book.name; }).length;
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É "' + escapeHtml(book.name) + '"?\n\n' +
                       '–ß–ü: ' + book.cp.toFixed(2) + ' —Ä—É–±.\n' +
                       '–≠—Ç–æ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç ' + campaignCount + ' –ø—Ä–æ–¥–∞–∂ —ç—Ç–æ–π –∫–Ω–∏–≥–∏.\n\n' +
                       '–î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                
                const deletedName = book.name;
                books.splice(index, 1);
                
                // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
                campaigns = campaigns.filter(function(c) { return c.book !== deletedName; });
                
                saveStorage();
                renderBooks();
                populateSelects();
                updateList();
                updateCounters();
                
                showMessage('–ö–Ω–∏–≥–∞ "' + deletedName + '" –∏ ' + campaignCount + ' –ø—Ä–æ–¥–∞–∂ —É–¥–∞–ª–µ–Ω—ã', 'success');
            }
        }

        function hideAddBook() {
            hideModal('addBookModal');
            isEditingBook = false;
            currentEditIndex = -1;
        }

        // ==================== –ö–ê–ú–ü–ê–ù–ò–ò ====================
        function addCampaign() {
            const inputs = {
                date: document.getElementById('campaignDate'),
                blogger: document.getElementById('campaignBlogger'),
                book: document.getElementById('campaignBook'),
                cost: document.getElementById('campaignCost'),
                cp: document.getElementById('campaignCP'),
                qty: document.getElementById('campaignQty'),
                btn: document.getElementById('addCampaignBtn')
            };
            
            if (!inputs.btn) {
                showError('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º—ã –∫–∞–º–ø–∞–Ω–∏–∏');
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!inputs.date.value) {
                showError('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∫–∞–º–ø–∞–Ω–∏–∏');
                inputs.date.focus();
                return;
            }
            
            if (!inputs.blogger.value) {
                showError('–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–≥–µ—Ä–∞');
                inputs.blogger.focus();
                return;
            }
            
            if (!inputs.book.value) {
                showError('–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É');
                inputs.book.focus();
                return;
            }
            
            const cost = parseFloat(inputs.cost.value);
            const cp = parseFloat(inputs.cp.value);
            const qty = parseInt(inputs.qty.value);
            
            if (isNaN(cost) || cost <= 0) {
                showError('–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
                inputs.cost.focus();
                return;
            }
            
            if (isNaN(cp) || cp <= 0) {
                showError('–ß–ü —Å –∫–Ω–∏–≥–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
                inputs.cp.focus();
                return;
            }
            
            if (isNaN(qty) || qty <= 0) {
                showError('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
                inputs.qty.focus();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–Ω–∏–≥–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ
            const bookExists = books.find(function(bk) { return bk.name === inputs.book.value; });
            if (!bookExists) {
                if (!confirm('–ö–Ω–∏–≥–∞ "' + inputs.book.value + '" –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ.\n\n' +
                           '–î–æ–±–∞–≤–∏—Ç—å –µ—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ß–ü = ' + cp.toFixed(2) + ' —Ä—É–±.?')) {
                    inputs.book.focus();
                    return;
                }
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–∏–≥—É
                books.push({ name: inputs.book.value, cp: cp });
                saveStorage();
                populateSelects();
                renderBooks();
            } else if (Math.abs(bookExists.cp - cp) > 0.01) {
                // –ß–ü –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
                if (confirm('–í —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –¥–ª—è –∫–Ω–∏–≥–∏ "' + inputs.book.value + '" —É–∫–∞–∑–∞–Ω–æ –ß–ü = ' + bookExists.cp.toFixed(2) + ' —Ä—É–±.,\n' +
                           '–∞ –∑–¥–µ—Å—å ' + cp.toFixed(2) + ' —Ä—É–±. –û–±–Ω–æ–≤–∏—Ç—å –ß–ü –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ?')) {
                    bookExists.cp = cp;
                    saveStorage();
                    renderBooks();
                    updateList(); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏
                }
            }
            
            const newCampaign = {
                date: inputs.date.value,
                blogger: inputs.blogger.value,
                book: inputs.book.value,
                cost: cost,
                cp: cp,
                qty: qty,
                addedAt: new Date().toISOString()
            };
            
            campaigns.push(newCampaign);
            saveStorage();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateList();
            updateCounters();
            clearCampaignForm();
            switchTab('data');
            
            showMessage(
                '‚úÖ –ù–æ–≤–∞—è –∫–∞–º–ø–∞–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞:<br>' +
                '<strong>' + newCampaign.blogger + '</strong> ‚Üí <strong>' + newCampaign.book + '</strong><br>' +
                '<small>' + newCampaign.date + ' | ' + newCampaign.cost.toFixed(2) + ' —Ä—É–±. | ' + newCampaign.qty + ' —à—Ç.</small>',
                'success'
            );
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
            setTimeout(function() {
                const table = document.querySelector('#dataList table');
                if (table) {
                    const newRow = table.querySelector('tbody tr:last-child');
                    if (newRow) {
                        newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        newRow.style.backgroundColor = 'var(--primary)';
                        newRow.style.color = 'white';
                        setTimeout(function() {
                            newRow.style.backgroundColor = '';
                            newRow.style.color = '';
                        }, 3000);
                    }
                }
            }, 500);
        }

        function clearCampaignForm() {
            document.getElementById('campaignDate').value = new Date().toISOString().split('T')[0]; // –°–µ–≥–æ–¥–Ω—è
            document.getElementById('campaignBlogger').value = '';
            document.getElementById('campaignBook').value = '';
            document.getElementById('campaignCost').value = '';
            document.getElementById('campaignCP').value = '';
            document.getElementById('campaignQty').value = '';
        }

        function editCampaign(index) {
            if (index < 0 || index >= campaigns.length) {
                showError('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è');
                return;
            }
            
            const campaign = campaigns[index];
            currentEditIndex = index;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('editDate').value = campaign.date;
            document.getElementById('editBlogger').value = campaign.blogger;
            document.getElementById('editBook').value = campaign.book;
            document.getElementById('editCost').value = campaign.cost;
            document.getElementById('editCP').value = campaign.cp;
            document.getElementById('editQty').value = campaign.qty;
            
            // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
            const profit = campaign.cp * campaign.qty;
            const roi = campaign.cost > 0 ? ((profit - campaign.cost) / campaign.cost * 100).toFixed(1) : 0;
            const roas = campaign.cost > 0 ? (profit / campaign.cost).toFixed(2) : 0;
            
            const preview = document.createElement('div');
            preview.style.cssText = 'background: var(--light); padding: 15px; border-radius: 6px; margin-bottom: 15px; font-size: 14px;';
            preview.innerHTML = `
                <h4 style="margin: 0 0 10px 0; color: var(--secondary);">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <div><strong>–ü—Ä–∏–±—ã–ª—å:</strong> <span class="positive">${profit.toFixed(2)} —Ä—É–±.</span></div>
                    <div><strong>ROI:</strong> <span class="${roi > 100 ? 'positive' : roi > 0 ? 'neutral' : 'negative'}">${roi > 0 ? '+' : ''}${roi}%</span></div>
                    <div><strong>ROAS:</strong> <span class="positive">${roas}x</span></div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –º–æ–¥–∞–ª–∫—É
            const modalContent = document.querySelector('#editCampaignModal .form-container');
            let previewDiv = modalContent.querySelector('.campaign-preview');
            if (previewDiv) {
                previewDiv.remove();
            }
            preview.className = 'campaign-preview';
            modalContent.insertBefore(preview, modalContent.firstChild.nextSibling);
            
            document.getElementById('saveCampaignBtn').onclick = saveCampaignEdit;
            
            showModal('editCampaignModal');
            document.getElementById('editDate').focus();
        }

        function saveCampaignEdit() {
            const index = currentEditIndex;
            if (index < 0) return;
            
            const inputs = {
                date: document.getElementById('editDate'),
                blogger: document.getElementById('editBlogger'),
                book: document.getElementById('editBook'),
                cost: document.getElementById('editCost'),
                cp: document.getElementById('editCP'),
                qty: document.getElementById('editQty')
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ addCampaign)
            if (!inputs.date.value || !inputs.blogger.value || !inputs.book.value) {
                showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            const cost = parseFloat(inputs.cost.value);
            const cp = parseFloat(inputs.cp.value);
            const qty = parseInt(inputs.qty.value);
            
            if (isNaN(cost) || cost <= 0 || isNaN(cp) || cp <= 0 || isNaN(qty) || qty <= 0) {
                showError('–í—Å–µ —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–æ–ª—å—à–µ 0');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–º–ø–∞–Ω–∏—é
            const oldCampaign = campaigns[index];
            campaigns[index] = {
                date: inputs.date.value,
                blogger: inputs.blogger.value,
                book: inputs.book.value,
                cost: cost,
                cp: cp,
                qty: qty,
                editedAt: new Date().toISOString()
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ß–ü –∫–Ω–∏–≥–∏ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
            const book = books.find(function(b) { return b.name === inputs.book.value; });
            if (book && Math.abs(book.cp - cp) > 0.01) {
                if (confirm('–ß–ü –∫–Ω–∏–≥–∏ "' + inputs.book.value + '" –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ (' + book.cp.toFixed(2) + ' —Ä—É–±.) –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–≤–µ–¥–µ–Ω–Ω—ã–º (' + cp.toFixed(2) + ' —Ä—É–±.).\n\n–û–±–Ω–æ–≤–∏—Ç—å –ß–ü –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ?')) {
                    book.cp = cp;
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ß–ü –≤–æ –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏—è—Ö —ç—Ç–æ–π –∫–Ω–∏–≥–∏
                    campaigns.forEach(function(c) {
                        if (c.book === inputs.book.value && c !== campaigns[index]) {
                            c.cp = cp;
                        }
                    });
                    saveStorage();
                    renderBooks();
                }
            }
            
            saveStorage();
            updateList();
            updateCounters();
            hideEditCampaign();
            
            const profit = cp * qty;
            const roi = cost > 0 ? ((profit - cost) / cost * 100).toFixed(1) : 0;
            showMessage(
                '‚úÖ –ö–∞–º–ø–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞:<br>' +
                '<strong>' + inputs.blogger.value + '</strong> ‚Üí <strong>' + inputs.book.value + '</strong><br>' +
                '<small>' + inputs.date.value + ' | ' + cost.toFixed(2) + ' —Ä—É–±. | ROI: ' + (roi > 0 ? '+' : '') + roi + '%</small>',
                'success'
            );
        }

        function hideEditCampaign() {
            hideModal('editCampaignModal');
            currentEditIndex = -1;
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            const previewDiv = document.querySelector('#editCampaignModal .campaign-preview');
            if (previewDiv) {
                previewDiv.remove();
            }
        }

        function deleteCampaign(index) {
            if (index < 0 || index >= campaigns.length) return;
            
            const campaign = campaigns[index];
            const totalCampaigns = campaigns.length;
            const percentage = ((1 / totalCampaigns) * 100).toFixed(1);
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é?\n\n' +
                       'üìÖ –î–∞—Ç–∞: ' + campaign.date + '\n' +
                       'üë§ –ë–ª–æ–≥–µ—Ä: ' + campaign.blogger + '\n' +
                       'üìö –ö–Ω–∏–≥–∞: ' + campaign.book + '\n' +
                       'üí∞ –ó–∞—Ç—Ä–∞—Ç—ã: ' + campaign.cost.toFixed(2) + ' —Ä—É–±.\n' +
                       'üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ' + campaign.qty + ' —à—Ç.\n\n' +
                       `<small>–≠—Ç–æ ${percentage}% –æ—Ç –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏–π (${totalCampaigns} –≤—Å–µ–≥–æ)</small>`)) {
                
                const deletedCampaign = campaigns.splice(index, 1)[0];
                saveStorage();
                updateList();
                updateCounters();
                
                showMessage(
                    'üóëÔ∏è –ö–∞–º–ø–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–∞:<br>' +
                    '<strong>' + deletedCampaign.blogger + '</strong> ‚Üí <strong>' + deletedCampaign.book + '</strong><br>' +
                    '<small>' + deletedCampaign.date + ' | ' + deletedCampaign.cost.toFixed(2) + ' —Ä—É–±.</small>',
                    'success'
                );
                
                if (campaigns.length === 0) {
                    switchTab('load');
                    showMessage('–í—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ —É–¥–∞–ª–µ–Ω—ã. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.', 'warning');
                }
            }
        }

        // ==================== –§–ò–õ–¨–¢–†–´ ====================
        function applyFilters() {
            if (campaigns.length === 0) {
                showError('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–∞–º–ø–∞–Ω–∏–∏.');
                return;
            }
            
            console.log('üîç –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤...');
            
            let filtered = campaigns.slice();
            let filterCount = 0;
            
            // –î–∞—Ç–∞
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            
            if (dateFrom) {
                filtered = filtered.filter(function(c) {
                    return new Date(c.date) >= new Date(dateFrom);
                });
                filterCount++;
            }
            
            if (dateTo) {
                filtered = filtered.filter(function(c) {
                    return new Date(c.date) <= new Date(dateTo);
                });
                filterCount++;
            }
            
            // –ë–ª–æ–≥–µ—Ä –∏ –∫–Ω–∏–≥–∞
            const selectedBlogger = document.getElementById('filterBlogger').value;
            const selectedBook = document.getElementById('filterBook').value;
            
            if (selectedBlogger) {
                filtered = filtered.filter(function(c) { return c.blogger === selectedBlogger; });
                filterCount++;
            }
            
            if (selectedBook) {
                filtered = filtered.filter(function(c) { return c.book === selectedBook; });
                filterCount++;
            }
            
            // –ú–µ—Ç—Ä–∏–∫–∏
            const roiMin = parseFloat(document.getElementById('filterROIMin').value) || -Infinity;
            const roiMax = parseFloat(document.getElementById('filterROIMax').value) || Infinity;
            const roasMin = parseFloat(document.getElementById('filterROASMin').value) || 0;
            const roasMax = parseFloat(document.getElementById('filterROASMax').value) || Infinity;
            const cpsMin = parseFloat(document.getElementById('filterCPSMin').value) || 0;
            const cpsMax = parseFloat(document.getElementById('filterCPSMax').value) || Infinity;
            
            let metricCount = 0;
            filtered = filtered.filter(function(c) {
                const profit = c.cp * c.qty;
                const roi = c.cost > 0 ? ((profit - c.cost) / c.cost * 100) : 0;
                const roas = c.cost > 0 ? (profit / c.cost) : 0;
                const cps = c.qty > 0 ? (c.cost / c.qty) : Infinity;
                
                let matches = true;
                
                if (!isNaN(roiMin) && roiMin > -Infinity && roi < roiMin) matches = false;
                if (!isNaN(roiMax) && roiMax < Infinity && roi > roiMax) matches = false;
                if (!isNaN(roasMin) && roasMin > 0 && roas < roasMin) matches = false;
                if (!isNaN(roasMax) && roasMax < Infinity && roas > roasMax) matches = false;
                if (!isNaN(cpsMin) && cpsMin > 0 && cps < cpsMin) matches = false;
                if (!isNaN(cpsMax) && cpsMax < Infinity && cps > cpsMax) matches = false;
                
                if (!matches) metricCount++;
                
                return matches;
            });
            
            filterCount += metricCount > 0 ? 1 : 0;
            
            updateList(filtered);
            updateCounters();
            
            const originalCount = campaigns.length;
            const resultCount = filtered.length;
            const percentage = originalCount > 0 ? ((resultCount / originalCount) * 100).toFixed(1) : 0;
            
            if (resultCount === 0) {
                showError(
                    '‚ùå –ü–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã<br>' +
                    '<small>' + filterCount + ' —Ñ–∏–ª—å—Ç—Ä(–æ–≤) –∞–∫—Ç–∏–≤–Ω–æ</small>'
                );
            } else if (filterCount > 0) {
                showMessage(
                    '‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã<br>' +
                    `<strong>${resultCount}</strong> –∏–∑ ${originalCount} –∑–∞–ø–∏—Å–µ–π (${percentage}%)<br>` +
                    `<small>${filterCount} —Ñ–∏–ª—å—Ç—Ä(–æ–≤) –∞–∫—Ç–∏–≤–Ω–æ</small>`,
                    'success'
                );
            } else {
                showMessage(`–ü–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ ${resultCount} –∫–∞–º–ø–∞–Ω–∏–π`, 'info');
            }
            
            console.log('‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –Ω–∞–π–¥–µ–Ω–æ', resultCount, '–∏–∑', originalCount);
        }

        function clearFilters() {
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            const filterFields = ['filterDateFrom', 'filterDateTo', 'filterBlogger', 'filterBook', 
                                'filterROIMin', 'filterROIMax', 'filterROASMin', 'filterROASMax', 
                                'filterCPSMin', 'filterCPSMax'];
            
            filterFields.forEach(function(id) {
                const element = document.getElementById(id);
                if (element) {
                    if (element.tagName === 'INPUT' && element.type === 'number') {
                        element.value = '';
                    } else if (element.tagName === 'SELECT') {
                        element.value = '';
                    } else {
                        element.value = '';
                    }
                }
            });
            
            updateList();
            showMessage('–§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã. –ü–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ –¥–∞–Ω–Ω—ã–µ.', 'info');
            console.log('üîÑ –§–∏–ª—å—Ç—Ä—ã –æ—á–∏—â–µ–Ω—ã');
        }

        // ==================== –ê–ù–ê–õ–ò–ó ====================
        function analyzeTop() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const topContainer = document.getElementById('topBloggers');
            
            if (!analyzeBtn || !topContainer) return;
            
            if (campaigns.length === 0) {
                showError('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–∞–º–ø–∞–Ω–∏–∏.');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<div class="loading"></div> –ê–Ω–∞–ª–∏–∑...';
            
            console.log('üìä –ù–∞—á–∞–ª–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–ø-10 –±–ª–æ–≥–µ—Ä–æ–≤...');
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –±–ª–æ–≥–µ—Ä–∞–º
            const bloggerStats = {};
            
            campaigns.forEach(function(campaign) {
                const profit = campaign.cp * campaign.qty;
                if (!bloggerStats[campaign.blogger]) {
                    bloggerStats[campaign.blogger] = {
                        totalCost: 0,
                        totalProfit: 0,
                        totalQty: 0,
                        campaignCount: 0,
                        campaigns: []
                    };
                }
                
                bloggerStats[campaign.blogger].totalCost += campaign.cost;
                bloggerStats[campaign.blogger].totalProfit += profit;
                bloggerStats[campaign.blogger].totalQty += campaign.qty;
                bloggerStats[campaign.blogger].campaignCount += 1;
                bloggerStats[campaign.blogger].campaigns.push({
                    date: campaign.date,
                    book: campaign.book,
                    cost: campaign.cost,
                    profit: profit,
                    qty: campaign.qty
                });
            });
            
            // –°—á–∏—Ç–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
            const topBloggers = Object.keys(bloggerStats).map(function(bloggerName) {
                const stats = bloggerStats[bloggerName];
                const roas = stats.totalCost > 0 ? stats.totalProfit / stats.totalCost : 0;
                const roi = roas > 0 ? (roas - 1) * 100 : 0;
                const cps = stats.totalQty > 0 ? stats.totalCost / stats.totalQty : 0;
                const avgOrderValue = stats.totalQty > 0 ? stats.totalProfit / stats.totalQty : 0;
                
                return {
                    name: bloggerName,
                    roas: roas,
                    roi: roi,
                    cps: cps,
                    totalProfit: stats.totalProfit,
                    totalCost: stats.totalCost,
                    totalQty: stats.totalQty,
                    campaignCount: stats.campaignCount,
                    avgOrderValue: avgOrderValue,
                    campaigns: stats.campaigns.sort(function(a, b) {
                        return new Date(b.date) - new Date(a.date);
                    })
                };
            }).filter(function(b) { 
                return b.totalCost > 0; // –ò—Å–∫–ª—é—á–∞–µ–º –Ω—É–ª–µ–≤—ã–µ
            }).sort(function(a, b) { 
                return b.roas - a.roas; 
            }).slice(0, 10);
            
            // –°—Ç—Ä–æ–∏–º HTML
            let html = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0; display: flex; align-items: center;">
                        <i class="fas fa-trophy" style="margin-right: 10px; color: gold;"></i>
                        –¢–æ–ø-${topBloggers.length} –±–ª–æ–≥–µ—Ä–æ–≤ –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (ROAS)
                    </h3>
                    <p style="color: var(--dark); font-size: 14px; margin: 0;">
                        –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ ${campaigns.length} –∫–∞–º–ø–∞–Ω–∏—è—Ö. –û–±—â–∏–π –±—é–¥–∂–µ—Ç: ${campaigns.reduce(function(sum, c) { return sum + c.cost; }, 0).toFixed(0)} —Ä—É–±.
                    </p>
                </div>
            `;
            
            if (topBloggers.length === 0) {
                html += `
                    <div class="empty-state">
                        <i class="fas fa-chart-line" style="font-size: 48px; color: var(--warning); margin-bottom: 15px;"></i>
                        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>
                        <p style="font-size: 14px;">–í—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ –∏–º–µ—é—Ç –Ω—É–ª–µ–≤—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã</p>
                    </div>
                `;
            } else {
                topBloggers.forEach(function(blogger, index) {
                    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `<span style="font-size: 14px;">${index + 1}.</span>`;
                    const roiClass = blogger.roi > 100 ? 'positive' : blogger.roi > 0 ? 'neutral' : 'negative';
                    const roasClass = blogger.roas > 3 ? 'positive' : blogger.roas > 1 ? 'neutral' : 'negative';
                    const rankColor = index < 3 ? 'gold' : index < 6 ? 'silver' : 'bronze';
                    
                    // –õ—É—á—à–∏–µ –∫–Ω–∏–≥–∏ —ç—Ç–æ–≥–æ –±–ª–æ–≥–µ—Ä–∞
                    const topBooks = blogger.campaigns
                        .reduce(function(stats, c) {
                            if (!stats[c.book]) stats[c.book] = { profit: 0, qty: 0, campaigns: 0 };
                            stats[c.book].profit += c.cp * c.qty;
                            stats[c.book].qty += c.qty;
                            stats[c.book].campaigns += 1;
                            return stats;
                        }, {})
                        .map(function(bookStats, bookName) {
                            return {
                                name: bookName,
                                profit: bookStats.profit,
                                qty: bookStats.qty,
                                campaigns: bookStats.campaigns
                            };
                        })
                        .sort(function(a, b) { return b.profit - a.profit; })
                        .slice(0, 2);
                    
                    const topBooksHtml = topBooks.map(function(book) {
                        return `<div style="display: flex; justify-content: space-between; padding: 3px 0; font-size: 13px;">
                            <span>${escapeHtml(book.name)}</span>
                            <span style="color: var(--primary);">${book.profit.toFixed(0)} —Ä—É–±. (${book.qty} —à—Ç.)</span>
                        </div>`;
                    }).join('');
                    
                    html += `
                        <div class="blogger-card" style="margin-bottom: 20px; padding: 20px; border: 2px solid ${index < 3 ? '#ffd700' : 'var(--border)'}; border-radius: 10px;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border);">
                                <div style="font-size: 24px; margin-right: 15px; min-width: 30px; text-align: center;">
                                    ${medal}
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="margin: 0; font-size: 18px; color: ${index < 3 ? 'var(--primary)' : 'var(--dark)'}">
                                        ${escapeHtml(blogger.name)}
                                    </h4>
                                    <p style="margin: 5px 0 0 0; font-size: 14px; color: var(--dark);">
                                        ${blogger.campaignCount} –∫–∞–º–ø–∞–Ω–∏–π | ${blogger.totalQty} –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥
                                    </p>
                                </div>
                                <div style="text-align: right;">
                                    <div class="metrics ${roasClass}" style="font-size: 20px; margin-bottom: 5px;">
                                        <strong>${blogger.roas.toFixed(2)}x</strong> ROAS
                                    </div>
                                    <div class="${roiClass}" style="font-size: 16px;">
                                        <strong>${blogger.roi.toFixed(0)}%</strong> ROI
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                                <div>
                                    <h5 style="margin: 0 0 8px 0; color: var(--secondary); border-bottom: 1px solid var(--border); padding-bottom: 5px;">
                                        <i class="fas fa-coins"></i> –§–∏–Ω–∞–Ω—Å—ã
                                    </h5>
                                    <div style="font-size: 14px;">
                                        <div style="display: flex; justify-content: space-between; margin: 4px 0;">
                                            <span>–ó–∞—Ç—Ä–∞—Ç—ã:</span>
                                            <span style="font-weight: bold;">${blogger.totalCost.toFixed(0)} —Ä—É–±.</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin: 4px 0; color: var(--primary);">
                                            <span>–ü—Ä–∏–±—ã–ª—å:</span>
                                            <span style="font-weight: bold;">${blogger.totalProfit.toFixed(0)} —Ä—É–±.</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin: 8px 0 4px 0; padding: 8px; background: var(--light); border-radius: 4px; font-size: 13px;">
                                            <span>CPS:</span>
                                            <span>${blogger.cps.toFixed(2)} —Ä—É–±./—à—Ç.</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h5 style="margin: 0 0 8px 0; color: var(--secondary); border-bottom: 1px solid var(--border); padding-bottom: 5px;">
                                        <i class="fas fa-chart-line"></i> –õ—É—á—à–∏–µ –∫–Ω–∏–≥–∏
                                    </h5>
                                    <div style="font-size: 14px;">
                                        ${topBooksHtml || '<div style="font-style: italic; color: var(--warning);">–ê–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>'}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="font-size: 13px; color: var(--dark); padding: 10px; background: var(--light); border-radius: 6px;">
                                <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> ROAS = –ü—Ä–∏–±—ã–ª—å / –ó–∞—Ç—Ä–∞—Ç—ã. –ó–Ω–∞—á–µ–Ω–∏–µ >3 —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç–ª–∏—á–Ω—ã–º.
                            </div>
                        </div>
                    `;
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const overallStats = calculateOverallStats();
                html += `
                    <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, var(--primary), #45a049); color: white; border-radius: 10px;">
                        <h3 style="margin: 0 0 15px 0; display: flex; align-items: center;">
                            <i class="fas fa-chart-pie" style="margin-right: 10px;"></i>
                            –û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ ${campaigns.length} –∫–∞–º–ø–∞–Ω–∏—è–º
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 16px;">
                            <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${overallStats.totalCampaigns}</div>
                                <div>–∫–∞–º–ø–∞–Ω–∏–π</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 24px; font-weight: bold; color: var(--warning); margin-bottom: 5px;">${overallStats.totalCost.toFixed(0)}</div>
                                <div>–æ–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã, —Ä—É–±.</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 24px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${overallStats.totalProfit.toFixed(0)}</div>
                                <div>–æ–±—â–∞—è –ø—Ä–∏–±—ã–ª—å, —Ä—É–±.</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${overallStats.overallROAS.toFixed(2)}x</div>
                                <div>—Å—Ä–µ–¥–Ω–∏–π ROAS</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 24px; font-weight: bold; color: ${overallStats.overallROI > 100 ? 'var(--primary)' : overallStats.overallROI > 0 ? 'var(--warning)' : 'var(--danger)'}; margin-bottom: 5px;">
                                    ${overallStats.overallROI > 0 ? '+' : ''}${overallStats.overallROI.toFixed(0)}%
                                </div>
                                <div>—Å—Ä–µ–¥–Ω–∏–π ROI</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            topContainer.innerHTML = html;
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É
            setTimeout(function() {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-magic"></i> –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑';
            }, 1000);
            
            console.log('‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –¢–æ–ø –±–ª–æ–≥–µ—Ä–æ–≤:', topBloggers.length);
            showMessage(`–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–æ—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ø-${topBloggers.length} –±–ª–æ–≥–µ—Ä–æ–≤ –ø–æ ROAS`, 'success');
        }

        function calculateOverallStats() {
            if (campaigns.length === 0) return {
                totalCampaigns: 0,
                totalCost: 0,
                totalProfit: 0,
                overallROAS: 0,
                overallROI: 0
            };
            
            const totalCost = campaigns.reduce(function(sum, c) { return sum + c.cost; }, 0);
            const totalProfit = campaigns.reduce(function(sum, c) { return sum + (c.cp * c.qty); }, 0);
            const totalQty = campaigns.reduce(function(sum, c) { return sum + c.qty; }, 0);
            
            const overallROAS = totalCost > 0 ? totalProfit / totalCost : 0;
            const overallROI = totalCost > 0 ? ((totalProfit - totalCost) / totalCost) * 100 : 0;
            
            return {
                totalCampaigns: campaigns.length,
                totalCost: totalCost,
                totalProfit: totalProfit,
                totalQty: totalQty,
                overallROAS: overallROAS,
                overallROI: overallROI
            };
        }

        // ==================== –£—Ç–∏–ª–∏—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ====================
        function showMessage(text, type = 'info') {
            const loadMessage = document.getElementById('loadMessage');
            if (!loadMessage) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.style.margin = '15px 0';
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-triangle',
                warning: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle'
            };
            
            const colors = {
                success: 'var(--primary)',
                error: 'var(--danger)',
                warning: 'var(--warning)',
                info: 'var(--secondary)'
            };
            
            messageDiv.innerHTML = `
                <div class="${type}-message" style="background: ${colors[type]}; color: white; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="${icons[type] || icons.info}" style="font-size: 20px;"></i>
                    <span style="line-height: 1.4;">${text}</span>
                </div>
            `;
            
            loadMessage.innerHTML = '';
            loadMessage.appendChild(messageDiv);
            
            // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                if (messageDiv.parentNode) {
                    messageDiv.style.opacity = '0';
                    setTimeout(function() {
                        if (messageDiv.parentNode) {
                            messageDiv.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        function showError(text) {
            showMessage(text, 'error');
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            if (modalId.includes('Blogger')) {
                isEditingBlogger = false;
                currentEditIndex = -1;
            } else if (modalId.includes('Book')) {
                isEditingBook = false;
                currentEditIndex = -1;
            }
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) {
                console.error('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ:', modalId);
                return;
            }
            
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤—ã–π input
            setTimeout(function() {
                const firstInput = modal.querySelector('input[required], input[type="text"], input[type="number"], select');
                if (firstInput) {
                    firstInput.focus();
                }
            }, 100);
        }

        // ==================== –ú–ê–°–°–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò ====================
        function deleteAllBloggers() {
            if (bloggers.length === 0) {
                showError('–ù–µ—Ç –±–ª–æ–≥–µ—Ä–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –±–ª–æ–≥–µ—Ä–æ–≤ (' + bloggers.length + ')?\n\n–≠—Ç–æ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ (' + campaigns.length + ').')) {
                bloggers = [];
                campaigns = []; // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏
                saveStorage();
                renderBloggers();
                populateSelects();
                updateList();
                updateCounters();
                showMessage(`–£–¥–∞–ª–µ–Ω–æ ${originalCount} –±–ª–æ–≥–µ—Ä–æ–≤ –∏ –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏–π`, 'success');
                switchTab('load');
            }
        }

        function deleteAllBooks() {
            if (books.length === 0) {
                showError('–ù–µ—Ç –∫–Ω–∏–≥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –∫–Ω–∏–≥–∏ (' + books.length + ')?\n\n–≠—Ç–æ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ (' + campaigns.length + ').')) {
                books = [];
                campaigns = []; // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏
                saveStorage();
                renderBooks();
                populateSelects();
                updateList();
                updateCounters();
                showMessage(`–£–¥–∞–ª–µ–Ω–æ ${originalCount} –∫–Ω–∏–≥ –∏ –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏–π`, 'success');
                switchTab('load');
            }
        }

                function deleteAllCampaigns() {
            if (campaigns.length === 0) {
                showError('–ù–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            const total = campaigns.length;
            const totalCost = campaigns.reduce(function(sum, c) { return sum + c.cost; }, 0).toFixed(0);
            const totalProfit = campaigns.reduce(function(sum, c) { return sum + (c.cp * c.qty); }, 0).toFixed(0);
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –∫–∞–º–ø–∞–Ω–∏–∏ (' + total + ')?\n\n' +
                       'üí∞ –û–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã: ' + totalCost + ' —Ä—É–±.\n' +
                       'üìà –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: ' + totalProfit + ' —Ä—É–±.\n\n' +
                       '–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–±–ª–æ–≥–µ—Ä—ã, –∫–Ω–∏–≥–∏) –æ—Å—Ç–∞–Ω—É—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏.\n\n' +
                       '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                
                const deletedCount = campaigns.length;
                campaigns = [];
                
                saveStorage();
                updateList();
                updateCounters();
                
                showMessage(
                    `üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ ${deletedCount} –∫–∞–º–ø–∞–Ω–∏–π<br>` +
                    `<strong>–ó–∞—Ç—Ä–∞—Ç—ã: ${totalCost} —Ä—É–±. | –ü—Ä–∏–±—ã–ª—å: ${totalProfit} —Ä—É–±.</strong><br>` +
                    `<small>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</small>`,
                    'success'
                );
                
                switchTab('load');
                showMessage('–í—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ —É–¥–∞–ª–µ–Ω—ã. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.', 'warning');
            }
        }

        // ==================== Toggle —Å–µ–∫—Ü–∏–π ====================
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId === 'bloggersList' ? 'bloggersList' : 'booksList');
            if (!section) return;
            
            const isHidden = section.classList.contains('hidden');
            section.classList.toggle('hidden');
            
            const toggleBtn = section.parentElement.querySelector('.toggle-btn');
            if (toggleBtn) {
                const icon = toggleBtn.querySelector('i');
                if (icon) {
                    icon.className = isHidden ? 'fas fa-eye-slash' : 'fas fa-eye';
                }
                const text = isHidden ? '–°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫' : '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫';
                toggleBtn.innerHTML = (isHidden ? '<i class="fas fa-eye-slash"></i> ' : '<i class="fas fa-eye"></i> ') + text;
            }
            
            console.log(sectionId, isHidden ? '—Å–∫—Ä—ã—Ç' : '–ø–æ–∫–∞–∑–∞–Ω');
        }

        // ==================== –°–ë–†–û–° ====================
        function showReset() {
            document.getElementById('resetPassword').value = '';
            document.getElementById('confirmResetBtn').disabled = true;
            document.getElementById('confirmResetBtn').style.opacity = '0.5';
            showModal('resetModal');
            document.getElementById('resetPassword').focus();
        }

        function resetAll() {
            const passwordInput = document.getElementById('resetPassword');
            const confirmBtn = document.getElementById('confirmResetBtn');
            
            if (!passwordInput || !confirmBtn) return;
            
            const password = passwordInput.value.trim();
            const confirmEnabled = !confirmBtn.disabled;
            
            if (!confirmEnabled) {
                showError('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            if (password !== 'admin') {
                showError('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø—Ä–æ—Å—Ç–æ–µ —Å–ª–æ–≤–æ –∏–∑ 5 –±—É–∫–≤ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                passwordInput.value = '';
                passwordInput.focus();
                return;
            }
            
            const totalBloggers = bloggers.length;
            const totalBooks = books.length;
            const totalCampaigns = campaigns.length;
            const totalStorage = (localStorage.bloggers?.length || 0) + (localStorage.books?.length || 0) + (localStorage.campaigns?.length || 0);
            
            const confirmText = totalBloggers + totalBooks + totalCampaigns > 0 ? 
                `‚ö†Ô∏è  –ü–û–õ–ù–´–ô –°–ë–†–û–° –î–ê–ù–ù–´–• ‚ö†Ô∏è

–ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ –ò–†–†–ï–í–ï–†–°–ò–ë–ò–õ–¨–ù–û:

üë• ${totalBloggers} –±–ª–æ–≥–µ—Ä–æ–≤
üìö ${totalBooks} –∫–Ω–∏–≥  
üìä ${totalCampaigns} –∫–∞–º–ø–∞–Ω–∏–π
üíæ localStorage (${(totalStorage / 1024).toFixed(1)} –ö–ë)

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!

–ü–†–û–î–û–õ–ñ–ò–¢–¨?` : 
                '–î–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã. –°–±—Ä–æ—Å –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?';
            
            if (confirm(confirmText)) {
                
                // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log('üí• –ü–û–õ–ù–´–ô –°–ë–†–û–° –ò–ù–ò–¶–ò–ò–†–û–í–ê–ù');
                console.log('–£–¥–∞–ª–µ–Ω–æ: –±–ª–æ–≥–µ—Ä–æ–≤=', totalBloggers, '–∫–Ω–∏–≥=', totalBooks, '–∫–∞–º–ø–∞–Ω–∏–π=', totalCampaigns);
                
                // –û—á–∏—â–∞–µ–º –≤—Å–µ
                localStorage.clear();
                bloggers = [];
                books = [];
                campaigns = [];
                
                // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                renderBloggers();
                renderBooks();
                updateList();
                populateSelects();
                updateCounters();
                
                // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
                hideReset();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                showMessage(
                    `<div style="text-align: center;">
                        <i class="fas fa-bomb" style="font-size: 48px; color: var(--danger); margin-bottom: 15px; display: block;"></i>
                        <strong style="font-size: 20px; display: block; margin-bottom: 10px;">üí• –î–ê–ù–ù–´–ï –ü–û–õ–ù–û–°–¢–¨–Æ –°–¢–ï–†–¢–´</strong>
                        <div style="font-size: 14px; opacity: 0.9;">
                            üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ ${totalBloggers} –±–ª–æ–≥–µ—Ä–æ–≤<br>
                            üìö –£–¥–∞–ª–µ–Ω–æ ${totalBooks} –∫–Ω–∏–≥<br>
                            üìä –£–¥–∞–ª–µ–Ω–æ ${totalCampaigns} –∫–∞–º–ø–∞–Ω–∏–π<br>
                            üíæ localStorage –æ—á–∏—â–µ–Ω (${(totalStorage / 1024).toFixed(1)} –ö–ë)
                        </div>
                    </div>`,
                    'error'
                );
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                switchTab('load');
                
                // –ñ—É—Ä–Ω–∞–ª –≤ –∫–æ–Ω—Å–æ–ª—å
                console.log('‚úÖ –°–±—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω. localStorage –æ—á–∏—â–µ–Ω.');
            }
        }

        function hideReset() {
            const passwordInput = document.getElementById('resetPassword');
            if (passwordInput) passwordInput.value = '';
            const confirmBtn = document.getElementById('confirmResetBtn');
            if (confirmBtn) {
                confirmBtn.disabled = true;
                confirmBtn.style.opacity = '0.5';
            }
            hideModal('resetModal');
        }

        // ==================== –≠–ö–°–ü–û–†–¢ ====================
        function exportData() {
            if (campaigns.length === 0 && bloggers.length === 0 && books.length === 0) {
                showError('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º workbook
            const wb = XLSX.utils.book_new();
            
            // –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–º–ø–∞–Ω–∏–π
            if (campaigns.length > 0) {
                const campaignsData = campaigns.map(function(c) {
                    const profit = c.cp * c.qty;
                    const roi = c.cost > 0 ? ((profit - c.cost) / c.cost * 100) : 0;
                    const roas = c.cost > 0 ? (profit / c.cost) : 0;
                    const cps = c.qty > 0 ? (c.cost / c.qty) : 0;
                    
                    return {
                        '–î–∞—Ç–∞': c.date,
                        '–ë–ª–æ–≥–µ—Ä': c.blogger,
                        '–ö–Ω–∏–≥–∞': c.book,
                        '–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)': c.cost,
                        '–ß–ü —Å –∫–Ω–∏–≥–∏ (—Ä—É–±.)': c.cp,
                        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç.)': c.qty,
                        '–ü—Ä–∏–±—ã–ª—å (—Ä—É–±.)': profit,
                        'ROI (%)': roi,
                        'ROAS (x)': roas,
                        'CPS (—Ä—É–±./—à—Ç.)': cps,
                        '–î–æ–±–∞–≤–ª–µ–Ω–æ': c.addedAt ? new Date(c.addedAt).toLocaleDateString('ru-RU') : ''
                    };
                });
                
                const ws = XLSX.utils.json_to_sheet(campaignsData);
                XLSX.utils.book_append_sheet(wb, ws, '–ö–∞–º–ø–∞–Ω–∏–∏');
                
                // –ê–≤—Ç–æ—à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫
                const colWidths = [
                    {wch: 12}, // –î–∞—Ç–∞
                    {wch: 20}, // –ë–ª–æ–≥–µ—Ä
                    {wch: 25}, // –ö–Ω–∏–≥–∞
                    {wch: 15}, // –°—Ç–æ–∏–º–æ—Å—Ç—å
                    {wch: 15}, // –ß–ü
                    {wch: 15}, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
                    {wch: 15}, // –ü—Ä–∏–±—ã–ª—å
                    {wch: 10}, // ROI
                    {wch: 10}, // ROAS
                    {wch: 15}, // CPS
                    {wch: 12}  // –î–æ–±–∞–≤–ª–µ–Ω–æ
                ];
                ws['!cols'] = colWidths;
            }
            
            // –≠–∫—Å–ø–æ—Ä—Ç –±–ª–æ–≥–µ—Ä–æ–≤
            if (bloggers.length > 0) {
                const bloggersData = bloggers.map(function(b) {
                    return {
                        '–ù–∞–∑–≤–∞–Ω–∏–µ': b.name,
                        '–°—Å—ã–ª–∫–∞': b.link || '',
                        '–ö–∞–º–ø–∞–Ω–∏–π': campaigns.filter(function(c) { return c.blogger === b.name; }).length
                    };
                });
                
                const ws = XLSX.utils.json_to_sheet(bloggersData);
                XLSX.utils.book_append_sheet(wb, ws, '–ë–ª–æ–≥–µ—Ä—ã');
                ws['!cols'] = [{wch: 30}, {wch: 40}, {wch: 10}];
            }
            
            // –≠–∫—Å–ø–æ—Ä—Ç –∫–Ω–∏–≥
            if (books.length > 0) {
                const booksData = books.map(function(bk) {
                    const bookCampaigns = campaigns.filter(function(c) { return c.book === bk.name; });
                    const totalSold = bookCampaigns.reduce(function(sum, c) { return sum + c.qty; }, 0);
                    const totalRevenue = bookCampaigns.reduce(function(sum, c) { return sum + (c.cp * c.qty); }, 0);
                    
                    return {
                        '–ù–∞–∑–≤–∞–Ω–∏–µ': bk.name,
                        '–ß–ü (—Ä—É–±.)': bk.cp,
                        '–ü—Ä–æ–¥–∞–Ω–æ (—à—Ç.)': totalSold,
                        '–í—ã—Ä—É—á–∫–∞ (—Ä—É–±.)': totalRevenue,
                        '–ö–∞–º–ø–∞–Ω–∏–π': bookCampaigns.length
                    };
                });
                
                const ws = XLSX.utils.json_to_sheet(booksData);
                XLSX.utils.book_append_sheet(wb, ws, '–ö–Ω–∏–≥–∏');
                ws['!cols'] = [{wch: 30}, {wch: 12}, {wch: 12}, {wch: 15}, {wch: 10}];
            }
            
            // –ò–º—è —Ñ–∞–π–ª–∞
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace(/[:.]/g, '-');
            const filename = `–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä_–±–ª–æ–≥–µ—Ä–æ–≤_${timestamp}.xlsx`;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            XLSX.writeFile(wb, filename);
            
            showMessage(
                `üì• –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Excel:<br>` +
                `<strong style="font-size: 16px;">${filename}</strong><br>` +
                `<small>${campaigns.length} –∫–∞–º–ø–∞–Ω–∏–π | ${bloggers.length} –±–ª–æ–≥–µ—Ä–æ–≤ | ${books.length} –∫–Ω–∏–≥</small>`,
                'success'
            );
            
            console.log('üì§ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω:', filename);
        }

        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function showBookStats(index) {
            if (index < 0 || index >= books.length) return;
            
            const book = books[index];
            const bookCampaigns = campaigns.filter(function(c) { return c.book === book.name; });
            
            if (bookCampaigns.length === 0) {
                showError('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–Ω–∏–≥–∏ "' + book.name + '"');
                return;
            }
            
            let statsHtml = `
                <div style="max-height: 400px; overflow-y: auto;">
                    <h3 style="margin-top: 0; color: var(--secondary);">üìä –ê–Ω–∞–ª–∏–∑ –∫–Ω–∏–≥–∏: ${escapeHtml(book.name)}</h3>
                    <p><strong>–ß–ü:</strong> ${book.cp.toFixed(2)} —Ä—É–±. | <strong>–ö–∞–º–ø–∞–Ω–∏–π:</strong> ${bookCampaigns.length}</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
            `;
            
            // –¢–æ–ø –±–ª–æ–≥–µ—Ä—ã –¥–ª—è —ç—Ç–æ–π –∫–Ω–∏–≥–∏
            const bloggerStats = {};
            bookCampaigns.forEach(function(c) {
                const profit = c.cp * c.qty;
                if (!bloggerStats[c.blogger]) {
                    bloggerStats[c.blogger] = { profit: 0, qty: 0, campaigns: 0 };
                }
                bloggerStats[c.blogger].profit += profit;
                bloggerStats[c.blogger].qty += c.qty;
                bloggerStats[c.blogger].campaigns += 1;
            });
            
            const topBloggersForBook = Object.keys(bloggerStats)
                .map(function(name) {
                    const stats = bloggerStats[name];
                    return { name: name, profit: stats.profit, qty: stats.qty, campaigns: stats.campaigns };
                })
                .sort(function(a, b) { return b.profit - a.profit; })
                .slice(0, 5);
            
            statsHtml += `
                <div>
                    <h4 style="margin: 0 0 10px 0; color: var(--primary);">üë§ –¢–æ–ø –±–ª–æ–≥–µ—Ä—ã</h4>
            `;
            
            topBloggersForBook.forEach(function(bs) {
                const roi = (bs.profit / bookCampaigns.reduce(function(sum, c) { return sum + c.cost; }, 0) * 100).toFixed(0);
                statsHtml += `
                    <div style="padding: 5px; background: var(--light); border-radius: 4px; margin: 3px 0; font-size: 13px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>${escapeHtml(bs.name)}</span>
                            <span style="color: var(--primary);">${bs.profit.toFixed(0)} —Ä—É–±.</span>
                        </div>
                        <div style="font-size: 11px; color: var(--dark);">
                            ${bs.qty} —à—Ç. | ${bs.campaigns} –∫–∞–º–ø–∞–Ω–∏–π
                        </div>
                    </div>
                `;
            });
            
            statsHtml += `
                </div>
                <div>
                    <h4 style="margin: 0 0 10px 0; color: var(--secondary);">üìà –û–±—â–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h4>
            `;
            
            const totalCost = bookCampaigns.reduce(function(sum, c) { return sum + c.cost; }, 0);
            const totalProfit = bookCampaigns.reduce(function(sum, c) { return sum + (c.cp * c.qty); }, 0);
            const totalQty = bookCampaigns.reduce(function(sum, c) { return sum + c.qty; }, 0);
            const totalROAS = totalCost > 0 ? totalProfit / totalCost : 0;
            const totalROI = totalCost > 0 ? ((totalProfit - totalCost) / totalCost * 100) : 0;
            const avgCPS = totalQty > 0 ? totalCost / totalQty : 0;
            
            statsHtml += `
                    <div style="padding: 10px; background: var(--light); border-radius: 6px; font-size: 14px;">
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span><strong>–û–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã:</strong></span>
                            <span>${totalCost.toFixed(0)} —Ä—É–±.</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 5px 0; color: var(--primary);">
                            <span><strong>–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å:</strong></span>
                            <span>${totalProfit.toFixed(0)} —Ä—É–±.</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span><strong>–ü—Ä–æ–¥–∞–Ω–æ:</strong></span>
                            <span>${totalQty} —à—Ç.</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 8px 0; padding: 8px; background: white; border-radius: 4px; font-weight: bold;">
                            <span>ROI: ${totalROI > 0 ? '+' : ''}${totalROI.toFixed(1)}%</span>
                            <span style="color: var(--primary);">ROAS: ${totalROAS.toFixed(2)}x</span>
                        </div>
                        <div style="font-size: 12px; color: var(--dark);">
                            CPS: ${avgCPS.toFixed(2)} —Ä—É–±./—à—Ç. | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –µ—Å–ª–∏ < –ß–ü (${book.cp.toFixed(2)} —Ä—É–±.)
                        </div>
                    </div>
                </div>
            `;
            
            statsHtml += `
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 6px; font-size: 13px;">
                    <h4 style="margin: 0 0 10px 0; color: var(--warning);">üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${totalROI > 100 ? 
                            '<li style="color: var(--primary);">‚úÖ <strong>–û—Ç–ª–∏—á–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!</strong> ROI ' + totalROI.toFixed(1) + '%</li>' : 
                            totalROI > 0 ? 
                                '<li style="color: var(--warning);">‚ö†Ô∏è  –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. ROI ' + totalROI.toFixed(1) + '% ‚Äî –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å</li>' : 
                                '<li style="color: var(--danger);">‚ùå <strong>–£–±—ã—Ç–æ—á–Ω–æ!</strong> ROI ' + totalROI.toFixed(1) + '% ‚Äî –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</li>'
                        }
                        <li>üí° CPS (' + avgCPS.toFixed(2) + ' —Ä—É–±.) ${avgCPS < book.cp ? '–Ω–∏–∂–µ' : '–≤—ã—à–µ'} –ß–ü (' + book.cp.toFixed(2) + ' —Ä—É–±.)</li>
                        <li>üéØ –¢–æ–ø-–ø—Ä–æ–¥–∞–∂–∏ —á–µ—Ä–µ–∑: ${topBloggersForBook[0] ? topBloggersForBook[0].name : '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</li>
                    </ul>
                </div>
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ (–∏–ª–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –º–æ–¥–∞–ª–∫—É)
            const modal = document.createElement('div');
            modal.className = 'form-popup';
            modal.style.cssText = 'display: block; z-index: 1001;';
            modal.innerHTML = `
                <div class="form-container" style="max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border);">
                        <h3 style="margin: 0;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–Ω–∏–≥–∏</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove(); document.body.style.overflow = 'auto';" 
                                style="background: var(--danger); color: white; border: none; padding: 10px; border-radius: 50%; cursor: pointer; font-size: 18px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    ${statsHtml}
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        // –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ 200–º—Å...');
                setTimeout(function() {
                    if (!initApp()) {
                        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    }
                }, 200);
            });
        } else {
            // DOM —É–∂–µ –≥–æ—Ç–æ–≤
            setTimeout(initApp, 100);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('üí• –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', message);
            console.error('üìç –§–∞–π–ª:', source, '–°—Ç—Ä–æ–∫–∞:', lineno, '–°—Ç–æ–ª–±–µ—Ü:', colno);
            if (error && error.stack) {
                console.error('üìö –°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤:', error.stack);
            }
            showError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + message + '\n\n–°—Ç—Ä–æ–∫–∞: ' + lineno + '\n–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è.');
            return false;
        };

        console.log('üöÄ –°–∫—Ä–∏–ø—Ç –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –±–ª–æ–≥–µ—Ä–æ–≤ v7.3 –∑–∞–≥—Ä—É–∂–µ–Ω');
        console.log('üì¶ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:');
        console.log('   ‚úÖ Google Sheets CSV');
        console.log('   ‚úÖ Excel (.xlsx/.xls) —Å SheetJS');
        console.log('   ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–±–ª–æ–≥–µ—Ä—ã/–∫–Ω–∏–≥–∏)');
        console.log('   ‚úÖ –§–∏–ª—å—Ç—Ä—ã –∏ –º–µ—Ç—Ä–∏–∫–∏ (ROI/ROAS/CPS)');
        console.log('   ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–æ–ø-10');
        console.log('   ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel');
        console.log('   ‚úÖ localStorage —Å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º');
        console.log('üîê –ü–∞—Ä–æ–ª—å —Å–±—Ä–æ—Å–∞: admin');

    </script>
</body>
</html>
